class KatAppEventFluentApi{elements;constructor(t){this.elements=t}on(t,i){var a=t.split(" ");return this.elements.forEach(e=>{a.forEach(t=>e.addEventListener(t,i))}),this}off(t){var e=t.split(" ");return this.elements.forEach(i=>{null!=i.kaEventListeners&&e.forEach(e=>{var t=i.kaEventListeners?.[e];null!=t&&t.forEach(t=>i.removeEventListener(e,t.listener,t.options))})}),this}}class KatApp{selector;static applications=[];static globalEventConfigurations=[];static getDirty(){return this.applications.filter(t=>t.state.isDirty)}static remove(e){e.isMounted&&e.vueApp.unmount(),document.querySelector(`template[id$='${e.id}']`)?.remove(),this.applications=this.applications.filter(t=>t.id!=e.id)}static get(i){if("number"==typeof i)return this.applications[i];if("string"==typeof(i="object"==typeof i?i.closest("[ka-id]")?.getAttribute("ka-id")??"":i)&&""!=i){var t=this.applications.find(t=>t.id==i||t.selector==i);if(null!=t)return t;let e=document.querySelectorAll(i);if(1<(e=0!=e.length||i.startsWith(".")||i.startsWith("#")?e:document.querySelectorAll("."+i)).length)throw new Error("Unable to find a unique application with the key of "+i);if(1==e.length&&e[0].hasAttribute("ka-id"))return this.applications.find(t=>t.id==e[0].getAttribute("ka-id"))}}static handleEvents(t,e){var i={};e(i),this.globalEventConfigurations.push({selector:t,events:i})}static async createAppAsync(t,e){let i;try{return i=new KatApp(t,e),this.applications.push(i),await i.mountAsync(),i}catch(t){throw document.querySelector(".kaModal")?.remove(),null!=i&&KatApp.remove(i),t}}id;isCalculating;lastCalculation;options;state;el;traceStart;traceLast;missingResources=[];missingLanguageResources=[];applicationCss;vueApp;viewTemplates;mountedTemplates={};isMounted=!1;pushToTables=[];configureOptions;calcEngines=[];uiBlockCount=0;eventConfigurations=[];domElementQueued=!1;domElementQueue=[];updateDomPromise=Promise.resolve();constructor(t,e){this.selector=t,this.traceStart=this.traceLast=new Date;let n=this.id="ka"+KatApps.Utils.generateId(),s=(this.applicationCss=".katapp-"+this.id.substring(2),this.isCalculating=!1,this);var i={inputCaching:!1,canProcessExternalHelpTips:!1,debug:{traceVerbosity:"1"===KatApps.Utils.pageParameters.tracekatapp?TraceVerbosity.Diagnostic:TraceVerbosity.None,showInspector:KatApps.Utils.pageParameters.showinspector??(null!=KatApps.Utils.pageParameters.localserver?"1":"0"),useTestCalcEngine:"1"===KatApps.Utils.pageParameters.test,useTestView:"1"===KatApps.Utils.pageParameters.testview,debugResourcesDomain:KatApps.Utils.pageParameters.localserver},endpoints:{calculation:"https://btr.lifeatworkportal.com/services/evolution/CalculationFunction.ashx",katDataStore:"https://btr.lifeatworkportal.com/services/camelot/datalocker/api/kat-apps/{name}/download",kamlVerification:"api/katapp/verify-katapp"},delegates:{encryptCache:t=>"string"==typeof t?t:JSON.stringify(t),decryptCache:t=>t.startsWith("{")?JSON.parse(t):t,getSessionKey:t=>`KatApp:${new URL(document.baseURI).pathname}:`+t,setSessionItem:function(t,e){e="string"==typeof e?e:"json:"+JSON.stringify(e);sessionStorage.setItem(t,e)},getSessionItem:function(t,e=!1){var i=sessionStorage.getItem(t);if(null!=i)return e&&this.removeSessionItem(t),i.startsWith("json:")?JSON.parse(i.substring(5)):i},removeSessionItem:t=>sessionStorage.removeItem(t)}},i=(this.options=KatApps.Utils.extendWithReplacer({},(t,e)=>e,i,e),this.nextCalculation),i=(i.trace&&(i.originalVerbosity=this.options.debug.traceVerbosity,this.nextCalculation=i,this.options.debug.traceVerbosity=TraceVerbosity.Detailed),null==e.modalAppOptions?document.querySelectorAll(t):void 0);if(null!=i&&1!=i.length)throw new Error("'selector' of '"+this.selector+"' did not match any elements.");if(null==i&&null==e.modalAppOptions)throw new Error("No 'selector' or 'modalAppOptions' were provided.");this.el=i?.item(0)??this.createModalContainer(),this.domElementQueue=[this.el],this.el.setAttribute("ka-id",this.id),this.el.classList.add("katapp-css",this.applicationCss.substring(1)),null==this.el.getAttribute("v-scope")&&this.el.setAttribute("v-scope",""),null!=this.el.getAttribute("ka-cloak")||null==e.view&&null==e.content&&!1===(e.cloneHost??!1)||this.el.setAttribute("ka-cloak",""),null==document.querySelector("ka-resources")&&((t=document.createElement("ka-resources")).innerHTML=`<style>
	ka-resources, [v-cloak], [ka-cloak] { display: none; }
	.kaModalInit { cursor: progress; }
	body.ka-inspector-value .ka-inspector-value { border: 2px dashed #78aff6; }
	body.ka-inspector-api .ka-inspector-api { border: 2px dotted #785900; }
	body.ka-inspector-app .ka-inspector-app { border: 2px dotted #785900; }
	body.ka-inspector-modal .ka-inspector-modal { border: 2px dotted #785900; }
	body.ka-inspector-navigate .ka-inspector-navigate { border: 2px dotted #785900; }
	body.ka-inspector-chart .ka-inspector-chart { border: 2px dotted #087849; }
	body.ka-inspector-attributes .ka-inspector-attributes { border: 2px dashed #34495E; }
	body.ka-inspector-inline .ka-inspector-inline { border: 2px dashed #fcce00; }
	body.ka-inspector-table .ka-inspector-table { border: 2px dotted #444; }
	body.ka-inspector-rbl-no-calc .ka-inspector-rbl-no-calc, body.ka-inspector-rbl-exclude .ka-inspector-rbl-exclude { border: 2px dotted #f93b1d; }
	body.ka-inspector-unmount-clears-inputs .ka-inspector-unmount-clears-inputs { border: 2px dotted #f93b1d; }
	body.ka-inspector-needs-calc .ka-inspector-needs-calc { border: 2px dotted #f93b1d; }
	body.ka-inspector-template .ka-inspector-template { border: 2px dotted #10a84a; }
	body.ka-inspector-input .ka-inspector-input, body.ka-inspector-input-group .ka-inspector-input-group { border: 2px dotted #770519; }
	body.ka-inspector-on .ka-inspector-on { border: 2px dotted #ff9e76; }
	body.ka-inspector-bind .ka-inspector-bind { border: 2px dotted #78aff6; }
	body.ka-inspector-html .ka-inspector-html { border: 2px dashed #b6de29; }
	body.ka-inspector-text .ka-inspector-text { border: 2px dashed #b6de29; }
	body.ka-inspector-pre .ka-inspector-pre { border: 2px dotted #f93b1d; }
	body.ka-inspector-scope .ka-inspector-scope { border: 2px dotted #57625a; }
	body.ka-inspector-for .ka-inspector-for { border: 2px dotted #f93b1d; }
	body .ka-inspector-if-hidden { display: none; color: #b232c0; }
	body .ka-inspector-show-hidden { display: none; color: #b232c0; }
	body.ka-inspector-if .ka-inspector-if-hidden, body.ka-inspector-show .ka-inspector-show-hidden { display: block; }
	body.ka-inspector-if .ka-inspector-if { border: 2px dotted #b232c0; }
	body.ka-inspector-show .ka-inspector-show { border: 2px dotted #b232c0; }
	body.ka-inspector-resource .ka-inspector-resource { border: 3px dashed #2067b3; }
	body.ka-inspector-resource .ka-inspector-resource.missing { border: 3px dashed #f93b1d; }
	body.ka-inspector-resource .ka-inspector-resource.missing-culture { border: 3px dashed #10a84a; }
</style>`,document.body.appendChild(t));function a(...t){var e=1==t.length?"rbl-value":t[0];let i=1==t.length?t[0]:t[1];var a=3<=t.length?t[2]:void 0;let n=4<=t.length?t[3]:void 0;var s=5<=t.length?t[4]:void 0,t=6<=t.length?t[5]:void 0;return o(e,s,t).find(t=>t[n??"id"]==i)?.[a??"value"]}let r=function(e,t){var i=e?s.calcEngines.find(t=>t.key==e):s.calcEngines[0];if(null==i)throw new Error(`Can not find CalcEngine ${e} in rbl-config.`);t=t??i.resultTabs[0];if(-1==i.resultTabs.indexOf(t))throw new Error(`Can not find Tab ${t} for ${e} in rbl-config.`);return i.key+"."+t},o=function(t,e,i){e=r(e,i);return s.state.rbl.results[e]?.[t]??[]},l=t=>null==t||("string"==typeof t?-1==["false","0","n","no"].indexOf(t.toLowerCase()):!!t);i=this.getCloneApplication(this.options);function p(t,e,i,a=!1){if(!a&&null==t._ka)throw new Error("Can not use mergeRows on a rbl.results tabDef.  Please use rbl.pushTo instead.");null==t[e]&&(t[e]=[]);let n=t[e];(i instanceof Array?i:[i]).forEach((e,t)=>{e.id=e.id??"_pushId_"+(n.length+t);t=n.findIndex(t=>t.id==e.id);-1<t?n.splice(t,1,e):n.splice(n.length,0,e)})}let c=!1;e={kaId:this.id,application:this,lastInputChange:Date.now(),inputsChanged:!1,get isDirty(){return c??this.inputsChanged},set isDirty(t){((c=t)??!0)||(this.inputsChanged=!1)},uiBlocked:!1,canSubmit(t){return(t?this.inputsChanged:this.isDirty)&&0==this.errors.filter(t=>t.id.startsWith("i")).length&&!this.uiBlocked},needsCalculation:!1,inputs:KatApps.Utils.extend({getOptionText:t=>s.selectElement(`.${t} option:checked`)?.textContent??void 0,getNumber:t=>{var e,i,t=s.state.inputs[t];if(null!=t)return e=this.options.intl.currencyDecimalSeparator,i=new RegExp(`[^-0-9${e}]+`,"g"),t=parseFloat(t.replace(i,"").replace(e,".")),isNaN(t)?void 0:t}},this.options.inputs,this.getSessionStorageInputs()),errors:[],warnings:[],onAll(...t){return null==t.find(t=>""==(t??"")||!l(t))},onAny(...t){return null!=t.find(t=>""!=(t??"")&&l(t))},rbl:{results:i?KatApps.Utils.clone(i.state.rbl.results):{},mergeRows(t,e,i){p(t,e,i,!1)},pushTo(t,e,i,a){i=r(i,a),a=s.state.rbl.results[i];null!=a&&(p(a,t,e,!0),s.pushToTables.push(i+"."+t))},boolean(){var t=[...arguments],e=t.filter(t=>"boolean"!=typeof t),i=t[0],i=1==e.length?this.value("rbl-value",i)??this.value("rbl-display",i)??this.value("rbl-disabled",i)??this.value("rbl-skip",i):a(...e),e=t.find(t=>"boolean"==typeof t);return null==i&&null!=e?e:l(i)},text(){return s.getLocalizedString(a(...arguments))},value(){return a(...arguments)},number(){var t=+(a(...arguments)??0);return isNaN(t)?0:t},source(t,e,i,a){return"function"==typeof e?(a=e,e=void 0):"function"==typeof i&&(a=i,i=void 0),a?o(t,e,i).filter(t=>a(t)):o(t,e,i)},exists(t,e,i,a){return"function"==typeof e?(a=e,e=void 0):"function"==typeof i&&(a=i,i=void 0),a?0<o(t,e,i).filter(t=>a(t)).length:0<o(t,e,i).length},expressions:{value(t){},number(t){return 0},boolean(t,e){return e??!0}}},model:i?KatApps.Utils.clone(i.state.model):{},handlers:i?KatApps.Utils.clone(i.state.handlers??{}):{},components:{},_domElementMounted(e){if(!s.el.hasAttribute("ka-cloak")){if(!s.domElementQueue.includes(s.el)&&!s.domElementQueue.includes(e)){let t=!0;for(var i=s.domElementQueue.length;i--;){var a=s.domElementQueue[i];e.contains(a)?s.domElementQueue.splice(i,1):a.contains(e)&&(t=!1,i=0)}t&&s.domElementQueue.push(e)}s.domElementQueued||(s.domElementQueued=!0,s.updateDomPromise.then(async()=>s.processDomElementsAsync.apply(s)))}},_templateItemMounted:(t,e,i)=>{var a="STYLE"==e.tagName||e.hasAttribute("setup")?"setup":"mount";if(e.removeAttribute("setup"),"setup"==a){a=`${t}_${e.tagName}_${n}_mount`;if(null!=s.mountedTemplates[a])return void e.remove();s.mountedTemplates[a]=!0}"SCRIPT"==e.tagName?(new Function("_a","_s","_r","_m","_i","_h",e.textContent+"\nif ( typeof mounted !== 'undefined' ) mounted(_a, _s, _r, _m, _i, _h);")(s,i,s.state.rbl,s.state.model,s.state.inputs,s.state.handlers),e.remove()):"STYLE"==e.tagName&&(e.outerHTML=e.outerHTML.replace(/thisApplication/g,this.applicationCss))},_templateItemUnmounted:(t,e,i)=>{if("setup"==(e.hasAttribute("setup")?"setup":"mount")){t=`${t}_${e.tagName}_${n}_unmount`;if(null!=s.mountedTemplates[t])return void e.remove();s.mountedTemplates[t]=!0}new Function("_a","_s","_r","_m","_i","_h",e.textContent+"\nif ( typeof unmounted !== 'undefined' ) unmounted(_a, _s, _r, _m, _i, _h);")(s,i,s.state.rbl,s.state.model,s.state.inputs,s.state.handlers)}};this.state=PetiteVue.reactive(e)}getCloneApplication(t){t=t.cloneHost??!1;return"string"==typeof t?KatApp.get(t):!0===t?this.options.hostApplication:void 0}async triggerEventAsync(e,...t){KatApps.Utils.trace(this,"KatApp","triggerEventAsync",`Start: ${e}.`,TraceVerbosity.Detailed);try{"calculation"!=e&&"configureUICalculation"!=e||await PetiteVue.nextTick();var i,a=[...t,this];for(i of this.eventConfigurations.map(t=>t.events).concat(KatApp.globalEventConfigurations.filter(t=>-1<t.selector.split(",").map(t=>t.trim()).indexOf(this.selector)).map(t=>t.events)))try{let t=i[e]?.apply(this.el,a);if(t instanceof Promise&&(t=await t),null!=(n=t)&&"boolean"==typeof n&&-1<["modalAppInitialized","calculateStart","apiStart"].indexOf(e)&&!n)return t}catch(t){t instanceof ApiError||(KatApps.Utils.trace(this,"KatApp","triggerEventAsync",`Error calling ${e}: `+t,TraceVerbosity.None,t),this.addUnexpectedError(t))}return!0}finally{KatApps.Utils.trace(this,"KatApp","triggerEventAsync",`Complete: ${e}.`,TraceVerbosity.Detailed)}var n}configure(t){if(this.isMounted)throw new Error("You cannot call 'configure' after the KatApp has been mounted.");var e,i={events:{}};t(i,this.state.rbl,this.state.model,this.state.inputs,this.state.handlers);let a=!1;for(e in i.events){a=!0;break}return a&&this.eventConfigurations.push({directiveId:void 0,events:i.events}),this.configureOptions=i,this}handleEvents(t){var e={};return t(e,this.state.rbl,this.state.model,this.state.inputs,this.state.handlers),this.eventConfigurations.push({directiveId:void 0,events:e}),this}handleDirectiveEvents(t,e){var i={};return t(i,this.state.rbl,this.state.model,this.state.inputs,this.state.handlers),this.removeDirectiveEvents(e),this.eventConfigurations.push({directiveId:e,events:i}),this}removeDirectiveEvents(e){return this.eventConfigurations=this.eventConfigurations.filter(t=>t.directiveId!=e),this}appendAndExecuteScripts(i,t){var e=t.querySelectorAll("script");[...t.children].filter(t=>"SCRIPT"!==t.tagName).forEach(t=>i.appendChild(t)),e.forEach(t=>{var e=document.createElement("script");t.src?e.src=t.src:e.textContent=t.textContent,i.appendChild(e)})}async mountAsync(){try{KatApps.Utils.trace(this,"KatApp","mountAsync","Start",TraceVerbosity.Detailed),null!=this.options.view&&this.el.setAttribute("data-view-name",this.options.view);let viewElement=await this.getViewElementAsync(),inputs=(this.viewTemplates=null!=viewElement?[...await this.getViewTemplatesAsync(viewElement),this.id].reverse():[this.id],KatApps.Utils.trace(this,"KatApp","mountAsync","View Templates Complete",TraceVerbosity.Detailed),await this.getOptionResourcesAsync(),this.options.inputs),mr=this.options.manualResults,processCalcEngineConfigTokens=t=>null==t?t:t.replace(/{([^}]+)}/g,function(t,r){if(r.startsWith("rbl:")){if(null==mr)return"";let e=r.substring(4).split(".").map(t=>""!=t?t:void 0)??[],i=(1==e.length&&(e=["rbl-value",e[0]]),function(t){return e.length>t&&""!=e[t]?e[t]:void 0}),a=i(4),n=i(5);var o=mr.find(t=>!(null!=a&&t["@calcEngineKey"]!=a||null!=n&&t["@name"]!=n))?.[i(0)];if(null==o)return"";o=o instanceof Array?o:[o];let s=i(3)??"id";return o.find(t=>t[s]==i(1))?.[i(2)??"value"]??""}return inputs?.[r]??t}),cloneApplication=this.getCloneApplication(this.options);function calcEngineFactory(c,pipelineIndex){let enabled=processCalcEngineConfigTokens(c.getAttribute("enabled")),name=processCalcEngineConfigTokens(c.getAttribute("name"))??c.getAttribute("key")??"UNAVAILABLE";return null==pipelineIndex?{key:c.getAttribute("key")??"default",name:name,inputTab:c.getAttribute("input-tab")??"RBLInput",resultTabs:processCalcEngineConfigTokens(c.getAttribute("result-tabs"))?.split(",")??["RBLResult"],pipeline:[...c.querySelectorAll("pipeline")].map((t,e)=>calcEngineFactory(t,e+1)),allowConfigureUi:"false"!=c.getAttribute("configure-ui"),manualResult:!1,enabled:"false"!=(enabled?.startsWith("!!")?eval(enabled.substring(2)):enabled)}:{key:"pipeline"+pipelineIndex,name:name,inputTab:c.getAttribute("input-tab"),resultTab:processCalcEngineConfigTokens(c.getAttribute("result-tab"))}}if(this.options.hostApplication=this.options.hostApplication??cloneApplication,this.calcEngines=null==cloneApplication&&null!=viewElement?[...viewElement.querySelectorAll("rbl-config > calc-engine")].map(t=>calcEngineFactory(t)):cloneApplication?[...cloneApplication.calcEngines.filter(t=>!t.manualResult)]:[],KatApps.Utils.trace(this,"KatApp","mountAsync","CalcEngines configured",TraceVerbosity.Detailed),null!=viewElement&&(null!=this.options.hostApplication&&"1"==this.options.inputs?.iModalApplication?null!=this.options.content?("string"==typeof this.options.content?this.selectElement(".modal-body").innerHTML=this.options.content:this.selectElement(".modal-body").append(this.options.content),this.selectElements("[data-bs-toggle='tooltip'], [data-bs-toggle='popover']").forEach(t=>t.removeAttribute("ka-init-tip"))):this.appendAndExecuteScripts(this.selectElement(".modal-body"),viewElement):this.appendAndExecuteScripts(this.el,viewElement)),KatApps.Components.initializeCoreComponents(this,t=>this.getTemplateId(t)),Object.defineProperties(this.state.model,Object.getOwnPropertyDescriptors(this.configureOptions?.model??{})),Object.defineProperties(this.state.handlers,Object.getOwnPropertyDescriptors(this.configureOptions?.handlers??{})),null!=this.configureOptions){for(var propertyName in this.configureOptions.components)this.state.components[propertyName]=this.configureOptions.components[propertyName];null!=this.configureOptions.options?.modalAppOptions&&"1"==this.state.inputs.iModalApplication&&KatApps.Utils.extend(this.options,{modalAppOptions:this.configureOptions.options.modalAppOptions}),null!=this.configureOptions.options?.inputs&&KatApps.Utils.extend(this.state.inputs,this.configureOptions.options.inputs)}let isModalApplication=null!=this.options.hostApplication&&"1"==this.options.inputs?.iModalApplication,isNestedApplication=null!=this.options.hostApplication&&"1"==this.options.inputs?.iNestedApplication;if(isModalApplication){if(null!=this.options.modalAppOptions?.buttonsTemplate&&(this.selectElements(".modal-footer-buttons button").forEach(t=>t.remove()),this.selectElement(".modal-footer-buttons")?.setAttribute("v-scope","components.template({name: '"+this.options.modalAppOptions.buttonsTemplate+"'})")),null!=this.options.modalAppOptions?.headerTemplate){let modalBody=this.selectElement(".modal-body"),modalHeader=modalBody?.previousElementSibling;if(modalHeader)for(modalHeader.setAttribute("v-scope",`components.template({name: '${this.options.modalAppOptions.headerTemplate}'})`);modalHeader.firstChild;)modalHeader.removeChild(modalHeader.firstChild)}await this.options.hostApplication.triggerEventAsync("modalAppInitialized",this)}if(isNestedApplication&&await this.options.hostApplication.triggerEventAsync("nestedAppInitialized",this),await this.triggerEventAsync("initialized"),null!=this.options.manualResults){let hasCalcEngines=0<this.calcEngines.length,tabDefs=(this.calcEngines.push(...this.toCalcEngines(this.options.manualResults)),this.options.manualResults.map(t=>({calcEngine:t["@calcEngine"],tabDef:t}))),manualResultTabDefs=this.toTabDefs(tabDefs);if(!hasCalcEngines){let getSubmitApiConfigurationResults=await this.getSubmitApiConfigurationAsync(async t=>{await this.triggerEventAsync("updateApiOptions",t,this.getApiUrl(this.options.endpoints.calculation,!1).endpoint)},{},!0);await this.triggerEventAsync("resultsProcessing",manualResultTabDefs,getSubmitApiConfigurationResults.inputs,getSubmitApiConfigurationResults.configuration)}await this.processResultsAsync(manualResultTabDefs,void 0)}this.initializeInspector();let isConfigureUICalculation=0<this.calcEngines.filter(t=>t.allowConfigureUi&&t.enabled&&!t.manualResult).length;if(null==cloneApplication&&!this.hasErrors()&&isConfigureUICalculation&&(this.handleEvents(t=>{t.calculationErrors=async(t,e)=>{"SubmitCalculation.ConfigureUI"==t&&(this.addUnexpectedError(e),KatApps.Utils.trace(this,"KatApp","mountAsync",isModalApplication?"KatApp Modal Exception":"KatApp Exception",TraceVerbosity.None,e))}}),await this.calculateAsync({_iConfigureUI:"1",iConfigureUI:"1",iDataBind:"1"})),isModalApplication){let modalAppInitialized=await this.triggerEventAsync("modalAppInitialized")??!0;if(!modalAppInitialized)return this.options.modalAppOptions.promise.resolve({confirmed:!1,data:void 0,modalApp:this}),this.el.remove(),KatApp.remove(this),void this.options.hostApplication.unblockUI()}this.state.errors.forEach(t=>t.initialization=!0);let initializationErrors=this.hasErrors();if(this.vueApp=PetiteVue.createApp(this.state),KatApps.Directives.initializeCoreDirectives(this.vueApp,this),null!=this.configureOptions)for(let propertyName in this.configureOptions.directives)this.vueApp.directive(propertyName,this.configureOptions.directives[propertyName]);this.vueApp.mount(this.selector),this.isMounted=!0,initializationErrors||null!=cloneApplication||(isConfigureUICalculation&&this.lastCalculation?(await this.triggerEventAsync("configureUICalculation",this.lastCalculation),await this.triggerEventAsync("calculation",this.lastCalculation),await this.triggerEventAsync("calculateEnd")):null!=this.calcEngines.find(t=>t.manualResult)&&await this.triggerEventAsync("calculation",this.lastCalculation)),isModalApplication&&await this.showModalApplicationAsync(),this.el.removeAttribute("ka-cloak"),await this.processDomElementsAsync(),this.state.inputsChanged=!1,await this.triggerEventAsync("rendered",initializationErrors?this.state.errors:void 0),null!=this.options.hostApplication&&"1"==this.options.inputs?.iNestedApplication&&await this.options.hostApplication.triggerEventAsync("nestedAppRendered",this,initializationErrors?this.state.errors:void 0)}catch(ex){throw ex instanceof KatApps.KamlRepositoryError&&KatApps.Utils.trace(this,"KatApp","mountAsync","Error during resource download",TraceVerbosity.None,...ex.results.map(t=>t.resource+": "+t.errorMessage)),ex}finally{KatApps.Utils.trace(this,"KatApp","mountAsync","Complete",TraceVerbosity.Detailed)}}async getOptionResourcesAsync(){if(null==this.options.resourceStrings&&null!=this.options.endpoints.resourceStrings){var t=this.getApiUrl(this.options.endpoints.resourceStrings,!0);try{var e=await fetch(t.url,{method:"GET",headers:{"Cache-Control":"max-age=0"},cache:"default"});if(!e.ok)throw await e.json();this.options.resourceStrings=await e.json(),KatApps.Utils.trace(this,"KatApp","mountAsync","Resource Strings downloaded",TraceVerbosity.Detailed)}catch(t){KatApps.Utils.trace(this,"KatApp","mountAsync","Error downloading resourceStrings "+this.options.endpoints.resourceStrings,TraceVerbosity.None,t)}this.options.debug.debugResourcesDomain&&((t=this.options).useLocalRepository=t.useLocalRepository||await KatApps.Utils.checkLocalServerAsync(this.options),t.useLocalRepository)&&null!=(e=await KatApps.Utils.downloadLocalServerAsync(t.debug.debugResourcesDomain,"/js/dev.ResourceStrings.json"))&&(this.options.resourceStrings=KatApps.Utils.extend(this.options.resourceStrings??{},JSON.parse(e)))}if(null==this.options.manualResults&&null!=this.options.endpoints.manualResults){t=this.getApiUrl(this.options.endpoints.manualResults,!0);try{var i=await fetch(t.url,{method:"GET",headers:{"Cache-Control":"max-age=0"},cache:"default"});if(!i.ok)throw await i.json();var a=await i.json();this.options.manualResults=a[this.selector],KatApps.Utils.trace(this,"KatApp","mountAsync","Manual Results downloaded",TraceVerbosity.Detailed)}catch(t){KatApps.Utils.trace(this,"KatApp","mountAsync","Error downloading manualResults "+this.options.endpoints.manualResults,TraceVerbosity.None,t)}}}initializeInspector(){"0"!=this.options.debug.showInspector&&"1"!=document.body.getAttribute("ka-inspector-init")&&(document.body.setAttribute("ka-inspector-init","1"),document.body.addEventListener("keydown",i=>{if(i.ctrlKey&&i.altKey&&"i"==i.key)if(document.body.classList.contains("ka-inspector"))[...document.body.classList].forEach(t=>{t.startsWith("ka-inspector")&&document.body.classList.remove(t)});else{let t=[{name:"resource",description:"v-ka-resource"},{name:"value",description:"v-ka-value"},{name:"template",description:"v-ka-template"},{name:"for",description:"v-for"},{name:"if",description:"v-if, v-else-if, v-else"},{name:"show",description:"v-show"},{name:"on",description:"v-on:event=, @event="},{name:"bind",description:"v-bind:attribute=, :attribute=, v-bind={ attribute: }"},{name:"html",description:"v-html"},{name:"text",description:"v-text, {{ }}"},{name:"scope",description:"v-scope"},{name:"navigate",description:"v-ka-navigate"},{name:"app",description:"v-ka-app"},{name:"api",description:"v-ka-api"},{name:"modal",description:"v-ka-modal"},{name:"input",description:"v-ka-input"},{name:"input-group",description:"v-ka-input-group"},{name:"no-calc",description:"v-ka-rbl-no-calc",class:"rbl-no-calc"},{name:"exlude",description:"v-ka-rbl-exclude",class:"rbl-exclude"},{name:"unmount",description:"v-ka-unmount-clears-inputs",class:"unmount-clears-inputs"},{name:"needs-calc",description:"v-ka-needs-calc"},{name:"pre",description:"v-pre"},{name:"chart",description:"v-ka-highchart, v-ka-chart"},{name:"attributes",description:"v-ka-attributes"},{name:"inline",description:"v-ka-inline"},{name:"table",description:"v-ka-table"}];var i=()=>{var t="1"!=(KatApps.Utils.pageParameters.showinspector??"1")?KatApps.Utils.pageParameters.showinspector:"resource,value,modal,template,html,text";return prompt(`What do you want to inspect?

Enter a comma delimitted list of names or numbers.

Type 'help' to see available options displayed in the console.`,t)},a=t.map((t,e)=>`${e}. ${t.name} - `+t.description).join("\r\n");let e=i();"help"==e&&(console.log(a),e=i()),e&&(a=e.split(",").map(t=>t.trim()).map(e=>isNaN(+e)?t.find(t=>t.name==e)??{name:e,class:"ka-inspector-"+e}:+e<t.length?t[+e]:void 0),document.body.classList.add("ka-inspector",...a.filter(t=>null!=t).map(t=>"ka-inspector-"+(t.class??t.name))))}}))}createModalContainer(){var t=this.options.modalAppOptions=KatApps.Utils.extend({labels:{cancel:"Cancel",continue:"Continue"},css:{cancel:"btn btn-outline-primary",continue:"btn btn-primary"},showCancel:!0,allowKeyboardDismiss:!0,size:null!=this.options.view?"xl":void 0,scrollable:!1,calculateOnConfirm:!1},this.options.modalAppOptions),e=(t.labels.title=this.getLocalizedString(t.labels.title),t.labels.continue=this.getLocalizedString(t.labels.continue),t.labels.cancel=this.getLocalizedString(t.labels.cancel),t.css.cancel),i=t.css.continue,a=this.options.view??(null!=this.options.modalAppOptions.contentSelector?"selector: "+this.options.modalAppOptions.contentSelector:"static content"),a=`<div v-scope class="modal fade kaModal ${t.css.modal}" tabindex="-1" aria-modal="true" aria-labelledby="kaModalLabel" role="dialog" data-bs-backdrop="static"
	:data-bs-keyboard="application.options.modalAppOptions.allowKeyboardDismiss"
	data-view-name="${a}">
	
	<div class="modal-dialog">
		<div class="modal-content" v-scope="{
				get hasInitializationError() { return application.hasErrors( r => r.initialization ); },
				get title() { return application.getLocalizedString(application.options.modalAppOptions.labels.title); },
				get hasHeaderTemplate() { return application.options.modalAppOptions.headerTemplate != undefined; }
			}">
			<div v-if="uiBlocked" class="ui-blocker"></div>
			<div v-if="title != undefined || hasHeaderTemplate"
				:class="['modal-header', { 'invalid-content': hasInitializationError, 'valid-content': !hasInitializationError }]">
				<h2 id="kaModalLabel" class="modal-title" v-html="title ?? ''"></h2>
				<button v-if="application.options.modalAppOptions.allowKeyboardDismiss != false" type="button" class="btn-close" :aria-label="application.getLocalizedString('Close')"></button>
			</div>
			<div class="modal-body"></div>
			<div class="modal-footer">
				<div v-if="hasInitializationError" class="modal-invalid-footer-buttons text-center d-none">
					<button type="button" :class="['${i}', 'continueButton']">${this.getLocalizedString("Close")}</button>
				</div>
				<div v-if="!hasInitializationError" class="modal-footer-buttons text-center d-none">
					<button v-if="application.options.modalAppOptions.showCancel" type="button" :class="['${e}', 'cancelButton', { disabled: uiBlocked}]">${t.labels.cancel}</button>
					<button type="button" :class="['${i}', 'continueButton', { disabled: uiBlocked}]">${t.labels.continue}</button>
				</div>
			</div>
		</div>
	</div>
</div>`,e=document.createElement("template"),i=(e.innerHTML=a,e.content.firstChild);return t.scrollable&&(i.querySelector(".modal-dialog").classList.add("modal-dialog-scrollable"),i.querySelector(".modal-body").setAttribute("tabindex","0")),null!=t.size&&i.querySelector(".modal-dialog").classList.add("modal-dialog-centered","modal-"+t.size),null!=this.options.modalAppOptions.view?document.querySelector("[ka-id]").after(i):this.options.hostApplication.el.append(i),i}async showModalApplicationAsync(){return new Promise((t,e)=>{if(this.el.classList.contains("show"))return console.log("When this is hit, document why condition is there"),void t(!0);function a(){i=!0,KatApps.HelpTips.hideVisiblePopover(),u.hide(),s.el.remove(),KatApp.remove(s),n.triggerLink?.focus()}let n=this.options.modalAppOptions,s=this,i=!1,r=(n.confirmedAsync=async t=>{var e,i;a(),null!=n.calculateOnConfirm&&(e="boolean"!=typeof n.calculateOnConfirm||n.calculateOnConfirm,i="object"==typeof n.calculateOnConfirm?n.calculateOnConfirm:void 0,e)&&await s.options.hostApplication.calculateAsync(i,!0,void 0,!1),n.promise.resolve({confirmed:!0,data:t instanceof Event?void 0:t,modalApp:s})},n.cancelled=t=>{a(),n.promise.resolve({confirmed:!1,data:t instanceof Event?void 0:t,modalApp:s})},this.hasErrors());var o=null!=n.headerTemplate,l=null!=n.buttonsTemplate;let p=l||(n.showCancel??!0),c=async t=>{i||(t.preventDefault(),r?n.cancelled():null!=n.closeButtonTrigger?s.selectElement(n.closeButtonTrigger).click():p?null!=(t=s.selectElement(".modal-footer-buttons .cancelButton"))?t.click():n.cancelled():null!=(t=s.selectElement(".modal-footer-buttons .continueButton"))?t.click():await n.confirmedAsync())};if(this.selectElements(".modal-invalid-footer-buttons .continueButton, .modal-header.invalid-content .btn-close").forEach(t=>t.addEventListener("click",t=>{t.preventDefault(),n.cancelled()})),o||0==n.allowKeyboardDismiss||this.selectElement(".modal-header.valid-content .btn-close")?.addEventListener("click",c),!l){let t=this.selectElement(".modal-footer-buttons .cancelButton");t?.addEventListener("click",t=>{t.preventDefault(),n.cancelled()}),(t=this.selectElement(".modal-footer-buttons .continueButton"))?.addEventListener("click",async t=>{t.preventDefault(),await n.confirmedAsync()})}this.el.addEventListener("shown.bs.modal",()=>{s.el.querySelectorAll(".modal-footer-buttons, .modal-invalid-footer-buttons").forEach(t=>t.classList.remove("d-none")),t(!0)}),this.el.addEventListener("hide.bs.modal",async t=>{KatApps.HelpTips.hideVisiblePopover()?t.preventDefault():await c(t)});let u=new bootstrap.Modal(this.el);u.show(n.triggerLink),null!=n.triggerLink&&(n.triggerLink.removeAttribute("disabled"),n.triggerLink.classList.remove("disabled","kaModalInit"),document.querySelector("body").classList.remove("kaModalInit")),this.options.hostApplication.unblockUI()})}async navigateAsync(t,e){var i;null!=e?.inputs&&(i=null==t?"navigationInputs:global":e.persistInputs?"navigationInputs:"+t.split("?")[0]+":"+(this.options.userIdHash??"Everyone"):"navigationInputs:"+t.split("?")[0],KatApps.Utils.setSessionItem(this.options,i,e.inputs)),await this.options.delegates.katAppNavigate?.(t)}async calculateAsync(t,i=!0,a,n=!0){var s="1"===t?._iConfigureUI;s||(this.traceStart=this.traceLast=new Date),KatApps.Utils.trace(this,"KatApp","calculateAsync","Start: "+(a??this.calcEngines).map(t=>t.name).join(", "),TraceVerbosity.Detailed);try{let e=this.getApiUrl(this.options.endpoints.calculation,!1);var r,o=e.url,l=await this.getSubmitApiConfigurationAsync(async t=>{await this.triggerEventAsync("updateApiOptions",t,e.endpoint)},t,!0);if(l.configuration.allowLogging=n,!i)return r=(await KatApps.Calculation.calculateAsync(this,o,a??this.calcEngines,l.inputs,l.configuration)).results,this.toTabDefs(r.flatMap(e=>e.tabDefs.map(t=>({calcEngine:e.calcEngine,tabDef:t}))));this.isCalculating=!0,this.blockUI(),this.clearValidations(),this.lastCalculation=void 0;try{var p,c,u,d=l.inputs,h=l.configuration,g=(delete d._iConfigureUI,await this.triggerEventAsync("calculateStart",h)??!0);if(g)return c=(p=await KatApps.Calculation.calculateAsync(this,o,s?this.calcEngines.filter(t=>t.allowConfigureUi):this.calcEngines,d,h)).results,u=this.toTabDefs(c.flatMap(e=>e.tabDefs.map(t=>({calcEngine:e.calcEngine,tabDef:t})))),await this.cacheInputsAsync(d),await this.triggerEventAsync("resultsProcessing",u,d,h),await this.processResultsAsync(u,l),this.lastCalculation={inputs:d,results:u,diagnostics:c.find(t=>null!=t.diagnostics)?c.flatMap(t=>t.diagnostics):void 0,endpointDiagnostics:p.endpointDiagnostics,configuration:h},s||("1"==d.iConfigureUI&&await this.triggerEventAsync("configureUICalculation",this.lastCalculation),await this.triggerEventAsync("calculation",this.lastCalculation)),this.state.needsCalculation=!1,this.options.debug.traceVerbosity=this.nextCalculation.originalVerbosity,this.nextCalculation=void 0,this.lastCalculation.results}catch(t){t instanceof ApiError||(this.addUnexpectedError(t),s)||KatApps.Utils.trace(this,"KatApp","calculateAsync","Exception: "+(t instanceof Error?t.message:t+""),TraceVerbosity.None,t),await this.triggerEventAsync("calculationErrors","SubmitCalculation"+(s?".ConfigureUI":""),t instanceof Error?t:void 0)}finally{s||await this.triggerEventAsync("calculateEnd"),delete this.state.inputs.iInputTrigger,this.isCalculating=!1,this.unblockUI()}}finally{KatApps.Utils.trace(this,"KatApp","calculateAsync","Complete: "+(a??this.calcEngines).map(t=>t.name).join(", "),TraceVerbosity.Detailed)}}async notifyAsync(t,e,i){await this.triggerEventAsync("notification",e,i,t)}checkValidity(){let e=!0;return this.selectElements("input").forEach(t=>{t.checkValidity()||(e=!1)}),e}async apiAsync(e,n,s,t){if(!n?.skipValidityCheck&&!this.checkValidity())throw new ValidityError;this.el.hasAttribute("ka-cloak")||(this.traceStart=this.traceLast=new Date);var r=(n=n??{}).isDownload??!1;this.blockUI(),this.clearValidations();let o=void 0;var i;let l=this.getApiUrl(e,!1);try{var p=t??await this.getSubmitApiConfigurationAsync(async t=>{await this.triggerEventAsync("updateApiOptions",t,l.endpoint)},n.calculationInputs,!1),c=this.calcEngines.find(t=>!t.manualResult);let i=["tables","getNumber","getOptionText"],a=["manualResults","resourceStrings","modalAppOptions","hostApplication","handlers","nextCalculation","delegates","endpoints","intl"];var u={inputs:KatApps.Utils.clone(p.inputs??{},(t,e)=>-1<i.indexOf(t)?void 0:e?.toString()),inputTables:p.inputs.tables?.map(t=>({name:t.name,rows:t.rows})),apiParameters:n.apiParameters,configuration:KatApps.Utils.extend(KatApps.Utils.clone(this.options,(t,e)=>-1<a.indexOf(t)?void 0:e),null!=n.calculationInputs?{inputs:n.calculationInputs}:void 0,null!=c?{calcEngines:[{name:c.name,inputTab:c.inputTab,resultTabs:c.resultTabs,pipeline:c.pipeline}]}:{calcEngines:[]},p.configuration)},d=await this.triggerEventAsync("apiStart",l.endpoint,u,s,n);if("boolean"!=typeof d||d){let i=new FormData;i.append("inputs",JSON.stringify(u.inputs)),null!=u.inputTables&&i.append("inputTables",JSON.stringify(u.inputTables)),null!=u.apiParameters&&i.append("apiParameters",JSON.stringify(u.apiParameters)),i.append("configuration",JSON.stringify(u.configuration)),null!=n.files&&[...n.files].forEach((t,e)=>{i.append("postedFiles["+e+"]",t)});var h,g,m,v=await fetch(l.url,{method:"POST",body:i});if(!v.ok)throw await v.json();if(o=r?await v.blob():void 0,r||(h=await v.text(),o=JSON.parse(""==h?"{}":h)),r){var b=o;let t="Download.pdf";var f=v.headers.get("Content-Disposition");f&&-1!==f.indexOf("attachment")&&(t=f.split("filename=")[1].split(";")[0].replace(/"/g,"")),this.downloadBlob(b,t)}else null!=n.calculateOnSuccess&&(g="boolean"!=typeof n.calculateOnSuccess||n.calculateOnSuccess,m="object"==typeof n.calculateOnSuccess?n.calculateOnSuccess:void 0,g)&&await this.calculateAsync(m,!0,void 0,!1);return r?void 0:(await this.triggerEventAsync("apiComplete",l.endpoint,o,s,n),o)}}catch(t){if(null!=(i=t??{}).errors)for(var a in i.errors)this.addError(a,this.getLocalizedString(i.errors[a][0]),i.errorsDependsOn?.[a]);if(null!=i.warnings)for(var a in i.warnings)this.addWarning(a,this.getLocalizedString(i.warnings[a][0]),i.warningsDependsOn?.[a]);throw this.hasErrors()||0!=this.state.warnings.length||this.addUnexpectedError(i),KatApps.Utils.trace(this,"KatApp","apiAsync","Unable to process "+e,TraceVerbosity.None,i),await this.triggerEventAsync("apiFailed",l.endpoint,i,s,n),new ApiError("Unable to complete API submitted to "+e,t instanceof Error?t:void 0,i)}finally{this.nextCalculation.saveLocations=this.nextCalculation.saveLocations.filter(t=>!t.serverSideOnly),this.unblockUI()}}hasErrors(t){return 0<this.state.errors.length&&(!t||this.state.errors.some(t))}errorIs(t){return 1==this.state.errors.length&&this.state.errors.some(t)}clearValidations(t=0,e){this.state.errors=e?this.state.errors.filter(t=>!e(t)):[],this.clearWarnings(e)}clearWarnings(e){this.state.warnings=e?this.state.warnings.filter(t=>!e(t)):[]}addError(t,e,i,a){this.state.errors.push({id:t,text:e,dependsOn:i,event:a})}addWarning(t,e,i,a){this.state.warnings.push({id:t,text:e,dependsOn:i,event:a})}addUnexpectedError(t){this.addError("System",null!=t.requestId?this.getLocalizedString("KatApps.AddUnexpectedErrorWithRequestId",t,"We apologize for the inconvenience, but we are unable to process your request at this time. The system has recorded technical details of the issue and our engineers are working on a solution.  Please contact Customer Service and provide the following Request ID: {{requestId}}"):this.getLocalizedString("KatApps.AddUnexpectedError",void 0,"We apologize for the inconvenience, but we are unable to process your request at this time. The system has recorded technical details of the issue and our engineers are working on a solution."))}downloadBlob(t,e){var t=window.URL.createObjectURL(t),i=document.createElement("a");i.href=t,i.target="_blank",i.click()}getApiUrl(t,e){var i=this.options.endpoints.calculation.split("?"),t=t.split("?");let a=t[0];a.startsWith("api/")||(a="api/"+a);var t=KatApps.Utils.parseQueryString(2==t.length?t[1]:void 0),n=e?this.options.endpoints.cacheableQueryStrings:this.options.endpoints.anchoredQueryStrings,n=KatApps.Utils.parseQueryString(n??(2==i.length?i[1]:void 0)),i=e?{}:{katapp:this.selector??this.id},s=KatApps.Utils.extend(t,n,i);return Object.keys(s).forEach((t,e)=>{a+=(0==e?"?":"&")+t+"="+s[t]}),{url:this.options.endpoints.baseUrl?this.options.endpoints.baseUrl+a:a,endpoint:a.split("?")[0].substring(4)}}async processDomElementsAsync(){function n(t){null!=t.parentElement&&t.parentElement.classList.add("ui-blocker-wrapper")}for(var t of this.domElementQueue){let e=t=>t.preventDefault(),i=(this.selectElements("a[href='#']").forEach(t=>{t.removeEventListener("click",e),t.addEventListener("click",e)}),KatApps.HelpTips.processHelpTips(t),t=>{t.querySelectorAll("[data-highcharts-chart]").forEach(t=>{Highcharts.charts[+t.getAttribute("data-highcharts-chart")]?.reflow()})}),a=(i(t),t=>{t=t.target,t=this.selectElement(t.getAttribute("data-bs-target"));i(t)});t.querySelectorAll("[data-highcharts-chart]").forEach(t=>{var t=this.closestElement(t,".tab-pane, [role='tabpanel']")?.getAttribute("aria-labelledby");null!=t&&((t=this.selectElement("#"+t))?.removeEventListener("shown.bs.tab",a),t?.addEventListener("shown.bs.tab",a))}),t.classList.contains("ui-blocker")?n(t):t.querySelectorAll(".ui-blocker").forEach(t=>n(t))}var e=[...this.domElementQueue];this.domElementQueue.length=0,this.domElementQueued=!1,await this.triggerEventAsync("domUpdated",e)}getInputValue(t,e=!1){t=this.selectElements("."+t);if(0!=t.length&&(e||!t[0].disabled))return 1<t.length&&"radio"==t[0].getAttribute("type")?null!=(e=t.find(t=>t.checked)?.value)?e+"":void 0:t[0].classList.contains("checkbox-list")?""!=((e=[...t[0].querySelectorAll("input")].filter(t=>t.checked).map(t=>t.value).join(","))??"")?e:void 0:"checkbox"==t[0].getAttribute("type")?t[0].checked?"1":"0":"file"==t[0].getAttribute("type")?1<(e=t[0].files?.length??1)?e+" files selected":t[0].value.replace(/\\/g,"/").replace(/.*\//,""):t[0].value}setInputValue(t,i,e=!1){null==i?delete this.state.inputs[t]:this.state.inputs[t]="boolean"==typeof i?i?"1":"0":i;let a=this.selectElements("."+t);if(0<a.length){t=a[0].classList.contains("checkbox-list");if(0<a.length&&"radio"==a[0].getAttribute("type"))a.forEach(t=>t.checked=t.value==i);else if(t){let e=i?.split(",");(a=[...a[0].querySelectorAll("input")]).forEach(t=>{t.checked=null!=e&&-1<e.indexOf(t.value)})}else"checkbox"==a[0].getAttribute("type")?a[0].checked="boolean"==typeof i?i:"1"==i:a[0].value=i??"";"range"==a[0].getAttribute("type")&&a[0].dispatchEvent(new Event("rangeset.ka")),e&&a[0].dispatchEvent(new Event("change"))}return a}getInputs(t){t=KatApps.Utils.extend({},this.state.inputs,t);return delete t.getNumber,delete t.getOptionText,t}getKatAppId(t){if(t.hasAttribute("ka-id"))return t.getAttribute("ka-id")??void 0;let e=t;for(;(e=e.parentElement)&&e!==document;)if(e.hasAttribute("ka-id"))return e.getAttribute("ka-id")}getTargetItems(t,e){return null==t?[]:"string"==typeof t?this.selectElements(t,e):t instanceof EventTarget?[t]:t instanceof NodeList?[...t]:t}on(t,e,i,a){t=new KatAppEventFluentApi(this.getTargetItems(t,a));return t.on(e,i),t}off(t,e,i){t=new KatAppEventFluentApi(this.getTargetItems(t,i));return t.off(e),t}selectorSplitter=/("[^"]*"|'[^']*'|[^,])+/g;inputSelectorRegex=/(.*?)(:input)((?:\[[^\]]*\]|[^\[\],])*)(?=(,|$))/g;psuedoInputTypes=["input","textarea","select","button"];replaceInputSelector(t){var e;if(-1!=t.indexOf(":input"))for(e of t.match(this.selectorSplitter).map(t=>t.trim())){var i=e.replace(this.inputSelectorRegex,(t,e,i,a)=>{let n=e.replace(/^,?\s*/,"");return this.psuedoInputTypes.map(t=>""+n+t+a).join(", ")});t=t.replace(e,i)}return t}selectElement(t,e){var i=e??this.el,t=i.querySelector(this.replaceInputSelector(t))??void 0;return null==t||null!=e||(e=this.getKatAppId(i),this.getKatAppId(t)==e)?t:void 0}selectElements(t,e){var i,a=e??this.el,t=[...a.querySelectorAll(this.replaceInputSelector(t))];return null!=e?t:(i=this.getKatAppId(a),t.filter(t=>this.getKatAppId(t)==i))}closestElement(t,e){t=t.closest(e)??void 0;return(null!=t?this.getKatAppId(t):void 0)==this.id?t:void 0}getResourceString(t){var e=this.options.intl.currentUICulture??"en-us",i=this.options.resourceStrings?.["en-us"],a=this.options.resourceStrings?.en,n=this.options.resourceStrings?.[e],e=this.options.resourceStrings?.[e.split("-")[0]],n=n?.[t]??e?.[t],e=n??i?.[t]??a?.[t];return null==e?this.missingResources.push(t):null==n&&this.missingLanguageResources.push(t),"object"==typeof e?e.text:e}getLocalizedString(t,e,i){if(null==(t=t?.replaceAll("<<","{{").replaceAll(">>","}}")))return i;t.startsWith("{")&&t.endsWith("}")&&(t=(e=new Function(`{return (${t})}`)()).key);var a=null!=e&&Object.keys(e).some(t=>"key"!=t);let n=this.getResourceString(t);var s=3==arguments.length?i:t;if(null==n&&null==i&&-1<t.indexOf("^")){i=t.split("^"),t=this.getResourceString(i[0])??i[0];let a=i.slice(1);var r,o=/(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})(?:T.*)?/,l=/^-?\d+(\.\d+)?$/,i=/\{(\d+)(?::([^{}]+))?\}/g;for(r of t.matchAll(i)){var p=+r[1],c=a[p],u=String(c).match(o);null!=u?a[p]=new Date(parseInt(u.groups.year),parseInt(u.groups.month)-1,parseInt(u.groups.day)):l.test(c)&&(u=parseFloat(c),isNaN(u)||(a[p]=u))}n=t.replace(i,(t,e,i)=>{e=a[+e];if(i){if("number"!=typeof e)return KatApps.Utils.formatDate(this.options.intl.currentCulture,e,i);if(i.startsWith("p"))return KatApps.Utils.formatPercent(this.options.intl.currentCulture,e,i);if(i.startsWith("c")||i.startsWith("n")||i.startsWith("f"))return KatApps.Utils.formatNumber(this.options.intl,e,i);throw new Error(`Invalid getLocalizedString format string: ${i}, value: `+e)}return String(e)})}t=n??s;return null!=t?a?String.formatTokens(this.options.intl,t,e?.keyValueObject??e):t:void 0}getTemplateContent(t){t=this.getTemplateId(t);return document.querySelector(t).content}getTemplateId(e){let i;for(let t=0;t<this.viewTemplates.length;t++){var a="#"+e+"_"+this.viewTemplates[t].replace(/\//g,"_");if(null!=document.querySelector(a)){i=a;break}}return null==(i=null==i&&null!=this.options.hostApplication?this.options.hostApplication.getTemplateId(e):i)&&KatApps.Utils.trace(this,"KatApp","getTemplateId",`Unable to find template: ${e}.`,TraceVerbosity.Normal),i}get nextCalculation(){let t=this;for(;null!=t.options.hostApplication;)t=t.options.hostApplication;return KatApps.Utils.getSessionItem(t.options,"debugNext:"+t.selector)??{saveLocations:[],expireCache:!1,trace:!1,originalVerbosity:t.options.debug.traceVerbosity}}set nextCalculation(t){let e=this;for(;null!=e.options.hostApplication;)e=e.options.hostApplication;var i="debugNext:"+e.selector;null==t?KatApps.Utils.removeSessionItem(e.options,i):KatApps.Utils.setSessionItem(e.options,i,t)}debugNext(t,i,e,a){var n=this.nextCalculation;if("boolean"==typeof t)t||(n.saveLocations=[]);else if(""!=(t??"")){let e=t.split(",").map(t=>t.trim());n.saveLocations=[...n.saveLocations.filter(t=>-1==e.indexOf(t.location)),...e.map(t=>({location:t,serverSideOnly:i??!1}))]}n.trace=e??!1,n.trace&&(this.options.debug.traceVerbosity=TraceVerbosity.Detailed),n.expireCache=a??!1,this.nextCalculation=n}blockUI(){this.uiBlockCount++,this.state.uiBlocked=!0}unblockUI(){this.uiBlockCount--,this.uiBlockCount<=0&&(this.uiBlockCount=0,this.state.uiBlocked=!1)}allowCalculation(e,t){var i=this.calcEngines.find(t=>t.key==e);null!=i&&(i.enabled=t)}cloneOptions(t){let i=["handlers","view","content","modalAppOptions","hostApplication"].concat(t?[]:["manualResults"]);return KatApps.Utils.clone(this.options,(t,e)=>-1<i.indexOf(t)?void 0:e)}getCloneHostSetting(t){let e=t.hasAttribute("v-pre");return e=e&&""!=(t=t.getAttribute("v-pre")??"")?t:e}async showModalAsync(n,s){let r=!1,o;if(null!=n.contentSelector){await PetiteVue.nextTick();var t=this.selectElement(n.contentSelector);if(null==t)throw new Error(`The content selector (${n.contentSelector}) did not return any content.`);n.buttonsTemplate??=t.getAttribute("data-button-template")??void 0,r=this.getCloneHostSetting(t),o=t.cloneWithEvents()}if(null==o&&null==n.content&&null==n.view)throw new Error("You must provide content or viewId when using showModal.");if(null!=document.querySelector(".kaModal"))throw new Error("You can not use the showModalAsync method if you have markup on the page already containing the class kaModal.");this.blockUI(),null!=s&&(s.setAttribute("disabled","true"),s.classList.add("disabled","kaModalInit"),document.querySelector("body").classList.add("kaModalInit"));try{var e=KatApp.get(".kaModal");return null!=e&&KatApp.remove(e),new Promise(async(t,e)=>{let i=["content","view"];t={view:n.view,content:o??n.content,currentPage:n.view??this.options.currentPage,hostApplication:this.selector.startsWith("#popover")?this.options.hostApplication:this,cloneHost:r,modalAppOptions:KatApps.Utils.extend({promise:{resolve:t,reject:e},triggerLink:s},KatApps.Utils.clone(n,(t,e)=>-1<i.indexOf(t)?void 0:e)),inputs:{iModalApplication:"1"}};let a=KatApps.Utils.extend(t.hostApplication.cloneOptions(null==t.content||!1!==r),t,null!=n.inputs?{inputs:n.inputs}:void 0);null!=a.endpoints.anchoredQueryStrings&&null!=a.inputs&&(a.endpoints.anchoredQueryStrings=KatApps.Utils.generateQueryString(KatApps.Utils.parseQueryString(a.endpoints.anchoredQueryStrings),t=>!t.startsWith("ki-")||null==a.inputs["i"+t.split("-").slice(1).map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join("")])),delete a.inputs.iNestedApplication,await KatApp.createAppAsync(".kaModal",a)})}catch(t){throw this.unblockUI(),null!=s&&(s.removeAttribute("disabled"),s.classList.remove("disabled","kaModalInit"),document.querySelector("body").classList.remove("kaModalInit")),t}}async cacheInputsAsync(t){var e;this.options.inputCaching&&(e="cachedInputs:"+this.options.currentPage+":"+(this.options.userIdHash??"EveryOne"),t=KatApps.Utils.clone(t),await this.triggerEventAsync("inputsCached",t),KatApps.Utils.setSessionItem(this.options,e,t))}async getSubmitApiConfigurationAsync(t,e,i=!1){e=this.getInputs(e),null==e.tables&&(e.tables=[]),e={inputs:e,configuration:{},isCalculation:i},await t(e),t=this.options,t={token:void 0,nextCalculation:this.nextCalculation,authID:"NODATA",adminAuthID:void 0,client:t.dataGroup??"KatApp",testCE:t.debug?.useTestCalcEngine??!1,currentPage:t.currentPage??"KatApp:"+(t.view??"UnknownView"),requestIP:t.requestIP??"1.1.1.1",currentCulture:t.intl.currentCulture??"en-US",currentUICulture:t.intl.currentUICulture??"en-US",environment:t.environment??"EW.PROD",allowLogging:!0};return{inputs:e.inputs,configuration:KatApps.Utils.extend(t,e.configuration),isCalculation:i}}getCeName(t){return t?.split(".")[0].replace("_Test","")??""}toCalcEngines(t){if(null==t)return[];{let n={};t.forEach(t=>{var e=t["@calcEngineKey"];if(null==e)throw new Error("manualResults requires a @calcEngineKey attribute specified.");let i=this.getCeName(t["@calcEngine"]??t["@calcEngineKey"]),a=(null!=this.calcEngines.find(t=>!t.manualResult&&t.name.toLowerCase()==i.toLowerCase())&&(i="Manual."+i),null==n[i]&&(n[i]={ceKey:e,tabs:[]}),t["@name"]);null==a&&(a=t["@name"]="RBLResult"+(n[i].tabs.length+1)),n[i].tabs.push(a)});var e,i=[];for(e in n){var a=n[e],a={key:a.ceKey,name:e,inputTab:"RBLInput",resultTabs:a.tabs,manualResult:!0,allowConfigureUi:!0,enabled:!0};i.push(a)}return i}}toTabDefs(t){let n=this.calcEngines,s=n[0].key;return t.map(t=>{let e=t.tabDef,i=this.getCeName(t.calcEngine);t=n.find(t=>t.name.toLowerCase()==i.toLowerCase()),null==t&&KatApps.Utils.trace(this,"KatApp","toTabDefs",`Unable to find calcEngine: ${i}.  Determine if this should be supported.`,TraceVerbosity.None),t=t?.key??s;let a={_ka:{calcEngineKey:t,name:e["@name"]}};return Object.keys(e).forEach(t=>{t.startsWith("@")?a[t]=e[t]:a[t]=e[t]instanceof Array?e[t]:[e[t]]}),a})}copyTabDefToRblState(t,e,i,a){KatApps.Utils.trace(this,"KatApp","copyTabDefToRblState",`Copy ${i.length} rows from ${t}.${e}.`+a,TraceVerbosity.Diagnostic);t=t+"."+e;null==this.state.rbl.results[t]&&(this.state.rbl.results=Object.assign({},this.state.rbl.results,{[t]:{}})),this.state.rbl.results[t]=Object.assign({},this.state.rbl.results[t],{[a]:i})}mergeTableToRblState(t,e,i,a){KatApps.Utils.trace(this,"KatApp","mergeTableToRblState",`Merge ${i.length} rows from ${t}.${e}.`+a,TraceVerbosity.Diagnostic),"_ResultProcessing"==t&&0<this.calcEngines.length&&(t=this.calcEngines[0].key,e=this.calcEngines[0].resultTabs[0]);let n=t+"."+e;null==this.state.rbl.results[n]&&(this.state.rbl.results=Object.assign({},this.state.rbl.results,{[n]:{}})),null==this.state.rbl.results[n][a]&&(this.state.rbl.results[n]=Object.assign({},this.state.rbl.results[n],{[a]:[]})),i.forEach(e=>{"rbl-skip"==a&&(e.id=e.key,null==e.value)&&(e.value="1");var t=this.state.rbl.results[n][a].findIndex(t=>t.id==e.id);-1<t?this.state.rbl.results[n][a].splice(t,1,Object.assign({},this.state.rbl.results[n][a][t],e)):this.state.rbl.results[n][a].splice(this.state.rbl.results[n][a].length,0,e)})}async processResultsAsync(t,e){KatApps.Utils.trace(this,"KatApp","processResultsAsync","Start: "+t.map(t=>t._ka.calcEngineKey+"."+t._ka.name).join(", "),TraceVerbosity.Detailed);let s=(t,a,e)=>{if("object"==typeof t[a]){KatApps.Utils.trace(this,"KatApp","processResultColumn",`Convert ${a} from object to string.`,TraceVerbosity.Diagnostic);var n=t;let e=n[a],i=n["@"+a]={};Object.keys(e).filter(t=>"#text"!=t).forEach(t=>{i[t.substring(1)]=e[t]}),t[a]=e["#text"]??""}n=t[a];e&&""==n&&"true"!=t["@"+a]?.["@text-forced"]&&(t[a]=void 0),null!=n||e||(t[a]="")},a=["rbl-disabled","rbl-display","rbl-skip","rbl-value","rbl-listcontrol","rbl-input"],r=new Map;if(t.forEach(n=>{Object.keys(n).filter(t=>!t.startsWith("@")&&"_ka"!=t&&"ItemDefs"!=t).forEach(a=>{var e=n[a]??[];if(0<e.length){let i="rbl-input"==a,t=Object.keys(e[0]);e.forEach(e=>{switch(t.forEach(t=>s(e,t,i)),a){case"rbl-defaults":this.setInputValue(e.id,e.value);break;case"rbl-input":null!=e.value&&this.setInputValue(e.id,e.value),""!=(e.error??"")&&this.addError(e.id,this.getLocalizedString(e.error),e.dependsOn),""!=(e.warning??"")&&this.addWarning(e.id,this.getLocalizedString(e.warning),e.dependsOn);break;case"errors":e.text=this.getLocalizedString(e.text),this.addError(e.id,e.text,e.dependsOn,e.event);break;case"warnings":e.text=this.getLocalizedString(e.text),this.addWarning(e.id,e.text,e.dependsOn,e.event);break;case"table-output-control":"-1"!=e.export&&"1"!=e.export||null!=n[e.id]||this.copyTabDefToRblState(n._ka.calcEngineKey,n._ka.name,[],e.id);break;case"rbl-expression":null!=e.id&&null!=e.value&&r.set(e.id,e.value)}})}}),(n["rbl-input"]??[]).filter(t=>""!=(t.list??"")).map(t=>({input:t.id,list:t.list})).concat((n["rbl-listcontrol"]??[]).map(t=>({input:t.id,list:t.table}))).forEach(t=>{var e,i;null!=n[t.list]&&(e=n[t.list].map(t=>t.key),i=this.state.inputs[t.input],-1==e.indexOf(i??""))&&delete this.state.inputs[t.input]})}),this.state.rbl.expressions={value(t){},number(t){return 0},boolean(t,e){return e??!0}},0<r.size){var n=t=>{let i=[];t.forEach((t,e)=>{i.push(`  get ${e}() { try { with($state) { return ${t}; } } catch(e) { _trace("Runtime error in expression '${e}': " + e); return undefined; } }`)});t=["  value(id) { try { const v = this[id]; return v != undefined ? String(v) : undefined; } catch(e) { return undefined; } }","  number(id) { const v = +(this.value(id) ?? 0); return isNaN(v) ? 0 : v; }","  boolean(id, valueWhenMissing) { const v = this.value(id); if (v == undefined) return valueWhenMissing ?? true; const s = String(v).toLowerCase(); return ['false','0','n','no'].indexOf(s) == -1; }"],t=`return {
${[...i,...t].join(",\n")}
}`;return new Function("$state","_trace",t)(this.state,t=>KatApps.Utils.trace(this,"KatApp","rbl.expressions",t,TraceVerbosity.None))};try{this.state.rbl.expressions=n(r)}catch(t){let i=new Map;r.forEach((t,e)=>{try{new Function("$state",`with($state){return ${t}}`),i.set(e,t)}catch(t){KatApps.Utils.trace(this,"KatApp","processResultsAsync",`rbl-expression compile error for '${e}': `+t,TraceVerbosity.None)}}),0<i.size&&(this.state.rbl.expressions=n(i))}}let i=e=>{t.forEach(i=>{Object.keys(i).filter(t=>!(t.startsWith("@")||"_ka"==t||"ItemDefs"==t||(t=`${i._ka.calcEngineKey}.${i._ka.name}.`+t,t=this.pushToTables.indexOf(t),!e&&-1<t)||e&&-1==t)).forEach(t=>{var e=i[t]??[];-1==a.indexOf(t)?this.copyTabDefToRblState(i._ka.calcEngineKey,i._ka.name,e,t):this.mergeTableToRblState(i._ka.calcEngineKey,i._ka.name,e,t)})})};i(!1),await PetiteVue.nextTick(()=>{i(!0)}),this.pushToTables=[],await this.processDataUpdateResultsAsync(t,e),this.processDocGenResults(t),KatApps.Utils.trace(this,"KatApp","processResultsAsync","Complete: "+t.map(t=>t._ka.calcEngineKey+"."+t._ka.name).join(", "),TraceVerbosity.Detailed)}async processDataUpdateResultsAsync(t,e){let i={DataTokens:[]};t.forEach(t=>{(t["jwt-data"]??[]).filter(t=>"data-updates"==t.id).forEach(t=>{i.DataTokens.push({Name:t.id,Token:t.value})})}),0<i.DataTokens.length&&(KatApps.Utils.trace(this,"KatApp","processDataUpdateResultsAsync",`Start (${i.DataTokens.length} jwt-data items)`,TraceVerbosity.Detailed),await this.apiAsync(this.options.endpoints.jwtDataUpdates,{apiParameters:i},void 0,e),KatApps.Utils.trace(this,"KatApp","processDataUpdateResultsAsync","Complete",TraceVerbosity.Detailed))}processDocGenResults(t){t=t.flatMap(t=>(t["api-actions"]??[]).filter(t=>"DocGen"==t.action));0<t.length&&(KatApps.Utils.trace(this,"KatApp","processDocGenResults",`Start (${t.length} DocGen items)`,TraceVerbosity.Detailed),t.forEach(t=>{var e=t["file-name"];null!=t.exception?KatApps.Utils.trace(this,"KatApp","processDocGenResults",`DocGen Instruction Exception: ${e??"File Not Availble"}, ${t.exception})`,TraceVerbosity.None):(t=((t,e="application/octet-stream",i=1024)=>{var a=atob(t),n=a.length,s=Math.ceil(n/i),r=new Array(s);for(let t=0;t<s;++t){var o=t*i,l=Math.min(o+i,n),p=new Array(l-o);for(let t=o,e=0;t<l;++e,++t)p[e]=a[t].charCodeAt(0);r[t]=new Uint8Array(p)}return new Blob(r,{type:e})})(t.content,t["content-type"]),this.downloadBlob(t,e))}),KatApps.Utils.trace(this,"KatApp","processDocGenResults","Complete",TraceVerbosity.Detailed))}async getViewElementAsync(){var t=document.createElement("div");if((null!=this.options.modalAppOptions||"1"==this.options.inputs?.iNestedApplication)&&null!=this.options.view){var e=this.options.view,i=this.getApiUrl(this.options.endpoints.kamlVerification+"?applicationId="+e,!0);try{var a=await fetch(i.url,{method:"GET"});if(!a.ok)throw await a.json();var n=await a.json();KatApps.Utils.extend(this.options,{view:n.path,currentPath:e}),KatApps.Utils.extend(this.state.inputs,n.manualInputs)}catch(t){throw KatApps.Utils.trace(this,"KatApp","getViewElementAsync","Error verifying KatApp "+e,TraceVerbosity.None,t),new KatApps.KamlResourceDownloadError("View verification request failed.",e)}}if(null!=this.options.view){i=await KatApps.KamlRepository.getViewResourceAsync(this),a=(KatApps.Utils.trace(this,"KatApp","getViewElementAsync","Resource Returned",TraceVerbosity.Detailed),i[this.options.view].replace(/{id}/g,this.id).replace(/thisApplication/g,this.applicationCss));if(t.innerHTML=a,1!==t.querySelectorAll("rbl-config").length)throw new Error("View "+this.options.view+" is missing rbl-config element");new KatApps.KamlCompiler(this).compileMarkup(t,this.id),KatApps.Utils.trace(this,"KatApp","getViewElementAsync","Markup Processed",TraceVerbosity.Detailed)}else if(null==this.options.content)return;return t}async getViewTemplatesAsync(t){let e=(t.querySelector("rbl-config")?.getAttribute("templates")?.split(",")??[]).map(t=>{let e=(1<t.split(":").length?t:"Global:"+t).split("?")[0];return e.endsWith(".kaml")||(e+=".kaml"),e}),i=await KatApps.KamlRepository.getTemplateResourcesAsync(this,e),a=new KatApps.KamlCompiler(this);return Object.keys(i).forEach(t=>{var e=document.createElement("kaml-template");e.innerHTML=i[t],a.compileMarkup(e,t.replace(/\./g,"_")),KatApps.KamlRepository.resolveTemplate(t)}),e.map(t=>{t=t.split(":");return t[t.length-1].split("?")[0].replace(/\./g,"_")})}getSessionStorageInputs(){var t="cachedInputs:"+this.options.currentPage+":"+(this.options.userIdHash??"EveryOne"),t=KatApps.Utils.getSessionItem(this.options,t),e="navigationInputs:"+this.options.currentPage,e=KatApps.Utils.getSessionItem(this.options,e,!0),i="navigationInputs:"+this.options.currentPage+":"+(this.options.userIdHash??"Everyone"),i=KatApps.Utils.getSessionItem(this.options,i);return KatApps.Utils.extend({},t,i,e)}}class ApiError extends Error{innerException;apiResponse;constructor(t,e,i){super(t),this.innerException=e,this.apiResponse=i}}class ValidityError extends Error{constructor(){super("checkValidity failed on one or more inputs")}}class CalculationError extends Error{failures;constructor(t,e){super(t),this.failures=e}}var KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,TraceVerbosity,KatApps,KatApps,KatApps;(y=>{y.Calculation=class{static async calculateAsync(i,a,e,n,t){y.Utils.trace(i,"Calculation","calculateAsync","Start",TraceVerbosity.Detailed);let s=y.Utils.extend({},t,{calcEngines:e.filter(t=>!t.manualResult&&t.enabled).map(t=>({name:t.name,inputTab:t.inputTab,resultTabs:t.resultTabs,pipeline:t.pipeline?.map(t=>({name:t.name,inputTab:t.inputTab,resultTab:t.resultTab}))}))}),r=["tables","getNumber","getOptionText"];t={inputs:y.Utils.clone(n,(t,e)=>-1<r.indexOf(t)?void 0:e?.toString()),inputTables:n.tables?.map(t=>({name:t.name,rows:t.rows})),configuration:s};let o=[],l=[];try{y.Utils.trace(i,"Calculation","calculateAsync","Posting Data",TraceVerbosity.Detailed);for(var p=await this.submitCalculationAsync(i,a,n,t),c=p.results.filter(t=>null!=t.cacheKey&&null==t.result),u=0;u<c.length;u++){let t=p.results[u];var d=await this.getCacheAsync(i.options,"RBLCache:"+t.cacheKey,i.options.delegates.decryptCache);null==d?y.Utils.trace(i,"Calculation","calculateAsync",`Cache miss for ${t.calcEngine} with key `+t.cacheKey,TraceVerbosity.Detailed):(y.Utils.trace(i,"Calculation","calculateAsync","Use cache for "+t.calcEngine,TraceVerbosity.Detailed),t.cacheKey=void 0,t.result=d)}var h=p.results.filter(t=>null!=t.cacheKey&&null==t.result);if(0<h.length){let e=h.map(t=>t.calcEngine);t.configuration.calcEngines=t.configuration.calcEngines.filter(t=>-1<e.indexOf(t.name)),t.configuration.invalidCacheKeys=h.map(t=>t.cacheKey);for(var g=await this.submitCalculationAsync(i,a,n,t),u=0;u<g.results.length;u++){let e=g.results[u];var m=p.results.findIndex(t=>t.calcEngine==e.calcEngine);p.results[m]=e}}0<p.results.filter(t=>null!=t.cacheKey&&null==t.result).length&&y.Utils.trace(i,"Calculation","calculateAsync","Client side cache is invalid.",TraceVerbosity.Detailed);for(u=0;u<p.results.length;u++){var v=p.results[u],b=v.cacheKey;null!=b&&(null!=v.result.exception?(y.Utils.trace(i,"Calculation","calculateAsync","(RBL exception) Remove cache for "+v.calcEngine,TraceVerbosity.Detailed),y.Utils.removeSessionItem(i.options,"RBLCache:"+b)):(y.Utils.trace(i,"Calculation","calculateAsync","Set cache for "+v.calcEngine,TraceVerbosity.Detailed),await this.setCacheAsync(i.options,"RBLCache:"+b,v.result,i.options.delegates.encryptCache)))}var f=p;if(f.results.filter(t=>null!=t.result.exception).forEach(t=>{t={calcEngine:t.calcEngine,diagnostics:t.result.diagnostics,configuration:s,inputs:n,exceptions:[{message:t.result.exception.message,type:t.result.exception.type,traceId:t.result.exception.traceId,requestId:t.result.exception.requestId,stackTrace:t.result.exception.stackTrace}]};o.push(t)}),f.results.filter(t=>null==t.result.exception).forEach(t=>{var e=t.result.RBL.Profile.Data.TabDef;l.push({calcEngine:t.calcEngine,diagnostics:t.result.diagnostics,tabDefs:e instanceof Array?e:[e]})}),0<o.length)throw new CalculationError("Unable to complete calculation(s)",o);return{results:l,endpointDiagnostics:p.endpointDiagnostics}}catch(t){if(t instanceof CalculationError)throw t;e={message:t instanceof Error?t.message:t+"Unable to submit Calculation to "+a,type:t instanceof Error?t.name:"Error",stackTrace:t instanceof Error?t.stack?.split("\n")??["No stack available"]:["Calculation.calculateAsync (rest is missing)"]};throw t instanceof Error||(console.error("Original calculation exception (should have been instanceof Error):"),console.error({e:t})),new CalculationError("Unable to complete calculation(s)",[{calcEngine:s.calcEngines.map(t=>t.name).join(", "),inputs:n,configuration:s,exceptions:[e]}])}}static async submitCalculationAsync(i,a,n,s){try{var t=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then(async t=>{var e=await t.text(),e=""==e?void 0:JSON.parse(e);if(t.ok)return e;throw e??{exceptions:[{message:"No additional details available."}]}});return y.Utils.trace(i,"Calculation","calculateAsync","Received Success Response",TraceVerbosity.Detailed),t}catch(t){let e=t;a=e.exceptions??[e],i={calcEngine:s.configuration.calcEngines.map(t=>t.name).join(", "),configuration:s.configuration,inputs:n,exceptions:a.map(t=>({message:t.message,type:t.type??"Unknown type",traceId:t.traceId,requestId:t.requestId,stackTrace:t.stackTrace,apiResult:e.apiResult,apiPayload:e.apiPayload,innerException:t.innerException}))};throw new CalculationError("Unable to complete calculation(s)",[i])}}static async setCacheAsync(t,e,i,a){a=a(i);a instanceof Promise&&(a=await a),y.Utils.setSessionItem(t,e,a)}static async getCacheAsync(e,t,i){e=y.Utils.getSessionItem(e,t);if(null!=e){let t=i(e);return t=t instanceof Promise?await t:t}}}})(KatApps=KatApps||{}),(()=>{class e{static templateRenderedCount={};getRenderedId(t){if(null!=t)return e.templateRenderedCount[t]=null==e.templateRenderedCount[t]?1:e.templateRenderedCount[t]+1,t.substring(1)+"_"+e.templateRenderedCount[t]}}(KatApps||(KatApps={})).TemplateBase=e})(),!function(E){class c extends E.TemplateBase{static stringCache=Object.create(null);static cacheStringFunction=e=>t=>this.stringCache[t]??(this.stringCache[t]=e(t));addValidityValidation(t,e,i,a){null==a.validationMessage||""==a.validationMessage||t.hasErrors(t=>-1!=t.id.replace(/ /g,"").split(",").indexOf(e))||t.addError(e,i(e)+": "+a.validationMessage)}removeValidations(t,e){t.clearValidations(!0,t=>!(("input"==t.event||-1==t.id.replace(/ /g,"").split(",").indexOf(e))&&-1==(t.dependsOn??"").replace(/ /g,"").split(",").indexOf(e)))}validationText(t,e,i){e=e.find(t=>-1<t.id.replace(/ /g,"").split(",").indexOf(i));return null!=e?t.getLocalizedString(e.text):void 0}errorText(t,e){return this.validationText(t,t.state.errors,e)}warningText(t,e){return this.validationText(t,t.state.warnings,e)}unmounted(t,e,i){(i||e.hasAttribute("ka-unmount-clears-inputs")||null!=e.closest("[ka-unmount-clears-inputs]"))&&null!=(i=e.getAttribute("name"))&&delete t.state.inputs[i]}mounted(r,o,l,t,p,e,c,u,d,h,g,m,v,b,f){if(p.setAttribute("name",l),p.classList.add(l),p.isConnected){var y=p.getAttribute("type"),A="radio"==y&&p.hasAttribute("checked")?p.getAttribute("value"):void 0,k="checkbox"==y?p.hasAttribute("checked")?"1":"0":void 0,x="text"==y?p.getAttribute("value"):void 0;let i=c||p.hasAttribute("ka-rbl-exclude")||null!=r.closestElement(p,"[ka-rbl-exclude]"),a=p.hasAttribute("ka-rbl-no-calc")||null!=r.closestElement(p,"[ka-rbl-no-calc]"),n=(i||(c=e(l)??k??A??x,null==r.state.inputs[l]&&null!=c&&(r.state.inputs[l]=c),null!=(c=r.state.inputs[l])&&r.setInputValue(l,c)),()=>this.removeValidations(r,l)),s;e=async(t,e=!1)=>{n(),i||(r.state.lastInputChange=Date.now(),r.state.inputsChanged=!0,r.state.inputs[l]=r.getInputValue(l),a)||u(l)||(t?(r.state.inputs.iInputTrigger=l,s&&clearTimeout(s),s=setTimeout(async()=>{await r.calculateAsync(void 0,!0,void 0,!1)},e?750:0)):r.state.needsCalculation=!0),await r.triggerEventAsync("input",l,t,p,o)};"date"==y?this.bindDateEvents(r,l,t,p,n,e):"range"==y?this.bindRangeEvents(r,l,p,f,d,e):this.bindInputEvents(r,l,t,p,y,h,g,m,v,e),this.bindCustomEvents(r,p,b,o)}else E.Utils.trace(r,"InputComponent","mounted",`Skipping input mount on ${l} because the input is not connected, consider the order of model properties being set.`,TraceVerbosity.Diagnostic)}bindInputEvents(c,u,e,o,t,i,d,h,a,n){if(o.addEventListener("change",async()=>n(!0)),"file"!=t&&"checkbox"!=t&&"SELECT"!=o.tagName&&(o.addEventListener("input",async()=>n(!1)),o.addEventListener("blur",()=>{c.isCalculating||(c.state.needsCalculation=!1)}),"radio"!=t)&&"INPUT"==o.tagName){o.addEventListener("invalid",t=>this.addValidityValidation(c,u,e,t.target));t=a(u);if(null!=t){let e=new RegExp(`[${t}]`),i=(o.addEventListener("beforeinput",t=>{"insertText"!=t.inputType||null==t.data||e.test(t.data)||t.preventDefault()}),new RegExp(`[^${t}]`,"g"));o.addEventListener("input",t=>{t=t.target;c.setInputValue(u,t.value=t.value.replace(i,""),!1)})}if(i){let l=function(t){var e=t.startsWith("-"),t=t.substring(e?7:6),t=""!=t?+t:2,i=c.options.intl.currencyDecimalSeparator,a=0<t?"\\"+i:"";return{allowNegative:e,decimalPlaces:t,currencySeparator:i,keypressRegEx:new RegExp(`[0-9${e?"\\-":""}${a}]`,"g"),inputRegEx:new RegExp(`[^0-9${a}]+`,"g")}},p=(o.addEventListener("keypress",t=>{var e=t.target,i=d(u);switch(null!=i&&-1<i.indexOf("number")?"number":i){case"email":(null===t.key.match(/[A-Za-z0-9.@_-]/)||"@"==t.key&&-1<e.value.indexOf("@"))&&t.preventDefault();break;case"zip+4":case"#####-####":o.setAttribute("maxlength","10"),(null===t.key.match(/[0-9\-]/)||"-"==t.key&&5!=o.value.length)&&t.preventDefault();break;case"number":var a=l(i),n=e.selectionStart,s=e.selectionEnd,r=null!=n&&null!=s&&n!=s?o.value.substring(0,n)+o.value.substring(s):o.value;(null===t.key.match(a.keypressRegEx)||t.key==a.currencySeparator&&(-1<r.indexOf(a.currencySeparator)||""==o.value)||"-"==t.key&&(0!=n||-1<r.indexOf("-"))||0<a.decimalPlaces&&t.key!=a.currencySeparator&&"-"!=t.key&&2==(s=(n!=s?r:o.value.substring(0,n)+t.key+o.value.substring(n)).split(a.currencySeparator)).length&&s[1].length>a.decimalPlaces)&&t.preventDefault();break;case"cc-expire":case"MM/YY":o.setAttribute("maxlength","5"),(null===t.key.match(/[0-9\/]/)||"/"==t.key&&2!=o.value.length)&&t.preventDefault();break;case"phone":case"(###) ###-####":o.setAttribute("maxlength","14"),(null===t.key.match(/[0-9\(\)\-\s]/)||"("==t.key&&""!=o.value||")"==t.key&&4!=o.value.length||"-"==t.key&&9!=o.value.length||" "==t.key&&5!=o.value.length)&&t.preventDefault();break;default:o.setAttribute("maxlength",h(u).toString())}}),new RegExp("[^A-Za-z0-9.@_-]","g"));o.addEventListener("input",t=>{var i=t.target,a=d(u)??"",e=i.selectionStart,n="deleteContentBackward"==t.inputType,t="deleteContentForward"==t.inputType;if(!n||e!=i.value.length){switch(null!=a&&-1<a.indexOf("number")?"number":a){case"email":c.setInputValue(u,i.value=i.value.replace(p,""));break;case"zip+4":case"#####-####":{i.setAttribute("maxlength","10");let t=i.value;var s=5==t.indexOf("-"),r=(t=t.replace(/\D/g,"").substring(0,9)).substring(0,5),o=t.substring(5,9);c.setInputValue(u,i.value=5<t.length?r+"-"+o:r+(s?"-":""));break}case"number":{o=l(a);let t=i.value;r=o.allowNegative&&0==t.indexOf("-"),s=(t=t.replace(o.inputRegEx,"")).split(o.currencySeparator);let e=r?"-":"";2<s.length?e+=s.slice(0,2).join(o.currencySeparator):(e+=s[0],1<s.length&&(e+=o.currencySeparator+s[1].substring(0,o.decimalPlaces))),c.setInputValue(u,i.value=e);break}case"cc-expire":case"MM/YY":{i.setAttribute("maxlength","5");let t=i.value;r=3==t.indexOf("/"),s=(t=t.replace(/\D/g,"").substring(0,4)).substring(0,2),o=t.substring(2);c.setInputValue(u,i.value=2<t.length?s+"/"+o:s+(r?"/":""));break}case"phone":case"(###) ###-####":{i.setAttribute("maxlength","14");let t=i.value;o=(t=t.replace(/\D/g,"").substring(0,10)).substring(0,3),s=t.substring(3,6),r=t.substring(6,10);6<=t.length?i.value="("+o+") "+s+"-"+r:3<=t.length?i.value="("+o+") "+s:0<t.length&&(i.value="("+o),c.setInputValue(u,i.value);break}default:i.setAttribute("maxlength",h(u).toString())}(n||t)&&(i.selectionStart=i.selectionEnd=e);n=+i.getAttribute("maxlength"),t=i.value;t.length>n&&c.setInputValue(u,i.value=t.slice(0,n))}})}}}bindRangeEvents(l,p,c,t,u,e){let d,h=t.bubble,g=t.bubbleValue??h,m=t.display,i=e=>{d&&clearTimeout(d);var i,t=c.value,a=((t,e)=>{if(null==e)return t;e=e.slice(3,-1);if("p"==e[0])return E.Utils.formatPercent(l.options.intl.currentCulture,+t,e,!0);if("c"==e[0]||"n"==e[0]||"f"==e[0])return E.Utils.formatNumber(l.options.intl,+t,e);throw new Error(`Unsupported format ${e} for range input `+p)})(t,u(p)),n=+c.getAttribute("max"),s=+c.getAttribute("min"),r=Number(100*(+t-s)/(n-s)),o=10-.2*r;if(null!=m&&(m.innerHTML=a),null!=h&&(g.innerHTML=a,e)){let t=30;null!=m&&(a=m,e=getComputedStyle(a),i=parseFloat(e.paddingLeft)+parseFloat(e.paddingRight),e=parseFloat(e.borderLeftWidth)+parseFloat(e.borderRightWidth),t=15+a.offsetWidth-i-e),g.style.width=t+"px",h.style.left=`calc(${r}% + (${o}px))`,h.classList.add("active")}c.style.backgroundSize=100*(+t-s)/(n-s)+"% 100%"};i(!1),c.addEventListener("input",async()=>{await e(!1),i(!0)}),c.addEventListener("rangeset.ka",()=>i(!1)),c.addEventListener("change",async()=>e(!0,!0)),null!=h&&(c.addEventListener("mouseenter",()=>{d=setTimeout(()=>{i(!0)},750)}),c.addEventListener("mouseleave",()=>{d&&clearTimeout(d),h.classList.remove("active")}))}bindDateEvents(i,a,e,t,n,s){let r=async t=>{var e=i.getInputValue(a);i.state.inputs[a]!=e&&(t.currentTarget.dispatchEvent(new Event("value-ka")),await s(!0))};t.addEventListener("invalid",t=>this.addValidityValidation(i,a,e,t.target)),t.addEventListener("change",r),t.addEventListener("keypress",async t=>{n(),"Enter"==t.code&&await r(t)}),t.addEventListener("keydown",()=>{t.removeEventListener("change",r),t.addEventListener("blur",r)}),t.addEventListener("click",()=>{t.removeEventListener("blur",r),t.removeEventListener("change",r),t.addEventListener("change",r)}),t.addEventListener("blur",()=>{i.isCalculating||(i.state.needsCalculation=!1)})}bindCustomEvents(r,o,l,p){if(null!=l)for(let s in l){let e=s.split(".")[0],n=this.getModifiers(s);if(n){let t=["ctrl","shift","alt","meta"],i={stop:t=>t.stopPropagation(),prevent:t=>t.preventDefault(),self:t=>t.target!==t.currentTarget,ctrl:t=>!t.ctrlKey,shift:t=>!t.shiftKey,alt:t=>!t.altKey,meta:t=>!t.metaKey,left:t=>"button"in t&&0!==t.button,middle:t=>"button"in t&&1!==t.button,right:t=>"button"in t&&2!==t.button,exact:(e,i)=>t.some(t=>e[t+"Key"]&&!i[t])},a=("click"===e&&(n.right&&(e="contextmenu"),n.middle)&&(e="mouseup"),c.cacheStringFunction(t=>t.replace(/\B([A-Z])/g,"-$1").toLowerCase()));o.addEventListener(e,t=>{if(!("key"in t)||a(t.key)in n){for(var e in n){e=i[e];if(e&&e(t,n))return}return l[s](t,r,p)}},n)}else o.addEventListener(s,t=>l[s](t,r,p))}}getModifiers(t){if(-1!=t.indexOf(".")){var e,i={},a=t.split(".");for(e in a.shift(),a)i[a[e]]=!0;return i}}}E.InputComponentBase=c}(KatApps=KatApps||{}),(t=>{class e extends t.InputComponentBase{props;constructor(t){super(),this.props=t}getScope(a,t){let n=this.props,e=this,s=n.name,r=n.ce,o=n.tab,i=n.template;if(null!=i){t=t(i);if(null==t)return void console.error(`Unable to find template ${t}, `+JSON.stringify(n));i=t}let l=function(t,e,i){if(0!=a.calcEngines.length)return a.state.rbl.value("rbl-input",s,t,void 0,r,o)??(null!=e&&null!=i?a.state.rbl.value(e,i,void 0,void 0,r,o):void 0)};t=l("type")??n.type??"text";let p={_displayEvalulation:void 0,_disabledEvaluation:void 0,get display(){var t,e,i=l("display","rbl-display","v"+s);return null!=i&&i.startsWith("!!")?(t=i.substring(2),(t=new Function("$state",`with($state){return ${t}}`)(a.state))?!1===this._displayEvalulation&&""==(a.state.inputs[s]??"")&&""!=(e=l("displayed-value")??"")&&a.setInputValue(s,e):"0"!=(l("displayed-clear")??"")&&a.setInputValue(s,void 0),this._displayEvalulation=t):"0"!=i},get noCalc(){return"1"==l("skip-calc","rbl-skip",s)},get disabled(){var t,e,i=l("disabled","rbl-disabled",s);return null!=i&&i.startsWith("!!")?(t=i.substring(2),(t=new Function("$state",`with($state){return ${t}}`)(a.state))?"0"!=(l("disabled-clear")??"")&&a.setInputValue(s,void 0):!0===this._disabledEvaluation&&""==(a.state.inputs[s]??"")&&""!=(e=l("disabled-value")??"")&&a.setInputValue(s,e),this._disabledEvaluation=t):"1"==i},get error(){return e.errorText(a,s)},get warning(){return e.warningText(a,s)}},c=t=>l("mask")??n.mask,u=null!=c(s)||"function"==typeof Object.getOwnPropertyDescriptor(n,"mask")?.get,d=t=>{var e=l("max-length");return(null!=e?+e:void 0)??n.maxLength??250},h=t=>l("keypress-regex")??n.keypressRegex,g=t=>a.state.inputs[t]??n.value,m=t=>a.getLocalizedString(l("label","rbl-value","l"+t)??n.label??""),v=t=>"boolean"==typeof n.isNoCalc?n.isNoCalc:n.isNoCalc?.(p)??p.noCalc,b=t=>{let e=l("display-format")??"";var i;return""!=(e=""==e&&0<a.calcEngines.length&&(i=a.state.rbl.value("rbl-sliders",t,"format",void 0,r,o),t=a.state.rbl.value("rbl-sliders",t,"decimals",void 0,r,o),null!=i)&&null!=t?`{0:${i}${t}}`:e)?e:n.displayFormat},f={$template:i,$renderId:this.getRenderedId(i),id:s+"_"+a.id,name:s,type:t,get value(){return a.state.inputs[s]??n.value??""},get disabled(){return"boolean"==typeof n.isDisabled?n.isDisabled:n.isDisabled?.(p)??p.disabled},get display(){return"boolean"==typeof n.isDisplay?n.isDisplay:n.isDisplay?.(p)??p.display},get noCalc(){return v(s)},get label(){return m(s)},get labelledBy(){return n.labelledBy},get hideLabel(){return"-1"==l("label")||(n.hideLabel??!1)},get placeHolder(){var t=l("placeholder")??n.placeHolder;return null!=t?a.getLocalizedString(t):void 0},get help(){return{get content(){var t=l("help","rbl-value","h"+s)??n.help?.content;return null!=t?a.getLocalizedString(t):void 0},title:a.getLocalizedString(l("help-title","rbl-value","h"+s+"Title")??n.help?.title??""),width:l("help-width")??n?.help?.width?.toString()??"350"}},get iconHtml(){return n.iconHtml??""},get css(){return{input:n?.css?.input??"",label:n?.css?.label??"",container:n?.css?.container}},get error(){return p.error},get warning(){return p.warning},get list(){var t=null==n.list&&0<a.calcEngines.length?l("list")??a.state.rbl.value("rbl-listcontrol",s,"table",void 0,r,o):void 0;return(null!=t?a.state.rbl.source(t,r,o):n.list??[]).map(t=>({key:t.key,text:a.getLocalizedString(t.text.toString())}))},get prefix(){return l("prefix")??n.prefix},get suffix(){return l("suffix")??n.suffix},get maxLength(){return d(s)},get min(){return(0==a.calcEngines.length?void 0:l("min")??a.state.rbl.value("rbl-sliders",s,"min",void 0,r,o))??n.min?.toString()},get max(){return(0==a.calcEngines.length?void 0:l("max")??a.state.rbl.value("rbl-sliders",s,"max",void 0,r,o))??n.max?.toString()},get step(){var t=0==a.calcEngines.length?void 0:l("step")??a.state.rbl.value("rbl-sliders",s,"step",void 0,r,o);return(null!=t?+t:void 0)??n.step??1},inputUnmounted:t=>this.unmounted(a,t,n.clearOnUnmount),inputMounted:(t,e)=>{},uploadAsync:async()=>{if(null==n.uploadEndpoint)throw new Error("Cannot use uploadAsync if uploadEndpoint is not set.");var t=a.selectElement("."+s).files;try{await a.apiAsync(n.uploadEndpoint,{files:t})}catch(t){}finally{a.setInputValue(s,void 0)}}};return f.inputMounted=(t,e)=>this.mounted(a,f,s,m,t,g,n.isExcluded??!1,v,b,u,c,d,h,n.events,e),f}}t.InputComponent=e})(KatApps=KatApps||{}),(t=>{class e extends t.TemplateBase{props;constructor(t){super(),this.props=t}getScope(e,i){if(null==this.props.name)throw new Error("You must provide {name:'templateName'} when using v-ka-template.");var t,i=i(this.props.name);if(null==i)return{};if(this.props.source instanceof Array){let t=this;return{$template:i,$renderId:t.getRenderedId(i),application:e,modalAppOptions:e.options.modalAppOptions,get rows(){return t.props.source}}}return(t=this.props.source??{}).$template=i,t.$renderId=this.getRenderedId(i),t.application=e,t.modalAppOptions=e.options.modalAppOptions,t}}t.TemplateComponent=e})(KatApps=KatApps||{}),(t=>{class e extends t.InputComponentBase{props;constructor(t){super(),this.props=t}getScope(D,t){t=t(this.props.template);if(null!=t){let e=this,a=this.props,n=a.names,i=$(a.values),s=$(a.labels),r=$(a.prefixes),o=$(a.suffixes),l=$(a.hideLabels),p=$(a.placeHolders,""),c=$(a.displayFormats),u=$(a.masks),d=$(a.keypressRegexs),h=$(a.helps),g=$(a.css),m=$(a.maxLengths),v=$(a.mins),b=$(a.maxes),f=$(a.steps),y=a.ce,A=a.tab,k=function(t,e,i,a){if(0!=D.calcEngines.length)return D.state.rbl.value("rbl-input",n[t],e,void 0,y,A)??(null!=i&&null!=a?D.state.rbl.value(i,a,void 0,void 0,y,A):void 0)},x={name:t=>n[t],display:t=>"0"!=k(t,"display","rbl-display","v"+n[t]),noCalc:t=>"1"==k(t,"skip-calc","rbl-skip",n[t]),disabled:t=>"1"==k(t,"disabled","rbl-disabled",n[t]),error:t=>e.errorText(D,n[t]),warning:t=>e.errorText(D,n[t])},E=function(t){t=n.indexOf(t);return D.getLocalizedString(k(t,"label","rbl-value","l"+n[t])??s[t]??"")},w=function(t){t=n.indexOf(t);return"boolean"==typeof a.isNoCalc?a.isNoCalc:a.isNoCalc?.(t,x)??x.noCalc(t)},C=function(t){t=n.indexOf(t);return D.state.inputs[n[t]]??i[t]},S=function(t){t=n.indexOf(t);return k(t,"mask")??u[t]},O=n.some(t=>void 0!==S(t))||"function"==typeof Object.getOwnPropertyDescriptor(a,"masks")?.get,T=function(t){var t=n.indexOf(t),e=k(t,"max-length");return(null!=e?+e:void 0)??m[t]??250},L=function(t){t=n.indexOf(t);return k(t,"keypressRegex")??d[t]},K=function(t){var e,i=n.indexOf(t);let a=k(i,"display-format")??"";return""!=(a=""==a&&0<D.calcEngines.length&&(e=D.state.rbl.value("rbl-sliders",t,"format",void 0,y,A),t=D.state.rbl.value("rbl-sliders",t,"decimals",void 0,y,A),null!=e)&&null!=t?`{0:${e}${t}}`:a)?a:c[i]};var U=k(0,"type")??a.type??"text";let I={$template:t,$renderId:this.getRenderedId(t),id:t=>n[t]+"_"+D.id,name:t=>x.name(t),type:U,value:t=>C(n[t])??"",disabled:t=>"boolean"==typeof a.isDisabled?a.isDisabled:a.isDisabled?.(t,x)??x.disabled(t),display:t=>"boolean"==typeof a.isDisplay?a.isDisplay:a.isDisplay?.(t,x)??x.display(t),noCalc:t=>w(n[t]),label:t=>E(n[t]),placeHolder:t=>{t=k(t,"placeholder","rbl-value","ph"+n[t])??p[t];return null!=t?D.getLocalizedString(t):void 0},help:e=>({get content(){var t=k(e,"help","rbl-value","h"+n[e])??h[e]?.content;return null!=t?D.getLocalizedString(t):void 0},title:D.getLocalizedString(k(e,"help-title","rbl-value","h"+n[e]+"Title")??h[e]?.title??""),width:k(e,"help-width")??h[e]?.width?.toString()??"350"}),css:t=>({input:g[t]?.input??"",label:g[t]?.label??"",container:g[t]?.container}),error:t=>x.error(t),warning:t=>x.warning(t),list:function(t){t=0==D.calcEngines.length?void 0:k(t,"list")??D.state.rbl.value("rbl-listcontrol",n[t],"table",void 0,y,A);return(null!=t?D.state.rbl.source(t,y,A):[]).map(t=>({key:t.key,text:D.getLocalizedString(t.text.toString())}))},hideLabel:t=>"-1"==k(t,"label")||(l[t]??!1),maxLength:t=>T(n[t]),min:t=>(0==D.calcEngines.length?void 0:k(t,"min")??D.state.rbl.value("rbl-sliders",n[t],"min",void 0,y,A))??v[t],max:t=>(0==D.calcEngines.length?void 0:k(t,"max")??D.state.rbl.value("rbl-sliders",n[t],"max",void 0,y,A))??b[t],step:t=>{var e=0==D.calcEngines.length?void 0:k(t,"step")??D.state.rbl.value("rbl-sliders",n[t],"step",void 0,y,A);return(null!=e?+e:void 0)??f[t]},prefix:t=>k(t,"prefix")??r[t],suffix:t=>k(t,"suffix")??o[t],inputUnmounted:t=>this.unmounted(D,t,a.clearOnUnmount),inputMounted:(t,e)=>{}};return I.inputMounted=(t,e)=>{var i=t.getAttribute("name");if(null==i)throw new Error('You must assign a name attribute via :name="name(index)".');this.mounted(D,I,i,E,t,C,a.isExcluded??!1,w,K,O,S,T,L,a.events,e)},I;function $(t,e){let i=null!=t&&t instanceof Array?t[t.length-1]:t??e;return t instanceof Array?t.concat(n.slice(0,n.length-t.length).map(t=>i)):n.map(t=>i)}}}}t.TemplateMultipleInputComponent=e})(KatApps=KatApps||{}),(a=>{a.Components=class{static initializeCoreComponents(e,i){e.state.components.template=t=>new a.TemplateComponent(t).getScope(e,i),e.state.components.input=t=>new a.InputComponent(t).getScope(e,i),e.state.components.inputGroup=t=>new a.TemplateMultipleInputComponent(t).getScope(e,i)}}})(KatApps=KatApps||{}),(o=>{class t{name="ka-api";getDefinition(r){return a=>{async function t(t){if(t.preventDefault(),null==n.confirm||(await r.showModalAsync(n.confirm,t.currentTarget)).confirmed)try{let i=["confirm","endpoint","then","catch"];var e=await r.apiAsync(s,o.Utils.clone(n,(t,e)=>-1<i.indexOf(t)?void 0:e),a.el);null!=n.thenAsync&&await n.thenAsync(e,r)}catch(t){null!=n.catchAsync?await n.catchAsync(t,r):o.Utils.trace(r,"DirectiveKaApi","submitApi",`API Submit to ${s} failed.`,TraceVerbosity.None,t)}}let n=a.exp.startsWith("{")?a.get():{endpoint:a.exp},s=n.endpoint;return"A"==a.el.tagName&&a.el.setAttribute("href","#"),a.el.addEventListener("click",t),()=>{a.el.removeEventListener("click",t)}}}}o.DirectiveKaApi=t})(KatApps=KatApps||{}),(l=>{l.DirectiveKaApp=class{name="ka-app";getDefinition(o){return t=>{let e=t.get();var i=e.view;let a=["handlers","view","modalAppOptions","hostApplication","currentPage"],n=l.Utils.extend(l.Utils.clone(o.options,(t,e)=>-1<a.indexOf(t)?void 0:e),{view:i,currentPage:i,hostApplication:o,inputs:l.Utils.extend({iNestedApplication:"1"},e.inputs)}),s=(delete n.inputs.iModalApplication,e.selector??".kaNested"+l.Utils.generateId());t.el.classList.add(s.substring(1));let r;return(async()=>{try{await PetiteVue.nextTick(),r=await KatApp.createAppAsync(s,n)}catch(t){l.Utils.trace(o,"DirectiveKaApp","getDefinition",`Nested App ${e.view} failed.`,TraceVerbosity.None,t)}})(),()=>{null!=r&&KatApp.remove(r)}}}}})(KatApps=KatApps||{}),(n=>{n.DirectiveKaAttributes=class{name="ka-attributes";getDefinition(t){return t=>{var e=t.get();if(null!=e&&""!=e){var i,a=n.Utils.getObjectFromAttributes(e);for(i in a)t.el.setAttribute(i,a[i])}}}}})(KatApps=KatApps||{}),(D=>{D.DirectiveKaChart=class{name="ka-chart";ns="http://www.w3.org/2000/svg";application;getDefinition(t){return i=>{this.application=t;let a=i.el;return a.setAttribute("ka-chart-id",D.Utils.generateId()),i.effect(()=>{var t=i.get(),e=this.buildChartConfiguration(t);this.resetContextElement(a),null!=e&&0<e.data.length&&(a.classList.add(e.css.chart),this.addChart(t,a,e),this.generateBreakpointCharts(t,a,e),this.addLegend(a,e),this.addTooltips(t,a,e),this.addHoverEvents(t,a,e))}),()=>{this.application.removeDirectiveEvents(a.getAttribute("ka-chart-id"))}}}addChart(t,e,i){if("legend"!=t.mode){var a=document.createElement("div");switch(a.classList.add("ka-chart-container",i.css.chartType),a.kaHoverOptions={columnCount:i.plotOptions.column.count,columnWidth:i.plotOptions.plotWidth/i.plotOptions.column.count,plotLeft:i.plotOptions.padding.left,plotRight:i.plotOptions.width-i.plotOptions.padding.right,plotBottom:i.plotOptions.yAxis.baseY,plotTop:i.plotOptions.padding.top},t.breakpoints?.xs&&a.classList.add("d-none","d-sm-block"),t.maxHeight&&(a.style.maxHeight=t.maxHeight+"px"),e.appendChild(a),i.type){case"donut":this.generateDonutChart(i,a);break;case"sharkfin":this.generateStackedAreaChart(i,a);break;case"column":case"columnStacked":this.generateColumnChart(i,a);break;default:return void(a.innerHTML=`<b>${t.data} ${i.type} chart not supported</b>`)}t.maxHeight&&(a.querySelector("svg").style.maxHeight=t.maxHeight+"px")}}buildChartConfiguration(f){var y=this.application.state.rbl.source(f.data,f.ce,f.tab);let A=y.filter(t=>"category"==t.id).slice(f.from??0,f.to??y.length),k=y.filter(t=>"category"!=t.id);if(0!=A.length){let t=Object.keys(A[0]).filter(t=>t.startsWith("data"));var y=this.getOptionValue(k,"type"),x=!["column","donut"].includes(y),E=this.getOptionValue(k,"options");let i=null!=E?this.application.state.rbl.source(E,f.ce,f.tab):[],a=this.application.state.rbl.source("chartOptions",f.ce,f.tab),n=e=>i.find(t=>t.id==e)?.value??a.find(t=>t.id==e)?.value;var E=e=>k.find(t=>t.id==e)??{},w=e=>k.filter(t=>t.id==e),C=(t,e,i)=>0===String.compare(this.getOptionValue(k,t,n,e??i?"true":"false"),"true",!0);let s=E("text"),r=E("color"),o=E("type"),l=this.getOptionValue(k,"shape",n,"square"),p=E("shape"),c=[];switch(y){case"column":case"donut":c=t.map(t=>({name:s[t],data:+A[0][t]}));break;case"sharkfin":case"columnStacked":c=A.map(e=>({name:e.value,data:t.map(t=>+e[t])}))}let u=n("colors")?.split(",")??[];var E=n("format")??"c0",S=JSON.parse(this.getOptionValue(k,"dataLabels",n)??"{}"),E=(S.show=C("dataLabels.show",S.show,!1),S.format=this.getOptionValue(k,"dataLabels.format",n,S.format??E),JSON.parse(this.getOptionValue(k,"tip",n)??"{}")),O=(E.padding={top:5,left:5},E.show=C("tip.show",E.show,!0),E.headerFormatter=this.getOptionValue(k,"tip.headerFormatter",n,E.headerFormatter),E.includeShape=C("tip.includeShape",E.includeShape,!0),E.includeTotal=C("tip.includeTotal",E.includeTotal,x&&!S.show),this.getOptionValue(k,"aspectRatio",n,"1:1")),O=JSON.parse(O.startsWith("{")?O:`{ "value": "${O}" }`),T=t=>{t=t.split(":");return+t[0]/+t[1]},L=(O.current="value",O.value=T(O.value),this.getOptionNumber(k,"font.multiplier",n,1)),T=(O.xs&&(O.xs=T(O.xs)),w("xAxis.plotBand").map(t=>JSON.parse(t.value))),w=w("xAxis.plotLine").map(t=>JSON.parse(t.value)),K=this.getOptionJson(k,"sharkfin",n);if(null!=K){let e=K.retirementAge;var I=c.findIndex(t=>+t.name==e);w.push({value:I,color:K.line.color}),T.push({from:I,to:c.length-.5,color:K.fill.color})}let e={label:this.getOptionValue(k,"xAxis.label",n),format:"c0",minCategory:-.5,maxCategory:A.length-.5,get plotBandSegmentWidth(){return this._parent.plotWidth/(2*c.length)},plotBands:T,plotLines:w,get skipInterval(){return Math.ceil(c.length/(this._parent.plotWidth/25))}},d={label:this.getOptionValue(k,"yAxis.label",n),format:S.format,tickCount:+this.getOptionValue(k,"yAxis.tickCount",n,"5"),get baseY(){return this._parent.height-this._parent.padding.bottom},get intervalSize(){var t=this._parent.column.maxValue/this.tickCount,e=Math.pow(10,Math.floor(Math.log10(t)));let i=t/e;var t=[1,2,2.5,3,4,5,7.5,10,15,20],a=t.findIndex(t=>i<=t);return(-1===a?t[t.length-1]:t[a])*e},get maxValue(){var t=this.intervalSize;return Math.ceil(this._parent.column.maxValue/t)*t},getY(t){var e=this._parent.plotHeight;return this._parent.padding.top+(e-t/this.maxValue*e)}},h=t.map((t,e)=>({text:s[t],color:(""==r[t]?void 0:r[t])??(e<u.length?u[e]:"black"),shape:(""==p[t]?void 0:p[t])??("line"==o[t]?"line":void 0)??l,legend:0!==String.compare(o[t],"tooltip",!0),type:(""==o[t]?void 0:o[t])??"column"}));I=Math.max(...c.map(t=>Array.isArray(t.data)?Math.max(t.data.reduce((t,e,i)=>t+("line"!=h[i].shape?e:0),0),...t.data.map((t,e)=>"line"==h[e].shape?t:0)):t.data))*(S.show?1.05:1.025);let g=D.Utils.formatNumber(this.application.options.intl,I,d.format)+"000",m="donut"!=y,v=this,b={name:f.data,type:y,dataColumns:t,data:c,css:{chart:"ka-chart-"+f.data.toLowerCase(),chartType:"ka-chart-"+y.toLowerCase(),legend:"ka-chart-legend-"+f.data.toLowerCase(),legendType:"ka-chart-legend-"+y.toLowerCase()},plotOptions:{font:{size:{heuristic:.6,base:16,fontMultiplier:L,get default(){return this.base*this.fontMultiplier},get yAxisLabel(){return.9*this.default},get yAxisTickLabels(){return.8*this.default},get xAxisLabel(){return.9*this.default},get xAxisTickLabels(){return.8*this.default},get plotBandLabel(){return.7*this.default},get plotBandLine(){return.8*this.default},get dataLabel(){return.7*this.default},get donutLabel(){return 2*this.default},get tipHeader(){return.6*this.base},get tipBody(){return.8*this.base}}},aspectRadio:O,height:400,get width(){return Math.ceil(400*(this.aspectRadio[this.aspectRadio.current]??this.aspectRadio.value))},get plotWidth(){return this.width-this.padding.left-this.padding.right},get plotHeight(){return this.height-this.padding.top-this.padding.bottom},pie:{startAngle:+this.getOptionValue(k,"pie.startAngle",n,"0"),endAngle:+this.getOptionValue(k,"pie.endAngle",n,"360")},donut:{labelFormatter:this.getOptionValue(k,"donut.labelFormatter",n),showTotal:C("donut.showTotal",n,!0)},padding:{get top(){return 5+(m?this._parent.font.size.yAxisTickLabels:0)},right:5,get bottom(){var t=m?Math.max(...b.data.map(t=>v.getWrappedColumnLabels(this._parent,t.name).length+1)):0;return 5+t*this._parent.font.size.xAxisTickLabels+5*Math.max(0,t-1)+(e.label?this._parent.font.size.xAxisLabel:0)},get left(){return 5+(m?g.length*this._parent.font.size.yAxisTickLabels*this._parent.font.size.heuristic:0)+(d.label?this._parent.font.size.yAxisLabel:0)}},column:{count:c.length,get width(){return this._parent.plotWidth/this.count*.65},get spacing(){return this._parent.plotWidth/this.count-this.width},maxValue:I,get maxLabelWidth(){return(this.width+1.25*this.spacing)*this._parent.xAxis.skipInterval},getX(t){var e=this.spacing;return this._parent.padding.left+t*(this.width+e)+e/2}},dataLabels:S,tip:E,xAxis:e,yAxis:d,highlight:{series:{hoverItem:C("highlight.series.hoverItem",void 0,!x),hoverLegend:!0},legend:{hoverItem:!0,hoverSeries:!0}},legend:{show:null==f.legendItemSelector&&("legend"==f.mode||"chart"!=f.mode&&C("legend.show",void 0,!1))}},series:h};return b.plotOptions.padding._parent=b.plotOptions,b.plotOptions.column._parent=b.plotOptions,b.plotOptions.xAxis._parent=b.plotOptions,b.plotOptions.yAxis._parent=b.plotOptions,b}}generateStackedAreaChart(h,t){let e=h.plotOptions.padding;var i=this.getChartSvgElement(h.plotOptions),a=h.data;this.addPlotBands(i,h),this.addYAxis(i,h);let g=a.map((i,t)=>{t=e.left+h.plotOptions.xAxis.plotBandSegmentWidth+t*h.plotOptions.xAxis.plotBandSegmentWidth*2;let a={name:i.name,x:t,total:i.data.reduce((t,e)=>t+e,0)};return h.series.forEach((t,e)=>{a[t.text]=+i.data[e]}),a}),m=(t,e,i)=>i?h.plotOptions.yAxis.getY(g[t][i]+g[t][e]):h.plotOptions.yAxis.getY(g[t][e]);var a=h.series.map((e,t)=>{var i=e.text,a=e.color,n=t==h.series.length-1,s=0==t,r=n?void 0:h.series[t+1].text,o=g[0].x,l=m(0,i,r);let p=`M ${o} ${h.plotOptions.yAxis.getY(0)} L ${o} `+l,c=`M ${o} `+l;var u=[{x:o,y:l,seriesConfig:e,value:g[0][i],name:g[0].name}];for(let t=1;t<g.length;t++){var d=` L ${o=g[t].x} `+(l=m(t,i,r));p+=d,c+=d,u.push({x:o,y:l,seriesConfig:e,value:g[t][i],name:g[t].name})}if(n)p+=` L ${g[g.length-1].x} ${h.plotOptions.yAxis.getY(0)} Z`;else{for(let t=g.length-1;0<=t;t--)p+=` L ${g[t].x} `+h.plotOptions.yAxis.getY(g[t][r]);p+=" Z"}t=document.createElementNS(this.ns,"g"),t.setAttribute("class","ka-chart-series-path"),n=this.createPath(p,"none",0,a,.75),n.setAttribute("ka-chart-highlight-key",e.text),a=this.createPath(c,a,2),a.setAttribute("ka-chart-highlight-key",e.text),t.append(n,a),n=this.addMarkerPoints(h,u),a=document.createElementNS(this.ns,"g");return a.setAttribute("class","ka-chart-series-item"),s&&a.setAttribute("ka-stack-top","1"),a.append(t,n),a}),n=document.createElementNS(this.ns,"g");n.setAttribute("class","ka-chart-series-group"),n.append(...a),i.appendChild(n),this.addPlotLines(i,h),this.addXAxis(i,h,h.data),t.appendChild(i)}generateColumnChart(c,t,u){var e=this.getChartSvgElement(c.plotOptions),i=u?.data??c.data;let d=c.plotOptions.column,r=c.plotOptions.plotHeight;var a=u?.plotOffset??0;this.addPlotBands(e,c,a,u?.plotLabelColumn,u?.plotBandSegmentWidth),this.addYAxis(e,c),this.addPlotLines(e,c,a,u?.plotBandSegmentWidth);let o=c.plotOptions.yAxis.maxValue,h=(t,e,i,a,n)=>{var s=i/o*r,t=this.createRect(t,e,d.width,s,a.color,"#ffffff",1),e=("tooltip"==a.type&&(t.setAttribute("data-is-tooltip","1"),t.setAttribute("opacity","0")),D.Utils.formatNumber(this.application.options.intl,i,c.plotOptions.dataLabels.format));return t.setAttribute("ka-chart-highlight-key",a.text),t.setAttribute("aria-label",a.text+`, ${e}.`+(n?` ${n}.`:"")),t},g="columnStacked"==c.type?i[0].data.length-1:0,m="columnStacked"==c.type?-1:i.length,v="columnStacked"==c.type?-1:1;var n=i.map((e,t)=>{var i=d.getX(t),a=t+(u?.plotOffset??0);let n=0;var s=[];if(e.data instanceof Array)for(let t=g;t!=m;t+=v){var r,o=c.series[t],l=e.data[t];"line"==o.shape?(r={x:i+d.width/2,y:c.plotOptions.yAxis.getY(l),seriesConfig:o,value:l,name:e.name},s.push(r)):(r=h(i,c.plotOptions.yAxis.getY(n+l),l,o,this.getHeader(c.plotOptions,e.name)),n+=l,s.push(r))}else s.push(h(i,c.plotOptions.yAxis.getY(e.data),e.data,c.series[t]));var p,t=document.createElementNS(this.ns,"g"),a=(t.classList.add("ka-chart-category"),0<n&&c.plotOptions.tip.show&&t.setAttribute("ka-tip-key",String(a)),s.filter(t=>t instanceof Element)),a=(t.append(...a),c.plotOptions.dataLabels.show&&(a=e.data instanceof Array?e.data.reduce((t,e)=>t+e,0):e.data,p=c.plotOptions.yAxis.getY(a)-10,p=this.createText(c.plotOptions,i+d.width/2,p,D.Utils.formatNumber(this.application.options.intl,a,c.plotOptions.dataLabels.format),c.plotOptions.font.size.dataLabel,{"text-anchor":"middle","font-weight":"bold"}),t.appendChild(p)),s.filter(t=>!(t instanceof Element)));return{g:t,linePoints:a}}),a=document.createElementNS(this.ns,"g");if(a.setAttribute("class","ka-chart-category-group"),a.append(...n.map(t=>t.g)),e.appendChild(a),n.some(t=>0<t.linePoints.length)){var s=n[0].linePoints.length,l=document.createElementNS(this.ns,"g");l.setAttribute("class","ka-chart-series-group");for(let e=0;e<s;e++){var p=document.createElementNS(this.ns,"g");p.setAttribute("class","ka-chart-series-item");let a=n.map(t=>t.linePoints[e]);var b=this.addMarkerPoints(c,a),f=a.map((t,e)=>{var i;return 0===e?`M ${t.x} `+t.y:(i=a[e-1],e=a[e+1]||t,`C ${i.x+(t.x-i.x)/3} ${i.y+(t.y-i.y)/3}, ${t.x-(e.x-i.x)/3} ${t.y-(e.y-i.y)/3}, ${t.x} `+t.y)}).join(" "),y=a[0].seriesConfig,f=this.createPath(f,y.color,2);f.setAttribute("ka-chart-highlight-key",y.text),p.append(f,b),l.appendChild(p)}e.appendChild(l)}this.addXAxis(e,c,i),t.appendChild(e)}generateBreakpointCharts(t,e,p){var i=[{item:t.breakpoints?.xs,name:"xs",labelColumn:"textXs"}].filter(t=>null!=t.item),a=p.plotOptions.column.count,n=p.plotOptions.font.size.fontMultiplier,s=p.plotOptions.xAxis.minCategory,r=p.plotOptions.xAxis.maxCategory;try{i.forEach(i=>{var a=document.createElement("div"),n=(a.className=`d-block d-sm-none ka-chart-container-${i.name} `+p.css.chartType,i.item.categories??p.plotOptions.column.count);p.plotOptions.aspectRadio.current=i.name,p.plotOptions.column.count=n,p.plotOptions.font.size.fontMultiplier=i.item.fontMultiplier??p.plotOptions.font.size.fontMultiplier,a.kaHoverOptions={columnCount:n,columnWidth:p.plotOptions.plotWidth/n,plotLeft:p.plotOptions.padding.left,plotRight:p.plotOptions.width-p.plotOptions.padding.right,plotBottom:p.plotOptions.yAxis.baseY,plotTop:p.plotOptions.padding.top},e.appendChild(a);let s=i.item.maxHeight??t.maxHeight;for(let e=0;e<Math.ceil(p.data.length/n);e++){var r=e*n,o=r+n;let t=void 0;s&&((t=document.createElement("div")).style.maxHeight=s+"px",a.appendChild(t)),p.plotOptions.xAxis.minCategory=r-.5,p.plotOptions.xAxis.maxCategory=o-.5;var o=p.data.slice(r,o),l=p.plotOptions.plotWidth/(2*o.length);this.generateColumnChart(p,t??a,{plotOffset:r,plotLabelColumn:i.labelColumn,plotBandSegmentWidth:l,data:o,containerClass:".ka-chart-container-"+i.name})}s&&[...a.children].forEach(t=>t.querySelector("svg.ka-chart").style.maxHeight=s+"px")})}finally{p.plotOptions.aspectRadio.current="value",p.plotOptions.column.count=a,p.plotOptions.font.size.fontMultiplier=n,p.plotOptions.xAxis.minCategory=s,p.plotOptions.xAxis.maxCategory=r}}generateDonutChart(p,t){let a=p.data,c=a.reduce((t,e)=>t+e.data,0),u=p.plotOptions.height/2;var e=.4375*u;let d=u-e/2,h=p.plotOptions.pie.endAngle-p.plotOptions.pie.startAngle,g=p.plotOptions.pie.startAngle,n=this.application;var i=a.map((t,e)=>{var i,a,n,s,r,o,l;if(0!=t.data)return l=t.data/c*h,a=g,g+=l,i=d*Math.cos((a-90)*Math.PI/180)+u,a=d*Math.sin((a-90)*Math.PI/180)+u,n=d*Math.cos((g-90)*Math.PI/180)+u,s=d*Math.sin((g-90)*Math.PI/180)+u,r=l>h/2?1:0,o=D.Utils.formatNumber(this.application.options.intl,t.data,p.plotOptions.dataLabels.format),(l=360<=l?this.createCircle(u,u,d,p.series[e].color):this.createPath(`M ${u} ${u} L ${i} ${a} A ${d} ${d} 0 ${r} 1 ${n} ${s} Z`,"none",0,p.series[e].color)).setAttribute("aria-label",t.name+`, ${o}.`),l.setAttribute("ka-chart-highlight-key",t.name),p.plotOptions.tip.show&&l.setAttribute("ka-tip-key",String(e)),l}).filter(t=>null!=t),s=this.getChartSvgElement(p.plotOptions);s.append(...i),s.appendChild(this.createCircle(u,u,u-e,"white")),p.plotOptions.donut.showTotal&&(i=D.Utils.formatNumber(this.application.options.intl,c,p.plotOptions.dataLabels.format),e=p.plotOptions.donut.labelFormatter?String.formatTokens(this.application.options.intl,p.plotOptions.donut.labelFormatter.replace(/\{([^}]+)\}/g,"{{$1}}"),p.dataColumns.reduce(function(t,e,i){return t[e]=D.Utils.formatNumber(n.options.intl,a[i].data,p.plotOptions.dataLabels.format),t},{total:i})):i,s.appendChild(this.createText(p.plotOptions,u,u,e,p.plotOptions.font.size.donutLabel,{"text-anchor":"middle","dominant-baseline":"middle","font-weight":"bold"}))),t.appendChild(s)}addLegend(t,e){if(e.plotOptions.legend.show){var i=document.createElement("div");i.className=`ka-chart-legend ${e.css.legendType} `+e.css.legend,t.appendChild(i);let n=document.createElement("div");n.className="ka-chart-legend-item-wrapper",("sharkfin"==e.type?e.series:e.series.toReversed()).filter(t=>t.legend).forEach(t=>{var e=document.createElement("div"),i=(e.className="ka-chart-legend-item",e.setAttribute("ka-chart-highlight-key",t.text),document.createElementNS(this.ns,"svg")),a=(i.setAttribute("width","12px"),i.setAttribute("height","12px"),this.getSeriesShape(10,t.shape,t.color)),a=(i.appendChild(a),document.createElement("span"));a.className="ps-2 nowrap ka-chart-legend-text",a.textContent=t.text,e.append(i,a),n.appendChild(e)}),i.appendChild(n)}}resetContextElement(e){e.replaceChildren(),Array.from(e.classList).forEach(t=>{t.startsWith("ka-chart-")&&e.classList.remove(t)})}addHoverEvents(n,A,s){let t=()=>{[...A.querySelectorAll(".ka-chart-donut [ka-tip-key], .ka-chart-category-group [ka-tip-key]")].forEach(t=>{var e=t.getAttribute("ka-tip-key"),e=this.getTooltipOptions(A,e);e.trigger="hover",new bootstrap.Tooltip(t,e),t.setAttribute("ka-init-tip","true")})},e=()=>{var t,e=s.plotOptions;let i=[{textSelector:"span",highlightOnHover:e.highlight.series.hoverItem,elements:[...A.querySelectorAll(`.${s.css.chartType} [ka-chart-highlight-key]`)]},{textSelector:"span",highlightOnHover:e.highlight.series.hoverLegend,elements:[...A.querySelectorAll(".ka-chart-legend [ka-chart-highlight-key]")]}],a=(n.legendItemSelector&&(t=this.application.selectElement("."+s.css.legend))&&i.push({textSelector:n.legendItemSelector,highlightOnHover:e.highlight.series.hoverLegend,elements:[...t.querySelectorAll("[ka-chart-highlight-key]")]}),a=>{let n=a.target.getAttribute("ka-chart-highlight-key");i.forEach(i=>{i.elements.filter(t=>"1"!=t.getAttribute("data-is-tooltip")).forEach(t=>{let e="mouseleave"==a.type||n==t.getAttribute("ka-chart-highlight-key")?"1":"0.2";t instanceof SVGElement?t.setAttribute("opacity",e):(t.querySelector("svg").setAttribute("opacity",e),t.querySelectorAll(i.textSelector).forEach(t=>t.style.opacity=e))})})});i.forEach(t=>{t.highlightOnHover&&t.elements.forEach(t=>this.application.off(t,"mouseenter.ka.chart mouseleave.ka.chart").on("mouseenter.ka.chart mouseleave.ka.chart",a))})},k=void 0,x="sharkfin"==s.type,i=()=>{A.querySelector(".ka-chart-marker-points")&&[...A.children].filter(t=>null!=t.kaHoverOptions).forEach(t=>{var e=[...t.querySelectorAll("svg.ka-chart")];let i=t.kaHoverOptions;e.forEach(a=>{let s=[...a.querySelectorAll(".ka-chart-marker-points")].map(t=>({points:[...t.querySelectorAll(".ka-chart-point")],glow:t.querySelector(".ka-chart-point-glow")})),r=x?[...a.querySelectorAll('.ka-chart-series-item[ka-stack-top="1"] .ka-chart-marker-points path')]:[],o=void 0,l=void 0,p=a.createSVGPoint(),c=void 0,u=!1,d=i.columnCount,h=i.columnWidth,g=i.plotLeft,m=i.plotRight,v=i.plotBottom,b=i.plotTop,f=t=>{null!=o&&(s.forEach(t=>{t.points.forEach(t=>t.setAttribute("opacity","0")),t.glow.setAttribute("opacity","0")}),l&&(u||(u=!0,l.hide()),l=void 0),o=void 0)},y=e=>{null==k&&(k=a.getScreenCTM().inverse(),c=a.getBoundingClientRect()),p.x=e.clientX,p.y=e.clientY;var t=p.matrixTransform(k),i=t.x>=g&&t.x<=m,n=t.y>=b&&t.y<=v;if(i&&n){var i=t.x-g;let a=Math.max(0,Math.min(d-1,Math.floor(i/h)));a!=o&&(o=a,s.forEach(i=>{i.points.forEach((t,e)=>{var e=a==e;t.setAttribute("opacity",e?"1":"0"),e&&(e=t.getAttribute("ka-chart-point").split(","),i.glow.setAttribute("cx",e[0]),i.glow.setAttribute("cy",e[1]))}),i.glow.setAttribute("opacity","0.2")}),x)&&(n=r[o],bootstrap.Tooltip.getInstance(n)||(n.addEventListener("hide.bs.tooltip",t=>{var e=t.target.getAttribute("aria-label"),i=l?._element?.getAttribute("aria-label");u||i!==e||t.preventDefault()}),n.addEventListener("hidden.bs.tooltip",t=>{l?.show(),u=!1}),n.addEventListener("inserted.bs.tooltip",t=>{t=t.target;document.querySelector("#"+t.getAttribute("aria-describedby")).addEventListener("mousemove",t=>{t.clientX>=c.left&&t.clientX<=c.right&&t.clientY>=c.top&&t.clientY<=c.bottom?y(t):f(e)})}),D.HelpTips.hideVisiblePopover(),t=this.getTooltipOptions(A,String(o)),new bootstrap.Tooltip(n,t)),i=document.querySelector(".tooltip.ka-chart-tip"),l=bootstrap.Tooltip.getInstance(n),i?u||(u=!0,t=document.querySelector(`[aria-describedby="${i.id}"]`),bootstrap.Tooltip.getInstance(t).hide()):l.show())}else f(e)};this.application.off(a,"mousemove.ka.chart.marker mouseleave.ka.chart.marker").on("mousemove.ka.chart.marker mouseleave.ka.chart.marker",t=>{var e;if("mouseleave"==t.type)return e=t.relatedTarget,a.contains(e)||e?.closest(".ka-chart-tip")?void 0:void f(t);y(t)})})})},a=()=>{t(),e(),i(),this.application.off(window,"resize scroll").on("resize scroll",()=>{k=void 0;var t=document.querySelector(".tooltip.ka-chart-tip");t&&bootstrap.Tooltip.getInstance(document.querySelector(`[aria-describedby="${t.id}"]`)).hide()})};this.application.handleDirectiveEvents(t=>{t.domUpdated=t=>{let e=null!=n.legendItemSelector?this.application.selectElement("."+s.css.legend):void 0;t.some(t=>t===A||t.contains(A)||t===e||null!=e&&t.contains(e))&&(a(),A.kaDomUpdated=!0)}},A.getAttribute("ka-chart-id")),A.kaDomUpdated&&a()}getTooltipOptions(e,i){return{html:!0,sanitize:!1,trigger:"manual",container:e,template:'<div class="tooltip katapp-css ka-chart-tip" role="tooltip"><div class="tooltip-arrow arrow"></div><div class="tooltip-inner"></div></div>',placement:(t,e)=>"top",fallbackPlacements:["top","bottom","right","left"],title:function(){var t=e.querySelector(".ka-chart-tips .tooltip-"+i);if(t)return t?.cloneWithEvents()},content:function(){}}}addTooltips(t,e,p){if("legend"!=t.mode){let l=p.plotOptions.tip;var t=document.createElement("div"),i=(t.classList.add("ka-chart-tips"),t.style.display="none",p.data.map((t,e)=>{var i=t.data instanceof Array?t.data.map((t,e)=>0<t?{name:p.series[e].text,value:t,seriesConfig:p.series[e]}:void 0).filter(t=>null!=t):[{name:t.name,value:t.data,seriesConfig:p.series[e]}];if(0!=i.length){var t=t.data instanceof Array?t.name:void 0,r=(t&&this.getHeader(p.plotOptions,t),document.createElement("div"));r.className="tooltip-"+e;let a=document.createElementNS(this.ns,"svg");var e=7*Math.max(...[(t??"").length].concat(i.map(t=>(t.name+": "+D.Utils.formatNumber(this.application.options.intl,t.value,p.plotOptions.dataLabels.format)).length)))+2*l.padding.left,o=l.includeTotal&&1<i.length;a.setAttribute("viewBox",`0 0 ${e} `+(20*(i.length+(t?1:0)+(o?1:0))+2*l.padding.top)),a.setAttribute("width",String(e));let n=t?17:0,s=(t&&(e=this.createText(p.plotOptions,0,n,t,p.plotOptions.font.size.tipHeader,{"font-weight":"bold"}),a.appendChild(e)),l.includeShape?15:0);return i.forEach((t,e)=>{var e=n+20*(e+1),e=(l.includeShape&&a.appendChild(this.getSeriesShape(e,t.seriesConfig.shape,t.seriesConfig.color)),this.createText(p.plotOptions,s,e,t.name+": ",p.plotOptions.font.size.tipBody)),i=document.createElementNS(this.ns,"tspan");i.setAttribute("font-weight","bold"),i.textContent=D.Utils.formatNumber(this.application.options.intl,t.value,p.plotOptions.dataLabels.format),e.appendChild(i),a.appendChild(e)}),o&&(t=n+20*(i.length+1),e=D.Utils.formatNumber(this.application.options.intl,i.reduce((t,e)=>t+e.value,0),p.plotOptions.dataLabels.format),o=this.createText(p.plotOptions,s,t,"Total: "+e,p.plotOptions.font.size.tipBody,{"font-weight":"bold"}),a.appendChild(o)),r.appendChild(a),r}}).filter(t=>null!=t));t.append(...i),e.appendChild(t)}}addMarkerPoints(a,t){var e=document.createElementNS(this.ns,"g"),i=(e.setAttribute("class","ka-chart-marker-points"),this.createCircle(t[0].x,t[0].y,12,t[0].seriesConfig.color));return i.setAttribute("opacity","0"),i.setAttribute("class","ka-chart-point-glow"),e.appendChild(i),e.append(...t.map(t=>{var e=this.createPointMarker(t.x,t.y,t.seriesConfig.color),i=D.Utils.formatNumber(this.application.options.intl,t.value,a.plotOptions.dataLabels.format);return e.setAttribute("aria-label",`${t.seriesConfig.text}, ${i}. ${this.getHeader(a.plotOptions,t.name)}.`),e.setAttribute("ka-chart-point",t.x+","+t.y),e})),e}getHeader(t,e){return t.tip.headerFormatter?.replace("{x}",e)??e}addPlotLines(t,s,r=0,e){if(0!=s.plotOptions.xAxis.plotLines.length){let a=s.plotOptions.padding;var i=document.createElementNS(this.ns,"g");i.setAttribute("class","ka-chart-plot-lines");let n=e??s.plotOptions.xAxis.plotBandSegmentWidth;e=s.plotOptions.xAxis.plotLines.filter(t=>s.plotOptions.xAxis.minCategory<t.value&&t.value<s.plotOptions.xAxis.maxCategory).map(t=>{var e=a.left+n+(t.value-r)/.5*n,i=this.createLine(e,a.top,e,s.plotOptions.yAxis.baseY,t.color,2),e=t.label?.text?this.createText(s.plotOptions,e,a.top-3,t.label.text,s.plotOptions.font.size.plotBandLine,{"text-anchor":"start","dominant-baseline":"baseline"}):void 0;return e?[e,i]:[i]});i.append(...e.flat()),t.appendChild(i)}}addPlotBands(t,l,p=0,c,e){if(0!=l.plotOptions.xAxis.plotBands.length){let n=l.plotOptions.padding,s=l.plotOptions.plotHeight;var i=document.createElementNS(this.ns,"g");i.setAttribute("class","ka-chart-plot-bands");let r=e??l.plotOptions.xAxis.plotBandSegmentWidth,o=void 0;e=l.plotOptions.xAxis.plotBands.filter(t=>t.from<l.plotOptions.xAxis.maxCategory&&t.to>l.plotOptions.xAxis.minCategory).map(t=>{var e=n.left+r+Math.max(-.5,t.from-p)/.5*r,i=n.left+r+Math.min(t.to-p,l.data.length-.5)/.5*r,i=this.createRect(e,n.top,i-e,s,t.color);let a=t.label?.[c??"text"]??t.label?.text;t=a+"|"+t.color,o==t&&(a=void 0),o=t,t=a?this.createText(l.plotOptions,e,n.top-3,a,l.plotOptions.font.size.plotBandLabel,{"text-anchor":"start","dominant-baseline":"baseline"}):void 0;return t?[t,i]:[i]});i.append(...e.flat()),t.appendChild(i)}}addXAxis(t,a,e){var i=a.plotOptions.padding;let n=a.plotOptions.column;var s=document.createElementNS(this.ns,"g"),i=(s.setAttribute("class","ka-chart-x-axis"),this.createLine(i.left,a.plotOptions.yAxis.baseY,a.plotOptions.width-i.right,a.plotOptions.yAxis.baseY)),i=(s.appendChild(i),e.map((t,e)=>{var i=n.getX(e);if(e%a.plotOptions.xAxis.skipInterval==0)return this.createText(a.plotOptions,i+n.width/2,a.plotOptions.yAxis.baseY+2+a.plotOptions.font.size.xAxisTickLabels,t.name,a.plotOptions.font.size.xAxisTickLabels,{"text-anchor":"middle"},!0)}));s.append(...i.filter(t=>null!=t)),a.plotOptions.xAxis.label&&(e=a.plotOptions.padding.left+a.plotOptions.plotWidth/2,i=a.plotOptions.height-1.5*a.plotOptions.font.size.xAxisLabel,e=this.createText(a.plotOptions,e,i,a.plotOptions.xAxis.label,a.plotOptions.font.size.xAxisLabel,{"text-anchor":"middle","dominant-baseline":"middle"}),s.appendChild(e)),t.appendChild(s)}addYAxis(t,a){let n=a.plotOptions.padding,s=a.plotOptions.plotHeight;var e=document.createElementNS(this.ns,"g"),i=(e.setAttribute("class","ka-chart-y-axis"),a.plotOptions.font.size.yAxisLabel),r=s/2,i=a.plotOptions.yAxis.label?this.createText(a.plotOptions,i,r,a.plotOptions.yAxis.label,a.plotOptions.font.size.yAxisLabel,{fill:"black","text-anchor":"middle",transform:`rotate(-90, ${i}, ${r})`}):void 0;let o=a.plotOptions.yAxis.maxValue,l=a.plotOptions.yAxis.intervalSize;r=Array.from({length:Math.ceil(o/l)+1},(t,e)=>e*l).flatMap((t,e)=>{var i=n.top+s-t/o*s,e=0!=e?this.createLine(n.left,i,a.plotOptions.width-n.right,i,"#e6e6e6"):void 0,i=this.createText(a.plotOptions,n.left-7,i+.25*a.plotOptions.font.size.yAxisTickLabels,D.Utils.formatNumber(this.application.options.intl,t,a.plotOptions.yAxis.format),a.plotOptions.font.size.yAxisTickLabels,{"text-anchor":"end"});return e?[e,i]:[i]});null!=i&&e.appendChild(i),e.append(...r),t.appendChild(e)}getWrappedColumnLabels(a,t){t=t.split(" ");let n=[],s="";return t.forEach(t=>{var e=s?s+" "+t:t,i=e.length*a.font.size.xAxisTickLabels*a.font.size.heuristic;s=i<=a.column.maxLabelWidth?e:(s&&n.push(s),t)}),s&&n.push(s),n}getChartSvgElement(t){var e=document.createElementNS(this.ns,"svg");return e.setAttribute("viewBox",`0 0 ${t.width} `+t.height),e.setAttribute("preserveAspectRatio","xMidYMid meet"),e.setAttribute("class","ka-chart"),e}getSeriesShape(t,e,i){switch(e){case"circle":return this.createCircle(5,t-5,5,i);case"line":return this.createLine(0,t-5,10,t-5,i,2);default:return this.createRect(0,t-10,10,10,i)}}createText(a,n,t,e,i,s={},r){let o=document.createElementNS(this.ns,"text");if(o.setAttribute("x",String(n)),o.setAttribute("y",String(t)),o.setAttribute("font-size",i+"px"),s)for(var[l,p]of Object.entries(s))o.setAttribute(l,String(p));return r?this.getWrappedColumnLabels(a,e).forEach((t,e)=>{var i=document.createElementNS(this.ns,"tspan");i.setAttribute("x",String(n)),i.setAttribute("dy",String(0===e?0:a.font.size.xAxisTickLabels+5)),i.textContent=t,o.appendChild(i)}):o.textContent=e,o}createLine(t,e,i,a,n="black",s=1){var r=document.createElementNS(this.ns,"line");return r.setAttribute("x1",String(t)),r.setAttribute("y1",String(e)),r.setAttribute("x2",String(i)),r.setAttribute("y2",String(a)),n&&(r.setAttribute("stroke",n),r.setAttribute("stroke-width",String(s))),r}createCircle(t,e,i,a,n,s){var r=document.createElementNS(this.ns,"circle");return r.setAttribute("cx",String(t)),r.setAttribute("cy",String(e)),r.setAttribute("r",String(i)),r.setAttribute("fill",a),n&&(r.setAttribute("stroke",n),r.setAttribute("stroke-width",String(s))),r}createPointMarker(t,e,i,a=7){t=`M ${t} ${e-a} L ${t+a} ${e} L ${t} ${e+a} L ${t-a} ${e} Z`,a=document.createElementNS("http://www.w3.org/2000/svg","path");return a.setAttribute("d",t),a.setAttribute("fill",i),a.setAttribute("stroke","#ffffff"),a.setAttribute("stroke-width","1"),a.setAttribute("opacity","0"),a.setAttribute("class","ka-chart-point"),a.setAttribute("tabindex","-1"),a.setAttribute("role","img"),a.setAttribute("style","outline: none;"),a}createPath(t,e,i,a="none",n=1){var s=document.createElementNS("http://www.w3.org/2000/svg","path");return s.setAttribute("d",t),s.setAttribute("fill",a),s.setAttribute("fill-opacity",n.toString()),s.setAttribute("stroke",e),s.setAttribute("stroke-width",i.toString()),s}createRect(t,e,i,a,n,s,r){var o=document.createElementNS(this.ns,"rect");return o.setAttribute("x",String(t)),o.setAttribute("y",String(e)),o.setAttribute("width",String(i)),o.setAttribute("height",String(a)),o.setAttribute("fill",n),s&&(o.setAttribute("stroke",s),o.setAttribute("stroke-width",String(r))),o}getOptionJson(t,e,i){t=t.find(t=>0===String.compare(t.id,e,!0))?.value??(i?i(e):void 0);return t?JSON.parse(t):void 0}getOptionValue(t,e,i,a){return t.find(t=>0===String.compare(t.id,e,!0))?.value??(i?i(e):void 0)??a}getOptionNumber(t,e,i,a){t=t.find(t=>0===String.compare(t.id,e,!0))?.value??(i?i(e):void 0)??String(a);if(null!=t)return Number(t)}}})(KatApps=KatApps||{}),!function(KatApps){class DirectiveKaHighchart{name="ka-highchart";cultureEnsured=!1;application=void 0;getDefinition(c){return o=>{this.application=c;let l=o.el,p;return o.effect(()=>{if("object"!=typeof Highcharts)KatApps.Utils.trace(c,"DirectiveKaHighchart","getDefinition","Highcharts javascript is not present.",TraceVerbosity.None,o.exp);else{let e=o.get();var a=c.state.rbl.source(`HighCharts-${e.data}-Data`,e.ce,e.tab);let t=c.state.rbl.source(`HighCharts-${e.options??e.data}-Options`,e.ce,e.tab),i=c.state.rbl.source("HighCharts-Overrides",e.ce,e.tab,t=>0==String.compare(t.id,e.data,!0));var n=a.filter(t=>!t.category.startsWith("config-")),a=a.filter(t=>t.category.startsWith("config-"));if(Highcharts.charts[+(l.getAttribute("data-highcharts-chart")??"-1")]?.destroy(),0<n.length){this.ensureCulture();var s=function(e){return i.find(t=>0===String.compare(t.key,e,!0))?.value??t.find(t=>0===String.compare(t.key,e,!0))?.value},r=s("config-style");if(void 0!==r){let t=l.getAttribute("style")??"";""===t||t.endsWith(";")||(t+=";"),l.setAttribute("style",t+r)}r=s("chart.type"),s=this.removeRBLEncoding(s("config-tooltipFormat")),r=this.getChartOptions(r,s,n,t,i,a);try{Highcharts.chart(l,r),(p=Highcharts.charts[+l.getAttribute("data-highcharts-chart")])?.reflow()}catch(t){KatApps.Utils.trace(c,"DirectiveKaHighchart","getDefinition","Error during highchart creation.",TraceVerbosity.None,o.exp,t)}}}}),()=>{p?.destroy()}}}getChartOptions(t,e,i,a,n,s){let r={};a.concat(n).filter(t=>!t.key.startsWith("config-")).forEach(t=>{this.setApiOption(r,t.key,t.value)});a=i[0],n=Object.keys(a),a=n.filter(t=>t.startsWith("series")),t="pie"!==t&&"solidgauge"!==t&&"scatter3d"!==t;return r.series=this.buildSeries(n,a,s,i,t),t&&(r.xAxis=this.getXAxisOptions(r.xAxis,i)),r.tooltip=this.getTooltipOptions(e,a,s)??r.tooltip,r}getTooltipOptions(o,i,a){if(void 0!==o){let e=a.find(t=>"config-format"===t.category),s=i.filter(e=>0===a.filter(t=>"config-visible"===t.category&&"0"===t[e]).length).map(t=>e?.[t]??"c0"),r=this.application,t=r.options.intl.currentCulture;return{formatter:function(){let i="",a=0,n=t.startsWith("fr")?"<br/>{{name}} : {{value}}":"<br/>{{name}}: {{value}}";return this.points.forEach((t,e)=>{0<t.y&&(i+=String.formatTokens(r.options.intl,n,{name:t.series.name,value:KatApps.Utils.formatCurrency(r.options.intl,t.y,s[e])}),a+=t.y)}),String.formatTokens(r.options.intl,o,{x:this.x,stackTotal:KatApps.Utils.formatCurrency(r.options.intl,a,s[0]),seriesDetail:i})},shared:!0}}}getXAxisOptions(t,n){var t=t??{},e=(t.categories=n.map(t=>this.removeRBLEncoding(t.category)??""),n.map((t,e)=>({index:e,plotLine:t.plotLine??"",plotBand:t.plotBand??""})).filter(t=>""!==t.plotLine||""!==t.plotBand));let s=[],r=[];return e.forEach(t=>{var e,i,a;""!==t.plotLine&&(e=(i=t.plotLine.split("|"))[0],a=Number(i[1]),i=2<i.length?Number(i[2]):0,e={color:e,value:t.index+i,width:a,zIndex:1},s.push(e)),""!==t.plotBand&&(a=(i=t.plotBand.split("|"))[0],e=i[1],i=2<i.length?Number(i[2]):0,a={color:a,from:0===String.compare(e,"lower",!0)?-1:t.index+i,to:0===String.compare(e,"lower",!0)?t.index+i:0===String.compare(e,"higher",!0)?n.length:t.index+Number(e)+i},r.push(a))}),0<s.length&&(t.plotLines=s),0<r.length&&(t.plotBands=r),t}buildSeries(n,t,s,r,o){let l=[];return t.forEach(i=>{var t=0===s.filter(t=>"config-visible"===t.category&&"0"===t[i]).length,a=0<s.filter(t=>"config-hidden"===t.category&&"1"===t[i]).length;if(t){let e={};t=s.filter(t=>-1===["config-visible","config-hidden","config-format"].indexOf(t.category)&&void 0!==t[i]).map(t=>({key:t.category.substring(7),value:t[i]}));e.data=r.map(t=>this.getSeriesDataRow(t,n,i,o)),t.forEach(t=>{this.setApiOption(e,t.key,t.value)}),a&&(e.visible=!1,e.showInLegend=e.showInLegend??!1),l.push(e)}}),l}getSeriesDataRow(e,t,i,a){let n={y:+e[i],id:i+"."+e.category},s=(a||(n.name=e.category),"point."+i+".");return t.filter(t=>t.startsWith(s)).forEach(t=>{n[t.substring(s.length)]=this.getOptionValue(e[t])}),n}setApiOption(t,e,i){let a=t;var n=e.split("."),s=this.getOptionValue(i);for(let i=0;i<n.length;i++){let t=n[i],e=-1;t.endsWith("]")&&(r=t.split("["),t=r[0],e=parseInt(r[1].substring(0,r[1].length-1)));var r=i===n.length-1,o=r?s:{},l=-1<e&&null!=a[t]&&a[t].length-1<e;if(void 0===a[t])a[t]=-1<e?[o]:o;else if(r||l)if(-1<e){for(var p=a[t];p.length-1<e;)p.push(void 0);p[e]=o}else a[t]=o;a=-1<e?a[t][e]:a[t]}}getOptionValue(value){let d=Number(value);if(void 0!==value&&0!==String.compare(value,"null",!0)){if(isNaN(d)||""===value){if(0===String.compare(value,"true",!0))return!0;if(0===String.compare(value,"false",!0))return!1;if(value.startsWith("resource:"))return this.application?.getLocalizedString(value.substring(9));if(value.startsWith("json:"))return JSON.parse(value.substring(5));if(value.startsWith("var ")){let v=value.substring(4);return function(){return eval(v)}}if(value.startsWith("eval ")){let v=value.substring(5);return eval(v)}if(value.startsWith("function ")){let f=this.removeRBLEncoding(`function f() ${value.substring(value.indexOf("{"))} f.call(this);`);return function(){return eval(f)}}return this.removeRBLEncoding(value)}return d}}ensureCulture(){if(!this.cultureEnsured){this.cultureEnsured=!0;let t=this.application;(this.application.state.rbl.value("variable","culture")??"en-").startsWith("en-")||Highcharts.setOptions({yAxis:{labels:{formatter:function(){return null!=this.value?KatApps.Utils.formatCurrency(t.options.intl,this.value,"c0"):""}},stackLabels:{formatter:function(){return null!=this.value?KatApps.Utils.formatCurrency(t.options.intl,this.value,"c0"):""}}}})}}removeRBLEncoding(t){return void 0===t?t:t.replace(/<</g,"<").replace(/&lt;&lt;/g,"<").replace(/>>/g,">").replace(/&gt;&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;nbsp;/g,"&nbsp;")}}KatApps.DirectiveKaHighchart=DirectiveKaHighchart}(KatApps=KatApps||{}),(t=>{t.DirectiveKaInline=class{name="ka-inline";getDefinition(a){return e=>{let i=e.el.getAttribute("v-ka-id")??t.Utils.generateId();return e.el.classList.remove("ka-inspector-inline"),e.effect(()=>{e.get();e.el.hasAttribute("v-ka-id")?document.querySelectorAll(`[v-ka-inline-id='${i}']`).forEach(t=>t.remove()):e.el.setAttribute("v-ka-id",i),("TEMPLATE"===e.el.tagName?[...e.el.content.children]:[...e.el.children]).forEach(t=>{t=t.cloneNode(!0);"0"!=a.options.debug.showInspector&&t.classList.add("ka-inspector-inline"),t.setAttribute("v-ka-inline-id",i),e.el.before(t)})}),()=>{document.querySelectorAll(`[v-ka-inline-id='${i}']`).forEach(t=>t.remove())}}}}})(KatApps=KatApps||{}),(n=>{class t{name="ka-modal";getDefinition(a){return t=>{async function e(t){t.preventDefault();try{null!=i.beforeOpenAsync&&await i.beforeOpenAsync(a);var e=await a.showModalAsync(n.Utils.clone(i,(t,e)=>-1<["beforeOpenAsync","confirmedAsync","cancelledAsync","catchAsync"].indexOf(t)?void 0:e),t.currentTarget);e.confirmed?null!=i.confirmedAsync?await i.confirmedAsync(e.data,a):n.Utils.trace(a,"DirectiveKaModal","showModal",`Modal App ${i.view} confirmed.`,TraceVerbosity.Normal,e.data):null!=i.cancelledAsync?await i.cancelledAsync(e.data,a):n.Utils.trace(a,"DirectiveKaModal","showModal",`Modal App ${i.view} cancelled.`,TraceVerbosity.Normal,e.data)}catch(t){null!=i.catchAsync?await i.catchAsync(t,a):n.Utils.trace(a,"DirectiveKaModal","showModal",`Modal App ${i.view} failed.`,TraceVerbosity.None,t)}finally{null!=i.closed&&i.closed(a)}}let i;return t.effect(()=>{i=t.get();try{null!=i.model&&(i=t.get(i.model))}catch(t){n.Utils.trace(a,"DirectiveKaModal","getDefinition","Unable to compile 'model' property: "+i.model,TraceVerbosity.None,t)}"A"==t.el.tagName&&t.el.setAttribute("href","#"),t.el.removeEventListener("click",e),t.el.addEventListener("click",e)}),()=>t.el.removeEventListener("click",e)}}}n.DirectiveKaModal=t})(KatApps=KatApps||{}),(o=>{class t{name="ka-navigate";getDefinition(r){return t=>{let n=t.get();try{null!=n.model&&(n=t.get(n.model))}catch(t){o.Utils.trace(r,"DirectiveKaNavigate","getDefinition","Unable to compile 'model' property: "+n.model,TraceVerbosity.None,t)}async function e(t){if(t.preventDefault(),n.clearDirty&&(r.state.isDirty=!1),null==n.confirm||(await r.showModalAsync(n.confirm,t.currentTarget)).confirmed){var e=n.inputs??(null!=n.ceInputs?{}:void 0);if(null!=n.ceInputs){var i,a=o.Utils.getObjectFromAttributes(n.ceInputs);for(i in a)(i.startsWith("i")||i.startsWith("data-input-"))&&(e[i.startsWith("i")?i:"i"+i.split("-").slice(2).map(t=>t[0].toUpperCase()+t.slice(1)).join("")]=a[i])}await r.navigateAsync(s,{inputs:e,persistInputs:n.persistInputs??!1})}return!1}let s=n.view;return"A"==t.el.tagName&&t.el.setAttribute("href","#"),t.el.addEventListener("click",e),()=>t.el.removeEventListener("click",e)}}}o.DirectiveKaNavigate=t})(KatApps=KatApps||{}),(KatApps||(KatApps={})).DirectiveKaResource=class{name="ka-resource";getDefinition(n){return i=>{let a=""!=i.el.innerHTML?i.el.innerHTML:void 0;i.effect(()=>{var t=i.exp.startsWith("{")?i.get():{key:(""!=i.exp?i.exp:void 0)??i.el.innerHTML};let e=t.key??i.el.innerHTML;null!=e&&-1==e.indexOf("^")&&null!=t.templateArguments&&(e=[e,...t.templateArguments].join("^")),i.el.innerHTML=null!=a?n.getLocalizedString(e,t,a):n.getLocalizedString(e,t),i.el.setAttribute("data-resource-key",e),-1!=n.missingResources.findIndex(t=>t==e)?i.el.classList.add("missing"):i.el.classList.remove("missing"),-1!=n.missingLanguageResources.findIndex(t=>t==e)?i.el.classList.add("missing-culture"):i.el.classList.remove("missing-culture")})}}},(()=>{class t{name="ka-table";getDefinition(m){return s=>{s.effect(()=>{let g=s.get();var n=m.state.rbl.source(g.name,g.ce,g.tab);if(s.el.replaceChildren(),0<n.length){let t=null!=g.css?`rbl ${g.name} `+g.css:`rbl ${g.name} table table-sm table-hover`,i=-1<t.indexOf("table-responsive"),e=(t=t.replace("table-responsive",""),n[0]),l=[],p={},a=!1,c=(Object.keys(e).filter(t=>t.startsWith("text")||t.startsWith("value")).map(t=>({Name:t,Element:e[t],Meta:e["@"+t]??{},Width:e["@"+t]?.[i?"@r-width":"@width"]})).forEach(t=>{var e={name:t.Name,isTextColumn:t.Name.startsWith("text"),cssClass:t.Meta["@class"],width:void 0===t.Width||t.Width.endsWith("%")?void 0:+t.Width,widthPct:void 0!==t.Width&&t.Width.endsWith("%")?t.Width:void 0,xsColumns:(null!=t.Meta["@xs-width"]?+t.Meta["@xs-width"]:void 0)||(i&&null!=t.Meta["@width"]?+t.Meta["@width"]:void 0),smColumns:null!=t.Meta["@sm-width"]?+t.Meta["@sm-width"]:void 0,mdColumns:null!=t.Meta["@md-width"]?+t.Meta["@md-width"]:void 0,lgColumns:null!=t.Meta["@lg-width"]?+t.Meta["@lg-width"]:void 0};void 0===e.xsColumns&&void 0===e.smColumns&&void 0===e.mdColumns&&void 0===e.lgColumns||(a=!0),l.push(e),p[t.Name]=e}),t=>{var e=t.code??"",t=t.id??"";return"h"===e||e.startsWith("header")||e.startsWith("hdr")||"h"===t||t.startsWith("header")||t.startsWith("hdr")}),u=(e,t,i,a)=>t&&""==i&&1===(t=Object.keys(e).filter(t=>t.startsWith("text")||t.startsWith("value")).map(t=>({Name:t,Value:e[t]??"",Class:`${p[t].isTextColumn?"text":"value"} span-${g.name}-${t} `+(a?.(0,l.length-1)??"")})).filter(t=>""!==t.Value)).length?t[0]:void 0,d=(e,t,i)=>{var a,n,s,r,o=t.split(":"),l=[];for(let t=0;t<o.length;t++)t%2==0&&(a=+o[t+1],n=o[t],s=((r=p[n]).cssClass??"").trim(),r=`${r.isTextColumn?"text":"value"} ${0<s.length?s+" ":""}span-${g.name}-${a} `+(i?.(0,a-1)??""),l.push({Value:e[n]??"",Class:r,Span:a}));return l},h=(t,e)=>{e=e.trim().split(" ").map(t=>t.trim()).filter(t=>""!==t);0!==e.length&&t.classList.add(...e)};if(a&&!i){let a=(i,a)=>{var t=l.filter((t,e)=>i<=e&&e<=i+a),e=t.reduce((t,e)=>t+(e.xsColumns??0),0),n=t.reduce((t,e)=>t+(e.smColumns??0),0),s=t.reduce((t,e)=>t+(e.mdColumns??0),0),t=t.reduce((t,e)=>t+(e.lgColumns??0),0),e=0<e?" col-xs-"+e:"";return(e=(e+=0<n?" col-sm-"+n:"")+(0<s?" col-md-"+s:"")+(0<t?" col-lg-"+t:"")).trim()},r=document.createElement("div");n.forEach(n=>{var t=c(n);let s=document.createElement("div");h(s,`${n["@class"]??n.class??""} row tr-row `+(t?"h-row":""));var e,i=n.span??"",t=u(n,t,i,a);null!=t?(e=document.createElement("div"),h(e,t.Class),e.innerHTML=m.getLocalizedString(t.Value),s.appendChild(e)):""!=i?s.append(...d(n,i,a).map(t=>{var e=document.createElement("div");return h(e,t.Class),e.innerHTML=m.getLocalizedString(t.Value),e})):l.forEach(t=>{var e,i,a=document.createElement("div");h(a,`${e=t,i=void 0!==e.xsColumns?" col-xs-"+e.xsColumns:"",(i=(i=(i=(i+=void 0!==e.smColumns?" col-sm-"+e.smColumns:"")+(void 0!==e.mdColumns?" col-md-"+e.mdColumns:""))+(void 0!==e.lgColumns?" col-lg-"+e.lgColumns:""))+(" "+(e.cssClass??""))).trim()} ${t.isTextColumn?"text":"value"} ${g.name}-`+t.name),a.innerHTML=m.getLocalizedString(n[t.name])??"",s.append(a)}),r.append(s)}),s.el.append(r)}else{let r=document.createElement("table"),o=(h(r,t),r.appendChild((()=>{let i=document.createElement("colgroup");return l.forEach(t=>{void 0===t.width&&void 0===t.widthPct||(t.widthPct??t.width);var e=document.createElement("col");e.setAttribute("class",g.name+"-"+t.name),void 0===t.width&&void 0===t.widthPct||e.setAttribute("width",t.widthPct??t.width+"px"),i.append(e)}),i})()),void 0);n.forEach(i=>{var t=c(i);t&&null==o?(o=document.createElement("thead"),r.append(o)):t||"TBODY"==o?.tagName||(o=document.createElement("tbody"),r.append(o));let a=document.createElement("tr"),n=(h(a,`${i["@class"]??i.class??""} `+(t&&"TBODY"==o.tagName?"h-row":"")),t?"th":"td");var e,s=i.span??"",t=u(i,t,s);null!=t?(e=document.createElement(n),h(e,t.Class),e.innerHTML=m.getLocalizedString(t.Value),a.appendChild(e)):""!=s?a.append(...d(i,s).map(t=>{var e=document.createElement(n);return h(e,t.Class),e.setAttribute("colspan",t.Span.toString()),e.innerHTML=m.getLocalizedString(t.Value),e})):l.forEach(t=>{var e=document.createElement(n);h(e,`${t.cssClass??""} ${t.isTextColumn?"text":"value"} ${g.name}-`+t.name),e.innerHTML=m.getLocalizedString(i[t.name])??"",a.append(e)}),o.append(a)}),i?((n=document.createElement("div")).classList.add("table-responsive"),n.append(r),s.el.append(n)):s.el.append(r)}}})}}}(KatApps||(KatApps={})).DirectiveKaTable=t})(),(t=>{t.Directives=class{static initializeCoreDirectives(e,i){[new t.DirectiveKaAttributes,new t.DirectiveKaInline,new t.DirectiveKaResource,new t.DirectiveKaChart,new t.DirectiveKaHighchart,new t.DirectiveKaTable,new t.DirectiveKaValue,new t.DirectiveKaNavigate,new t.DirectiveKaModal,new t.DirectiveKaApp,new t.DirectiveKaApi].forEach(t=>{e.directive(t.name,t.getDefinition(i))})}}})(KatApps=KatApps||{}),(()=>{class t{name="ka-value";getDefinition(n){return t=>{let e=t.exp.startsWith("{")?t.get():void 0;null!=e&&null==e.table&&(e.table="rbl-value");function i(t){return a.length>t&&""!=a[t]?a[t]:void 0}let a=(t.exp.startsWith("{")?void 0:t.exp)?.split(".").map(t=>""!=t?t:void 0)??[];1==a.length&&(a=["rbl-value",a[0]]);t.effect(()=>{t.el.innerHTML=n.getLocalizedString(n.state.rbl.value(e?.table??i(0),e?.keyValue??i(1),e?.returnField??i(2),e?.keyField??i(3),e?.ce??i(4),e?.tab??i(5))??t.el.innerText)})}}}(KatApps||(KatApps={})).DirectiveKaValue=t})(),(()=>{class o{static currentPopoverTarget;static visiblePopover;static visiblePopoverApp;static visiblePopupContentSource;static hideVisiblePopover(t){var e=o.visiblePopover;return!("true"!=e?.getAttribute("ka-init-tip")||null!=t&&!o.visiblePopoverApp.el.matches(t)||(bootstrap.Popover.getInstance(e).hide(),0))}static processHelpTips(t,e,i){if("true"!=document.querySelector("html").getAttribute("ka-init-tip")){let e;var a=document.querySelector("html");a.setAttribute("ka-init-tip","true"),a.addEventListener("click",t=>{var t=t.target,e=t.closest("a, button"),t=null!=t.closest(".popover-header, .popover-body"),i=null!=e&&e.classList.contains("ka-ht-js"),e=e?.tagName;"BUTTON"!=e&&("A"!=e||i)&&t||o.hideVisiblePopover()}),a.addEventListener("keyup",t=>{"Escape"==t.key&&(t.preventDefault(),o.hideVisiblePopover())}),a.addEventListener("inserted.bs.tooltip",t=>{var t=t.target,e="#"+t.getAttribute("aria-describedby"),e=document.querySelector(e);t.classList.contains("is-invalid")?e?.classList.add("is-invalid"):t.classList.contains("is-warning")&&e?.classList.add("is-warning")}),a.addEventListener("inserted.bs.popover",async t=>{var t=t.target,e=KatApp.get(t)??KatApp.applications.find(t=>t.options.canProcessExternalHelpTips)??KatApp.applications[0],t="#"+t.getAttribute("aria-describedby"),i=(document.querySelector(t).classList.add("kaPopup"),e.cloneOptions(!1));let a=!1;null!=o.visiblePopupContentSource&&(!0===(a=e.getCloneHostSetting(o.visiblePopupContentSource))&&(a=e.selector),i.cloneHost=a),o.visiblePopoverApp=await KatApp.createAppAsync(t,i)}),a.addEventListener("show.bs.popover",t=>{null!=e&&(clearTimeout(e),e=void 0),o.hideVisiblePopover(),o.currentPopoverTarget=t.target}),a.addEventListener("shown.bs.popover",t=>o.visiblePopover=t.target),a.addEventListener("hide.bs.popover",t=>{null!=o.visiblePopoverApp&&KatApp.remove(o.visiblePopoverApp),o.visiblePopover=void 0,o.visiblePopoverApp=void 0,o.visiblePopupContentSource=void 0,e=setTimeout(()=>{o.currentPopoverTarget=void 0,e=void 0},200)})}var n,s,r;(i??(n=e??"[data-bs-toggle='tooltip'], [data-bs-toggle='popover']",s=KatApp.get(t),r="A"==t.tagName||"BUTTON"==t.tagName?t.parentElement:t,s?.selectElements(n,r))??[...document.querySelectorAll(n)]).forEach(s=>{if("true"!=s.getAttribute("ka-init-tip")){let i="tooltip"==s.getAttribute("data-bs-toggle"),a=("LABEL"==s.parentElement?.tagName&&null!=s.parentElement?.parentElement?.querySelector("input[type=checkbox]")&&s.addEventListener("click",t=>{t.stopPropagation(),s.click()}),(t,e,i)=>e?.selectElement(t,i)??document.querySelector(t)??void 0),n=function(t){var e,i=t.getAttribute("data-bs-content-selector");return null!=i?(o.visiblePopupContentSource=a(i,KatApp.get(t)),null==o.visiblePopupContentSource?void 0:o.visiblePopupContentSource.cloneWithEvents()):(i=t.getAttribute("data-bs-content")??t.nextElementSibling?.innerHTML,null!=(e=t.getAttribute("data-label-fix"))?i.replace(/\{Label}/g,a("."+e,KatApp.get(t)).innerHTML):i)};var t={html:!0,sanitize:!1,trigger:s.getAttribute("data-bs-trigger")??"hover",container:(e=>{if(e.hasAttribute("data-bs-container"))return a(e.getAttribute("data-bs-container"),KatApp.get(e));if(null==e.parentElement)return e;{let t=e;for(;(t=t.parentElement)&&t!==document;)if("LABEL"==t.tagName)return t.parentElement;return e.parentElement}})(s),template:i?'<div class="tooltip katapp-css" role="tooltip"><div class="tooltip-arrow arrow"></div><div class="tooltip-inner"></div></div>':'<div v-scope class="popover katapp-css" role="tooltip"><div class="popover-arrow arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',placement:(t,e)=>{var i=e.getAttribute("data-bs-class");return null!=i&&t.classList.add(i),"auto"!=e.getAttribute("data-bs-width")&&(i=`${e.getAttribute("data-bs-width")??"350"}px`,t.style.width=i,t.style.maxWidth=i,null!=(e=t.querySelector(".tooltip-inner")))&&(e.style.width=i,e.style.maxWidth=i),s.getAttribute("data-bs-placement")??"auto"},fallbackPlacements:s.getAttribute("data-bs-fallback-placements")?.split(",")??["top","right","bottom","left"],title:function(){var t=this;if(i)return n(t);var e=t.getAttribute("data-bs-content-selector");if(null!=e){e=a(e+"Title",KatApp.get(t));if(""!=(e?.innerHTML??""))return e.innerHTML}return""},content:function(){return n(this)}};new(i?bootstrap.Tooltip:bootstrap.Popover)(s,t),s.setAttribute("ka-init-tip","true")}})}}(KatApps||(KatApps={})).HelpTips=o})(),(t=>{t[t.None=0]="None",t[t.Quiet=1]="Quiet",t[t.Minimal=2]="Minimal",t[t.Normal=3]="Normal",t[t.Detailed=4]="Detailed",t[t.Diagnostic=5]="Diagnostic"})(TraceVerbosity=TraceVerbosity||{}),!function(){(KatApps||(KatApps={})).KamlCompiler=class{showInspector;applicationId;constructor(t){this.showInspector="0"!=t.options.debug.showInspector,this.applicationId=t.id}compileMarkup(t,a){let n=document.querySelector("ka-resources");if(a!=this.applicationId){var s=a.split(":");let e=s[s.length-1].split("?")[0].replace(/\//g,"_"),i=null!=n.querySelector(`style[ka=${e}]`);t.querySelectorAll("style").forEach(t=>{i?t.remove():(t.setAttribute("ka",e),n.appendChild(t))})}this.processMarkup(t),t.querySelectorAll("template[id]").forEach(e=>{var t=a.split(":"),t=t[t.length-1].split("?")[0].replace(/\//g,"_");e.id=e.id+"_"+t,null==n.querySelector(`template[id=${e.id}]`)?(this.processMarkup(e.content),e.hasAttribute("input")&&(this.mountInputs(e.content),e.removeAttribute("input")),e.content.querySelectorAll("style, script").forEach(t=>{this.addMountAttribute(t,"mounted",`_templateItemMounted('${e.id}', $el, $data)`),"SCRIPT"==t.tagName&&this.addMountAttribute(t,"unmounted",`_templateItemUnmounted('${e.id}', $el, $data)`)}),n.appendChild(e)):e.remove()})}checkVueSyntax(t){let e=!1;if(t.querySelectorAll("[v-for][v-if]").forEach(t=>{console.error(t),e=!0}),e)throw new Error("v-for and v-if on same element.  The v-for should be moved to a child <template v-for/> element.");if(t.querySelectorAll("[v-ka-inline]").forEach(t=>{"TEMPLATE"==t.tagName&&t.hasAttribute("v-html")||(console.error(t),e=!0)}),e)throw new Error("v-ka-inline can only be used on <template/> elements and must have a v-html attribute.");if(t.querySelectorAll("template:not([id])").forEach(t=>{[...t.content.children].filter(t=>t.hasAttribute("v-if")).forEach(t=>{console.error(t),e=!0})}),e)throw new Error("A v-if can not be a direct decendent of an inline <template/>.  Wrap the v-if element with a div.")}processMarkup(t){this.checkVueSyntax(t),t.querySelectorAll("[v-ka-input], [v-ka-input-group], [v-ka-template]").forEach(e=>{if(e.hasAttribute("v-ka-input")){let t=e.getAttribute("v-ka-input");t.startsWith("{")||(t=`{ name: '${t}' }`),this.showInspector||e.removeAttribute("v-ka-input"),e.setAttribute("v-scope",`components.input(${t})`),-1==t.indexOf("template:")&&-1==t.indexOf("'template':")&&(-1<["INPUT","SELECT","TEXTAREA"].indexOf(e.tagName)?this.mountInput(e):this.mountInputs(e))}else if(e.hasAttribute("v-ka-input-group")){var i=e.getAttribute("v-ka-input-group");this.showInspector||e.removeAttribute("v-ka-input-group"),e.setAttribute("v-scope",`components.inputGroup(${i})`)}else{var i=/.*?name'?\s*:\s*(?<value>'?[\w\s\.]+'?)/,a=e.getAttribute("v-ka-template"),n=a.startsWith("{")?a:`{ name: '${a}' }`,i=i.exec(n)?.groups.value??"";if(!e.hasAttribute("v-for")&&!i.startsWith("'")){e.removeAttribute("v-ka-template"),e.setAttribute("v-scope","components.template({ name: _reactive_template.name, source: _reactive_template.source})");i=e.getAttribute("v-if");let t=`[${n}]`;null!=i&&(e.removeAttribute("v-if"),t=`(${i}) ? [${n}] : []`),e.outerHTML=`<template v-for="_reactive_template in ${t}" :key="_reactive_template.name">${e.outerHTML}</template>`,this.showInspector&&e.setAttribute("v-ka-template",a)}else e.setAttribute("v-scope",`components.template(${n})`),this.showInspector||e.removeAttribute("v-ka-template")}}),t.querySelectorAll("[v-ka-inline]").forEach(t=>{t.setAttribute("v-ka-inline",t.getAttribute("v-html"))}),t.querySelectorAll("[v-ka-highchart], [v-ka-chart], [v-ka-table], [v-ka-api], [v-ka-navigate]").forEach(t=>{var e,i,a,n;(e=t.hasAttribute("v-ka-highchart"))||t.hasAttribute("v-ka-chart")?(i=t.getAttribute(a=e?"v-ka-highchart":"v-ka-chart")).startsWith("{")||(n=(i=i.split("."))[0],e=2<=i.length?`'${i[1]}'`:e?`'${i[0]}'`:"undefined",t.setAttribute(a,`{ data: '${n}', options: ${e} }`)):t.hasAttribute("v-ka-table")?(i=t.getAttribute("v-ka-table")).startsWith("{")||t.setAttribute("v-ka-table",`{ name: '${i}' }`):t.hasAttribute("v-ka-api")?(a=t.getAttribute("v-ka-api")).startsWith("{")||t.setAttribute("v-ka-api",`{ endpoint: '${a}' }`):t.hasAttribute("v-ka-navigate")&&!(n=t.getAttribute("v-ka-navigate")).startsWith("{")&&t.setAttribute("v-ka-navigate",`{ view: '${n}' }`)}),t.querySelectorAll("[v-ka-rbl-no-calc], [v-ka-rbl-exclude], [v-ka-unmount-clears-inputs]").forEach(t=>{t.hasAttribute("v-ka-rbl-no-calc")&&(t.removeAttribute("v-ka-rbl-no-calc"),t.setAttribute("ka-rbl-no-calc","true")),t.hasAttribute("v-ka-rbl-exclude")&&(t.removeAttribute("v-ka-rbl-exclude"),t.setAttribute("ka-rbl-exclude","true")),t.hasAttribute("v-ka-unmount-clears-inputs")&&(t.removeAttribute("v-ka-unmount-clears-inputs"),t.setAttribute("ka-unmount-clears-inputs","true"))}),t.querySelectorAll("button[v-ka-needs-calc], a[v-ka-needs-calc]").forEach(t=>{let e=t.getAttribute("v-ka-needs-calc");""==e&&(e="<i class='fa-solid fa-rotate-right'></i>&nbsp;Refresh"),this.showInspector||t.removeAttribute("v-ka-needs-calc"),t.setAttribute("v-if","!needsCalculation"),t.classList.add("ka-needs-calc");var i,a,n=t.cloneNode(!0);n.removeAttribute("v-ka-needs-calc");for({name:i,value:a}of[...n.attributes])i.startsWith("@click")&&n.attributes.removeNamedItem(i);n.innerHTML=e,n.setAttribute("v-if","needsCalculation"),t.after(n)}),t.querySelectorAll("[v-for], [v-if], [v-else-if], [v-else]").forEach(t=>{this.addMountAttribute(t,"mounted","_domElementMounted($el)")}),this.showInspector&&t.querySelectorAll("[v-if], [v-show]").forEach(i=>{var e=i.getAttribute("v-if")??i.getAttribute("v-show");if(!i.classList.contains("ka-needs-calc")&&-1==["uiBlocked","!uiBlocked"].indexOf(e)){var a,n=[e],e=i.hasAttribute("v-if");let t=!i.hasAttribute("v-for");if(t&&e){let e=i;for(;["v-else-if","v-else"].some(t=>e.nextElementSibling?.hasAttribute(t));)(e=e.nextElementSibling).hasAttribute("v-else")?t=!1:n.push(e.getAttribute("v-else-if"))}t&&((a=document.createElement("div")).innerHTML=`<i class='fa-solid fa-eye'></i>
<!--
Inspector: ${1<n.length?"v-if/v-else-if":e?"v-if":"v-show"} hidden, ${1<n.length?"all following expression(s) evaluated to false:":"the following expression evaluated to false:"}
${n.map(t=>`	`+t).join("\r\n")}
-->`,a.setAttribute(e?"v-if":"v-show",`!(${n.join(" && ")})`),a.classList.add("v-opposite",e?"ka-inspector-if-hidden":"ka-inspector-show-hidden"),i.before(a))}}),this.showInspector&&this.inspectChildren(t),t.querySelectorAll("template:not([id])").forEach(t=>{this.processMarkup(t.content)})}inspectChildren(t){let e=t.firstChild;for(;e;)e=this.inspectChild(e)??e.nextSibling}delimiters=["{{","}}"];escapeRegex=t=>t.replace(/[-.*+?^${}()|[\]\/\\]/g,"\\$&");delimitersRE=new RegExp(this.escapeRegex(this.delimiters[0])+"([^]+?)"+this.escapeRegex(this.delimiters[1]),"g");directiveRE=/^(?:v-|ka-rbl-|ka-unmount-|:|@)/;inspectChild(t){if(1==t.nodeType){let n=t,a=(this.inspectChildren(n),t=>-1!=["ka-inspector-rbl-no-calc","ka-inspector-rbl-exclude","ka-inspector-unmount-clears-inputs"].indexOf(t)),s=t=>-1!=["v-ka-needs-calc","v-ka-input","v-ka-input-group","v-ka-template"].indexOf(t),r={};var l,p,c=(t,e,i)=>{var a=s(e)?e:t;null==r[a]&&(r[a]=[],n.classList.add(t),"v-ka-needs-calc"==e&&n.nextElementSibling.classList.add(t),s(e))&&n.removeAttribute(e),r[a].push(s(e)?""==i&&"v-ka-needs-calc"==e?"[default]":i:e+`="${i}"`)};for(let{name:e,value:i}of[...n.attributes])this.directiveRE.test(e)&&"v-cloak"!==e&&("@"===e[0]?c("ka-inspector-on",e,i):":"===e[0]?":key"==e&&n.hasAttribute("v-for")||c("ka-inspector-bind",e,i):["ka-highchart","ka-chart"].some(t=>-1<e.indexOf(t))?c("ka-inspector-chart",e,i):e.startsWith("v-ka-")?c("ka-inspector-"+e.substring(5),e,i):e.startsWith("ka-")?c("ka-inspector-"+e.substring(3),e,i):-1!=["v-else-if","v-else"].indexOf(e)?c("ka-inspector-if",e,i):"v-scope"==e&&(i.startsWith("components.template")||i.startsWith("components.input"))||"v-if"==e&&(["ka-needs-calc","ka-inspector-if-hidden","ka-inspector-show-hidden"].some(t=>n.classList.contains(t))||-1<["uiBlocked","!uiBlocked"].indexOf(i))||"v-for"==e&&i.startsWith("_reactive_template")||e.startsWith("v-on:vue:mounted")&&["_domElementMounted","inputMounted","_templateItemMounted"].some(t=>i.startsWith(t))||e.startsWith("v-on:vue:unmounted")&&["inputUnmounted","_templateItemUnmounted"].some(t=>i.startsWith(t))||c("ka-inspector-"+e.split(":")[0].substring(2),e,i));let o=[],e=(t,e,i)=>{a(t)?o.push(""+i+t+": true"):"ka-inspector-pre"!=t&&o.push(1<e.length?""+i+t+" expressions:\r\n"+e.map(t=>"\t"+t).join("\r\n"):""+i+t+": "+e[0])},i="";["ka-inspector-if","ka-inspector-for"].forEach(t=>{null!=r[t]&&(i="\t",e(t,r[t],""))});for([l,p]of Object.entries(r).filter(([t])=>!["ka-inspector-if","ka-inspector-for"].includes(t)))e(l,p,i);if(0<o.length){var u=t=>{var e=t.inspector;return null!=e?(e=e.data.substring(2,e.data.length-2),t.previousSibling?.remove(),delete t.inspector,e.split("\r\n")):[]};let e=n;if(o.push(...u(e).map(t=>null!=r["ka-inspector-if"]?"\t"+t:t)),null!=r["ka-inspector-if"]&&["v-else-if","v-else"].some(t=>n.hasAttribute(t))){let t=n;for(;t=t.previousElementSibling;)if(t.hasAttribute("v-if")){var d=u(e=t);d.push(...o),o=d;break}}e.before(e.inspector=new Comment("\r\n"+o.join("\r\n")+"\r\n"))}}else if(3==t.nodeType&&"SCRIPT"!=t.parentNode.tagName){for(var e,i=t.data,a=t.parentElement,n=[];e=this.delimitersRE.exec(i);)0==n.length&&a.classList.add("ka-inspector-text"),n.push(e[0].trim());0<n.length&&a.before(a.inspector=1<n.length?new Comment("\r\nka-inspector-text bindings:\r\n"+n.map(t=>"\t"+t).join("\r\n")+"\r\n"):new Comment("\r\nka-inspector-text binding: "+n[0]+"\r\n"))}}mountInputs(t){t.querySelectorAll("input:not([v-ka-nomount]), select:not([v-ka-nomount]), textarea:not([v-ka-nomount])").forEach(t=>{this.mountInput(t)}),t.querySelectorAll("template[v-for]").forEach(t=>{this.mountInputs(t.content)})}mountInput(t){this.addMountAttribute(t,"mounted","inputMounted($el, $refs)"),this.addMountAttribute(t,"unmounted","inputUnmounted($el)")}addMountAttribute(t,e,i,a){let n=t.getAttribute("v-on:vue:"+e)??t.getAttribute("@vue:"+e)??"";(a?.(n)??!0)&&(t.removeAttribute("v-on:vue:"+e),t.removeAttribute("@vue:"+e),n.startsWith("handlers.")&&-1==n.indexOf("(")&&(n+="($event)"),t.setAttribute("v-on:vue:"+e,(""!=n?n+";":"")+i))}}}(),(r=>{class o{static resourceRequests={};static async getViewResourceAsync(t){return this.getKamlResourcesAsync(t,[t.options.view],!0)}static async getTemplateResourcesAsync(t,e){return this.getKamlResourcesAsync(t,e,!1)}static async getKamlResourcesAsync(e,t,i){var a=e.options;let n=null!=a.debug.debugResourcesDomain&&(a.useLocalRepository??(a.useLocalRepository=await r.Utils.checkLocalServerAsync(a))),s=await Promise.allSettled(t.map(a=>{if(!i){var t=o.resourceRequests[a];if(null!=t)return new Promise((e,i)=>{t.push(t=>{null!=t?i({resourceKey:a,errorMessage:t,processedByOtherApp:!0}):e({resourceKey:a,processedByOtherApp:!0})})});o.resourceRequests[a]=[]}return this.getResourceAsync(e,a,n)}));a=s.filter(t=>"rejected"==t.status).map(t=>t.reason).map(t=>({exception:t instanceof d?t:void 0,response:t instanceof d?void 0:t})).map(t=>null!=t.exception?{resourceKey:t.exception.resourceKey,processedByOtherApp:!1,errorMessage:t.exception.message}:t.response),t=s.filter(t=>"fulfilled"==t.status).map(t=>t.value);if(0<a.length)throw i||(a.filter(t=>!t.processedByOtherApp).forEach(e=>{o.resourceRequests[e.resourceKey].forEach(t=>t(e.errorMessage)),delete o.resourceRequests[e.resourceKey]}),t.filter(t=>!t.processedByOtherApp).forEach(t=>{o.resourceRequests[t.resourceKey].forEach(t=>t()),delete o.resourceRequests[t.resourceKey]})),new l("Failed to download Kaml repositoryItems.",a.map(t=>({resource:t.resourceKey,errorMessage:t.errorMessage})));{let e={};return t.filter(t=>!t.processedByOtherApp).forEach(t=>{e[t.resourceKey]=t.content}),e}}static resolveTemplate(t){this.resourceRequests[t].forEach(t=>t()),delete this.resourceRequests[t]}static async downloadResourceAsync(t,e,i=!1){var a,n=new Headers(e?{}:{"Cache-Control":"max-age=0"}),s=await fetch(t,{method:"GET",headers:n,cache:e?void 0:"default"});return s.ok?{data:await s.text()}:(a=404==s.status?"Resource not found.":400==s.status?(await s.json()).detail:`Status: ${s.status}, StatusText: `+s.statusText,console.error({url:t,cache:!e,status:s.status,statusText:a,requestHeaders:Object.fromEntries(n.entries()),responseHeaders:Object.fromEntries(s.headers.entries())}),i||500!=s.status&&415!=s.status?{errorMessage:a}:await this.downloadResourceAsync(t,e,!0))}static async getResourceAsync(i,a,n){var t=i.options.endpoints.relativePathTemplates?.[a],s=(null!=t?t:a).split(":");let r=s[1];var o=s[0].split("|"),l=2<s.length?s[2]:i.options.debug.useTestView?"Test":"Live",t=r.split("?"),e=t[0];e.endsWith(".kaml")||(r=e+".kaml",2==t.length&&(r+="?"+t[1]));let p=r,h="unavailable",c={errorMessage:"unavailable"};for(let e=0;e<o.length;e++){let t=o[e];var g=0!=String.compare(t,"Rel",!0),u=(g||(u=r.split("/").slice(2),t=u[0],p=u.slice(1).join("/")),"https://"+i.options.debug.debugResourcesDomain+"/KatApp/"+t+"/"+p);if(h=n?u.substring(0,4)+u.substring(5):g?i.options.endpoints.katDataStore:i.options.endpoints.baseUrl+r.substring(1),!n&&g?h=h.replace("{name}",r)+`?clients=${s[0].split("|").join(",")}&preferTest=`+("Test"==l):2==(g=i.getApiUrl(h,!0).url.split("?")).length&&(h=h.split("?")[0]+"?"+g[1]),null!=(c=await this.downloadResourceAsync(h,n)).data){let t=c.data;if(n){var g=a.split("?")[0],m=g.split("/"),m=m[m.length-1].split(":");let u=m[m.length-1];m=t.match(/local-kaml-package=\"(.*?)\"/)?.[1].split(",").map(t=>t.trim().toLowerCase())??[];let d=-1<g.toLowerCase().indexOf("templates")||-1<m.indexOf("template.items");if(u.endsWith(".kaml")&&(0<m.length||d)){let s=-1==m.indexOf("js")?void 0:await this.downloadResourceAsync(h.replace(u,u+".js"),!0),r=-1==m.indexOf("css")?void 0:await this.downloadResourceAsync(h.replace(u,u+".css"),!0),o=-1==m.indexOf("templates")?void 0:await this.downloadResourceAsync(h.replace(u,u+".templates"),!0),l=t.split("\n"),p=/^\s*<template[^>]* id="[^"]+"([^>]* script="(?<script>[^"]+)")?([^>]* script\.setup="(?<setup>[^"]+)")?([^>]* css="(?<css>[^"]+)")?[^>]*>\s*$/,c=null;g=await Promise.all(l.map(async(t,e)=>{var i,a,n;return 0<=t.indexOf("</rbl-config>")?(null!=s?.data&&(t+=`
<script>
	(function () {
${s.data.split("\n").map(t=>"\t\t"+t).join("\n")}
	})();
	//# sourceURL=${u}
</script>
`),null!=r?.data&&(t+=`
<style>
${r.data.split("\n").map(t=>"\t"+t).join("\n")}
</style>
`),e==l.length-1&&null!=o?.data&&(t+="\n"+o.data.split("\n").map(t=>"\t"+t).join("\n"))):d&&null!=(c=t.match(p))&&(e=c.groups?.setup,n=c.groups?.script,i=c.groups?.css,null!=e&&(e=u+`.${e}.js`,null!=(a=await this.downloadResourceAsync(h.replace(u,e),!0))?.data)&&(t+=`
	<script setup>
${a.data.split("\n").map(t=>"\t\t"+t).join("\n")}
		//# sourceURL=${e}
	</script>
`),null!=n&&(a=u+`.${n}.js`,null!=(e=await this.downloadResourceAsync(h.replace(u,a),!0))?.data)&&(t+=`
	<script>
${e.data.split("\n").map(t=>"\t\t"+t).join("\n")}
		//# sourceURL=${a}
	</script>
`),null!=i)&&(n=u+`.${i}.css`,null!=(e=await this.downloadResourceAsync(h.replace(u,n),!0))?.data)&&(t+=`
	<style>
${e.data.split("\n").map(t=>"\t\t"+t).join("\n")}
	</style>
`),t}));t=g.join("\n")}}return{resourceKey:a,content:t,processedByOtherApp:!1}}}if(n)return this.getResourceAsync(i,a,!1);throw new d("getResourceAsync failed requesting from "+h+": "+c.errorMessage,a)}}r.KamlRepository=o;class l extends Error{results;constructor(t,e){super(t),this.results=e}}r.KamlRepositoryError=l;class d extends Error{resourceKey;constructor(t,e){super(t),this.resourceKey=e}}r.KamlResourceDownloadError=d})(KatApps=KatApps||{}),(()=>{Element.prototype._addEventListener=Element.prototype.addEventListener,Element.prototype._removeEventListener=Element.prototype.removeEventListener;let t=["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","mouseenter","mouseleave","keydown","keyup","keypress","focus","blur","change","input","submit","reset","load","unload","resize","scroll","contextmenu","wheel","drag","dragstart","dragend","dragenter","dragleave","dragover","drop","touchstart","touchmove","touchend","touchcancel"],r=e=>t.find(t=>t===e.split(".")[0])??e;Element.prototype.addEventListener=function(t,e,i){this._addEventListener(r(t),e,i),null==this.kaEventListeners&&(this.kaEventListeners={}),null==this.kaEventListeners[t]&&(this.kaEventListeners[t]=[]);e={type:t,listener:e,options:i};return this.kaEventListeners[t].push(e),e},Element.prototype.removeEventListener=function(t,e,i){let a,n,s;s="object"==typeof t?(a=t.listener,n=t.options,t.type):(a=e,n=i,t),this._removeEventListener(r(s),a,n),null!=this.kaEventListeners&&null!=this.kaEventListeners[s]&&-1!==(e=this.kaEventListeners[s].findIndex(t=>t.listener===a&&t.options===n))&&(this.kaEventListeners[s].splice(e,1),0==this.kaEventListeners[s].length&&delete this.kaEventListeners[s],0==Object.keys(this.kaEventListeners).length)&&delete this.kaEventListeners},Element.prototype.cloneWithEvents=function(){var t=this.cloneNode(!0);for(t.classList.remove(...t.classList);0<t.attributes.length;)t.removeAttribute(t.attributes[0].name);return function e(t,i){void 0!==t.kaEventListeners&&Object.keys(t.kaEventListeners).forEach(e=>{t.kaEventListeners[e].forEach(t=>{i.addEventListener(r(e),t.listener,t.options)})});var a=t.children,n=i.children;for(let t=0;t<a.length;t++)e(a[t],n[t])}(this,t),t},null==String.compare&&(String.compare=function(t,e,i){return void 0===t&&void 0===e?0:void 0===t?-1:void 0===e?1:(i&&(t=t.toUpperCase(),e=e.toUpperCase()),t===e?0:t<e?-1:1)}),void 0===String.formatTokens&&(String.formatTokens=function(r,t,o){return t.replace(/{{([^}]+)}}/g,function(t,e){var i=e.split(":"),a=i[0],i=2==i.length?i[1]:void 0;let n="object"==typeof o[a]?o[a]["#text"]??o[a]:o[a];if(null!=n&&null!=i){var a=/^-?\d+(\.\d+)?$/,s=n.match(/(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})(?:T.*)?/);if(null!=s)n=KatApps.Utils.formatDate(r.currentCulture,new Date(parseInt(s.groups.year),parseInt(s.groups.month)-1,parseInt(s.groups.day)),i);else if(a.test(n)){s=parseFloat(n);if(!isNaN(s))if(i.startsWith("p"))n=KatApps.Utils.formatPercent(r.currentCulture,s,i);else{if(!(i.startsWith("c")||i.startsWith("n")||i.startsWith("f")))throw new Error(`Invalid String.formatTokens format string: ${i}, value: `+s);n=KatApps.Utils.formatNumber(r,s,i)}}}return n??`{{${e}}}`})})})(),!function(t){class e{static chunk(e,i){var a=[];for(let t=0;t<e.length;t+=i)a.push(e.slice(t,t+i));return a}static extend(e,...t){return t.forEach(t=>{void 0!==t&&this.copyProperties(e,t)}),e}static extendWithReplacer(e,i,...t){return t.forEach(t=>{void 0!==t&&this.copyProperties(e,t,i)}),e}static clone(t,e){return this.copyProperties({},t,e)}static copyProperties(i,a,n){return Object.keys(a).forEach(t=>{var e=null!=n?n(t,a[t]):a[t];null==e||"hostApplication"==t||"object"!=typeof e||e instanceof HTMLElement||e instanceof Promise||Array.isArray(e)?null==e&&null!=n||(i[t]=e):(void 0!==i[t]&&"object"==typeof i[t]||(i[t]={}),this.copyProperties(i[t],e,n))}),i}static generateId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})};static parseQueryString(t){var e={};if(null!=t&&""!=t){var i=(t.startsWith("?")?t.substr(1):t).split("&");for(let t=0;t<i.length;++t){var a=i[t].split("=",2);2===a.length&&(e[a[0].toLowerCase()]=decodeURIComponent(a[1].replace(/\+/g," ")))}}return e}static generateQueryString(e,i){let a="";return Object.keys(e).forEach(t=>{null!=i&&!i(t)||(a+=`${t}=${e[t]}&`)}),0<a.length?"?"+a.substring(0,a.length-1):void 0}static pageParameters=this.readPageParameters();static _pageParameters;static readPageParameters(){return this._pageParameters??(this._pageParameters=this.parseQueryString(window.location.search))}static getObjectFromAttributes(t){for(var e,i=new RegExp("[\\s\\r\\t\\n]*([a-z0-9\\-_]+)[\\s\\r\\t\\n]*=[\\s\\r\\t\\n]*(['\"])((?:\\\\\\2|(?!\\2).)*)\\2","ig"),a={};e=i.exec(t);)a[e[1]]=e[3];return a}static trace(t,e,i,a,n,...s){var r,o,l,p;n<=(t.options.debug.traceVerbosity??TraceVerbosity.None)&&(n=new Date,e=e+`	KatApp Framework`,r=t.selector??t.id,o=t.traceStart,l=t.traceLast,o=Math.abs(n.getTime()-o.getTime()),l=Math.abs(n.getTime()-l.getTime()),p=t=>String(t).padStart(2,"0"),p=`${[(n=t.traceLast=n).getFullYear(),p(n.getMonth()+1),p(n.getDate())].join("-")} ${[p(n.getHours()),p(n.getMinutes()),p(n.getSeconds())].join(":")+":"+p(Math.floor(n.getMilliseconds()/10))}	${String(o).padStart(5,"0")}	${String(l).padStart(5,"0")}	${t.options.dataGroup}	${r??"Unavailable"}	${e}	${i}: `+a,0<s.length?(console.group(p),s.forEach(t=>t instanceof Error?console.error({i:t}):console.log(t)),console.groupEnd()):console.log(p))}static async checkLocalServerAsync(t){return null!=await this.downloadLocalServerAsync(t.debug.debugResourcesDomain,"/js/ping.js")}static async downloadLocalServerAsync(t,e,a){let n="https://"+t+e;var i=await(async()=>{let t=new AbortController;var e=setTimeout(()=>t.abort(),1e3);try{var i=await fetch(a?n:n.substring(0,4)+n.substring(5),{method:"GET",signal:t.signal});return clearTimeout(e),i}catch(t){return clearTimeout(e),{ok:!1}}})();return i.ok?i.text():a?void 0:await this.downloadLocalServerAsync(t,e,!0)}static setSessionItem(t,e,i){t.delegates.setSessionItem(t.delegates.getSessionKey(e),i)}static getSessionItem(t,e,i=!1){e=t.delegates.getSessionKey(e);return t.delegates.getSessionItem(e,i)}static removeSessionItem(t,e){t.delegates.removeSessionItem(t.delegates.getSessionKey(e))}static formatCurrency(t,e,i){i=parseInt(i.slice(1)),i=isNaN(i)?2:i;return Intl.NumberFormat(t.currentCulture,{style:"currency",currency:t.currencyCode,minimumFractionDigits:i,maximumFractionDigits:i}).format(e)}static formatNumber(t,e,i="n"){var a;return"c"==i[0]?this.formatCurrency(t,e,i):(a=i.toLowerCase().startsWith("n"),i=parseInt(i.slice(1)),i=isNaN(i)?0:i,Intl.NumberFormat(t.currentCulture,{style:"decimal",useGrouping:a,minimumFractionDigits:i,maximumFractionDigits:i}).format(e))}static formatPercent(t,e,i="p",a){i=parseInt(i.slice(1)),i=isNaN(i)?0:i;let n=e;return(!0===a||1<n&&null==a)&&(n/=100),Intl.NumberFormat(t,{style:"percent",minimumFractionDigits:i,maximumFractionDigits:i}).format(n)}static formatDate(r,t,e="g"){let o=t instanceof Date?t:new Date(t);if("s"==e)return o.toISOString().slice(0,19);if("dv"==e)return o.toISOString().slice(0,10);switch(e){case"d":return Intl.DateTimeFormat(r,{year:"numeric",month:"numeric",day:"numeric"}).format(o);case"t":return Intl.DateTimeFormat(r,{timeStyle:"short"}).format(o);case"g":return Intl.DateTimeFormat(r,{year:"numeric",month:"numeric",day:"numeric"}).format(o)+" "+Intl.DateTimeFormat(r,{timeStyle:"medium"}).format(o);case"trace":var l=o,p=t=>String(t).padStart(2,"0");return[l.getFullYear(),p(l.getMonth()+1),p(l.getDate())].join("-")+" "+([p(l.getHours()),p(l.getMinutes()),p(l.getSeconds())].join(":")+":"+p(Math.floor(l.getMilliseconds()/10)));default:{p=/M{1,4}|d{1,4}|y{1,4}/g,l=[...e.matchAll(p)];let n=2==(l.find(t=>-1<t[0].indexOf("y"))?.[0].length??4)?"2-digit":"numeric";var c=l.find(t=>-1<t[0].indexOf("M"))?.[0].length??1;let s=1==c?"numeric":2==c?"2-digit":3==c?"short":"long",i=l.find(t=>-1<t[0].indexOf("d"))?l.filter(t=>-1<t[0].indexOf("d")).map(t=>t[0]):["d"],a=i.reduce((t,e)=>{var i=e.length,a=1==i?"numeric":2==i?"2-digit":void 0,i=3==i?"short":4==i?"long":void 0;return t[e]=Intl.DateTimeFormat(r,{year:n,month:s,day:a,weekday:i}).formatToParts(o),t},{});return e.replace(p,t=>{var e=a[t]||a[i[0]];switch(t[0].toLowerCase()){case"m":return e.find(t=>"month"==t.type).value;case"d":return(e.find(t=>"day"==t.type)??e.find(t=>"weekday"==t.type)).value;case"y":return e.find(t=>"year"==t.type).value;default:return t}})}}}}t.Utils=e}(KatApps=KatApps||{});