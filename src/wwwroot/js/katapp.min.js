class KatApp{selector;static applications=[];static globalEventConfigurations=[];static getDirty(){return this.applications.filter(e=>e.state.isDirty)}static remove(t){t.isMounted&&t.vueApp.unmount(),$("template[id$='"+t.id+"']").remove(),this.applications=this.applications.filter(e=>e.id!=t.id)}static get(i){if("number"==typeof i)return this.applications[i];if("string"==typeof(i="object"==typeof i?i.closest("[ka-id]")?.getAttribute("ka-id")??"":i)&&""!=i){var e=this.applications.find(e=>e.id==i||e.selector==i);if(null!=e)return e;let t=document.querySelectorAll(i);if(1<(t=0!=t.length||i.startsWith(".")||i.startsWith("#")?t:document.querySelectorAll("."+i)).length)throw new Error("Unable to find a unique application with the key of "+i);if(1==t.length&&t[0].hasAttribute("ka-id"))return this.applications.find(e=>e.id==t[0].getAttribute("ka-id"))}}static handleEvents(e,t){var i={};t(i),this.globalEventConfigurations.push({selector:e,events:i})}static async createAppAsync(e,t){let i;try{return i=new KatApp(e,t),this.applications.push(i),await i.mountAsync(),i}catch(e){throw $(".kaModal").remove(),null!=i&&KatApp.remove(i),e}}id;isCalculating;lastCalculation;options;state;el;traceStart;traceLast;missingResources=[];missingLanguageResources=[];applicationCss;vueApp;viewTemplates;mountedTemplates={};isMounted=!1;pushToTables=[];configureOptions;calcEngines=[];uiBlockCount=0;eventConfigurations=[];domElementQueued=!1;domElementQueue=[];updateDomPromise=Promise.resolve();constructor(e,t){this.selector=e,this.traceStart=this.traceLast=new Date;let s=this.id="ka"+KatApps.Utils.generateId();this.applicationCss=".katapp-"+this.id.substring(2);var i={inputCaching:this.isCalculating=!1,canProcessExternalHelpTips:!1,debug:{traceVerbosity:"1"===KatApps.Utils.pageParameters.tracekatapp?TraceVerbosity.Diagnostic:TraceVerbosity.None,showInspector:KatApps.Utils.pageParameters.showinspector??(null!=KatApps.Utils.pageParameters.localserver?"1":"0"),useTestCalcEngine:"1"===KatApps.Utils.pageParameters.test,useTestView:"1"===KatApps.Utils.pageParameters.testview,debugResourcesDomain:KatApps.Utils.pageParameters.localserver},calculationUrl:"https://btr.lifeatworkportal.com/services/evolution/CalculationFunction.ashx",katDataStoreUrl:"https://btr.lifeatworkportal.com/services/camelot/datalocker/api/kat-apps/{name}/download",kamlVerifyUrl:"api/katapp/verify-katapp",encryptCache:e=>"string"==typeof e?e:JSON.stringify(e),decryptCache:e=>e.startsWith("{")?JSON.parse(e):e},i=(this.options=KatApps.Utils.extend({},i,t),this.nextCalculation),i=(i.trace&&(i.originalVerbosity=this.options.debug.traceVerbosity,this.nextCalculation=i,this.options.debug.traceVerbosity=TraceVerbosity.Detailed),null==t.modalAppOptions?$(e):void 0);if(null!=i&&1!=i.length)throw new Error("'selector' of '"+this.selector+"' did not match any elements.");if(null==i&&null==t.modalAppOptions)throw new Error("No 'selector' or 'modalAppOptions' were provided.");this.el=i??this.createModalContainer(),this.domElementQueue=[this.el[0]],this.el.attr("ka-id",this.id),this.el.addClass("katapp-css "+this.applicationCss.substring(1)),null==this.el.attr("v-scope")&&this.el.attr("v-scope",""),null!=this.el.attr("ka-cloak")||null==t.view&&null==t.content&&!1===(t.cloneHost??!1)||this.el.attr("ka-cloak",""),null==document.querySelector("ka-resources")&&((e=document.createElement("ka-resources")).innerHTML=`<style>
	ka-resources, [v-cloak], [ka-cloak] { display: none; }
	.kaModalInit { cursor: progress; }
	body.ka-inspector-value .ka-inspector-value { border: 2px dashed #78aff6; }
	body.ka-inspector-api .ka-inspector-api { border: 2px dotted #785900; }
	body.ka-inspector-app .ka-inspector-app { border: 2px dotted #785900; }
	body.ka-inspector-modal .ka-inspector-modal { border: 2px dotted #785900; }
	body.ka-inspector-navigate .ka-inspector-navigate { border: 2px dotted #785900; }
	body.ka-inspector-highcharts .ka-inspector-highcharts { border: 2px dotted #087849; }
	body.ka-inspector-attributes .ka-inspector-attributes { border: 2px dashed #34495E; }
	body.ka-inspector-inline .ka-inspector-inline { border: 2px dashed #fcce00; }
	body.ka-inspector-table .ka-inspector-table { border: 2px dotted #444; }
	body.ka-inspector-rbl-no-calc .ka-inspector-rbl-no-calc, body.ka-inspector-rbl-exclude .ka-inspector-rbl-exclude { border: 2px dotted #f93b1d; }
	body.ka-inspector-unmount-clears-inputs .ka-inspector-unmount-clears-inputs { border: 2px dotted #f93b1d; }
	body.ka-inspector-needs-calc .ka-inspector-needs-calc { border: 2px dotted #f93b1d; }
	body.ka-inspector-template .ka-inspector-template { border: 2px dotted #10a84a; }
	body.ka-inspector-input .ka-inspector-input, body.ka-inspector-input-group .ka-inspector-input-group { border: 2px dotted #770519; }
	body.ka-inspector-on .ka-inspector-on { border: 2px dotted #ff9e76; }
	body.ka-inspector-bind .ka-inspector-bind { border: 2px dotted #78aff6; }
	body.ka-inspector-html .ka-inspector-html { border: 2px dashed #b6de29; }
	body.ka-inspector-text .ka-inspector-text { border: 2px dashed #b6de29; }
	body.ka-inspector-pre .ka-inspector-pre { border: 2px dotted #f93b1d; }
	body.ka-inspector-scope .ka-inspector-scope { border: 2px dotted #57625a; }
	body.ka-inspector-for .ka-inspector-for { border: 2px dotted #f93b1d; }
	body .ka-inspector-if-hidden { display: none; color: #b232c0; }
	body .ka-inspector-show-hidden { display: none; color: #b232c0; }
	body.ka-inspector-if .ka-inspector-if-hidden, body.ka-inspector-show .ka-inspector-show-hidden { display: block; }
	body.ka-inspector-if .ka-inspector-if { border: 2px dotted #b232c0; }
	body.ka-inspector-show .ka-inspector-show { border: 2px dotted #b232c0; }
	body.ka-inspector-resource .ka-inspector-resource { border: 3px dashed #2067b3; }
	body.ka-inspector-resource .ka-inspector-resource.missing { border: 3px dashed #f93b1d; }
	body.ka-inspector-resource .ka-inspector-resource.missing-culture { border: 3px dashed #10a84a; }
</style>`,document.body.appendChild(e));function a(...e){var t=1==e.length?"rbl-value":e[0];let i=1==e.length?e[0]:e[1];var a=3<=e.length?e[2]:void 0;let s=4<=e.length?e[3]:void 0;var n=5<=e.length?e[4]:void 0,e=6<=e.length?e[5]:void 0;return l(t,n,e).find(e=>e[s??"id"]==i)?.[a??"value"]}let n=this,r=function(t,e){var i=t?n.calcEngines.find(e=>e.key==t):n.calcEngines[0];if(null==i)throw new Error(`Can not find CalcEngine ${t} in rbl-config.`);e=e??i.resultTabs[0];if(-1==i.resultTabs.indexOf(e))throw new Error(`Can not find Tab ${e} for ${t} in rbl-config.`);return i.key+"."+e},l=function(e,t,i){t=r(t,i);return n.state.rbl.results[t]?.[e]??[]},o=e=>null==e||("string"==typeof e?-1==["false","0","n","no"].indexOf(e.toLowerCase()):!!e);i=this.getCloneApplication(this.options);function c(e,t,i,a=!1){if(!a&&null==e._ka)throw new Error("Can not use mergeRows on a rbl.results tabDef.  Please use rbl.pushTo instead.");null==e[t]&&(e[t]=[]);let s=e[t];(i instanceof Array?i:[i]).forEach((t,e)=>{t.id=t.id??"_pushId_"+(s.length+e);e=s.findIndex(e=>e.id==t.id);-1<e?s.splice(e,1,t):s.splice(s.length,0,t)})}let p=!1;t={kaId:this.id,application:this,lastInputChange:Date.now(),inputsChanged:!1,get isDirty(){return p??this.inputsChanged},set isDirty(e){((p=e)??!0)||(this.inputsChanged=!1)},uiBlocked:!1,canSubmit(e){return(e?this.inputsChanged:this.isDirty)&&0==this.errors.filter(e=>e.id.startsWith("i")).length&&!this.uiBlocked},needsCalculation:!1,inputs:KatApps.Utils.extend({getOptionText:e=>n.select(`.${e} option:selected`).text(),getNumber:e=>{var t,i,e=n.state.inputs[e];if(null!=e)return t=Sys.CultureInfo.CurrentCulture.numberFormat.CurrencyDecimalSeparator,i=new RegExp(`[^-0-9${t}]+`,"g"),e=parseFloat(e.replace(i,"").replace(t,".")),isNaN(e)?void 0:e}},this.options.inputs,this.getSessionStorageInputs()),errors:[],warnings:[],onAll(...e){return null==e.find(e=>""==(e??"")||!o(e))},onAny(...e){return null!=e.find(e=>""!=(e??"")&&o(e))},rbl:{results:i?KatApps.Utils.clone(i.state.rbl.results):{},mergeRows(e,t,i){c(e,t,i,!1)},pushTo(e,t,i,a){i=r(i,a),a=n.state.rbl.results[i];null!=a&&(c(a,e,t,!0),n.pushToTables.push(i+"."+e))},boolean(){var e=Array.from(arguments),t=e.filter(e=>"boolean"!=typeof e),i=e[0],i=1==t.length?this.value("rbl-value",i)??this.value("rbl-display",i)??this.value("rbl-disabled",i)??this.value("rbl-skip",i):a(...t),t=e.find(e=>"boolean"==typeof e);return null==i&&null!=t?t:o(i)},text(){return n.getLocalizedString(a(...arguments))},value(){return a(...arguments)},number(){var e=+(a(...arguments)??0);return isNaN(e)?0:e},source(e,t,i,a){return"function"==typeof t?(a=t,t=void 0):"function"==typeof i&&(a=i,i=void 0),a?l(e,t,i).filter(e=>a(e)):l(e,t,i)},exists(e,t,i,a){return"function"==typeof t?(a=t,t=void 0):"function"==typeof i&&(a=i,i=void 0),a?0<l(e,t,i).filter(e=>a(e)).length:0<l(e,t,i).length}},model:i?KatApps.Utils.clone(i.state.model):{},handlers:i?KatApps.Utils.clone(i.state.handlers??{}):{},components:{},_domElementMounted(t){if(!n.el[0].hasAttribute("ka-cloak")){if(!n.domElementQueue.includes(n.el[0])&&!n.domElementQueue.includes(t)){let e=!0;for(var i=n.domElementQueue.length;i--;){var a=n.domElementQueue[i];t.contains(a)?n.domElementQueue.splice(i,1):a.contains(t)&&(e=!1,i=0)}e&&n.domElementQueue.push(t)}n.domElementQueued||(n.domElementQueued=!0,n.updateDomPromise.then(async()=>n.processDomElementsAsync.apply(n)))}},_templateItemMounted:(e,t,i)=>{var a="STYLE"==t.tagName||t.hasAttribute("setup")?"setup":"mount";if(t.removeAttribute("setup"),"setup"==a){a=`${e}_${t.tagName}_${s}_mount`;if(null!=n.mountedTemplates[a])return void t.remove();n.mountedTemplates[a]=!0}"SCRIPT"==t.tagName?(new Function("_a","_s",t.textContent+"\nif ( typeof mounted !== 'undefined' ) mounted(_a, _s);")(n,i),t.remove()):"STYLE"==t.tagName&&(t.outerHTML=t.outerHTML.replace(/thisApplication/g,this.applicationCss))},_templateItemUnmounted:(e,t,i)=>{if("setup"==(t.hasAttribute("setup")?"setup":"mount")){e=`${e}_${t.tagName}_${s}_unmount`;if(null!=n.mountedTemplates[e])return void t.remove();n.mountedTemplates[e]=!0}new Function("_a","_s",t.textContent+"\nif ( typeof unmounted !== 'undefined' ) unmounted(_a, _s);")(n,i)}};this.state=PetiteVue.reactive(t)}getCloneApplication(e){e=e.cloneHost??!1;return"string"==typeof e?KatApp.get(e):!0===e?this.options.hostApplication:void 0}async triggerEventAsync(t,...e){KatApps.Utils.trace(this,"KatApp","triggerEventAsync",`Start: ${t}.`,TraceVerbosity.Detailed);try{"calculation"!=t&&"configureUICalculation"!=t||await PetiteVue.nextTick();var i,a=[...e,this];for(i of this.eventConfigurations.concat(KatApp.globalEventConfigurations.filter(e=>-1<e.selector.split(",").map(e=>e.trim()).indexOf(this.selector)).map(e=>e.events)))try{let e=i[t]?.apply(this.el,a);if(e instanceof Promise&&(e=await e),null!=(s=e)&&"boolean"==typeof s&&-1<["modalAppInitialized","calculateStart","apiStart"].indexOf(t)&&!s)return e}catch(e){e instanceof ApiError||(KatApps.Utils.trace(this,"KatApp","triggerEventAsync",`Error calling ${t}: `+e,TraceVerbosity.None,e),this.addUnexpectedError(e))}return!0}finally{KatApps.Utils.trace(this,"KatApp","triggerEventAsync",`Complete: ${t}.`,TraceVerbosity.Detailed)}var s}configure(e){if(this.isMounted)throw new Error("You cannot call 'configure' after the KatApp has been mounted.");var t,i={events:{}};e(i,this.state.rbl,this.state.model,this.state.inputs,this.state.handlers);let a=!1;for(t in i.events){a=!0;break}return a&&this.eventConfigurations.push(i.events),this.configureOptions=i,this}handleEvents(e){var t={};return e(t,this.state.rbl,this.state.model,this.state.inputs,this.state.handlers),this.eventConfigurations.push(t),this}async mountAsync(){try{KatApps.Utils.trace(this,"KatApp","mountAsync","Start",TraceVerbosity.Detailed),null!=this.options.view&&this.el.attr("data-view-name",this.options.view);let viewElement=await this.getViewElementAsync(),inputs=(this.viewTemplates=null!=viewElement?[...await this.getViewTemplatesAsync(viewElement),this.id].reverse():[this.id],KatApps.Utils.trace(this,"KatApp","mountAsync","View Templates Complete",TraceVerbosity.Detailed),this.options.inputs),processInputTokens=e=>null==e?e:e.replace(/{([^}]+)}/g,function(e,t){return inputs?.[t]??e}),cloneApplication=this.getCloneApplication(this.options);function calcEngineFactory(c,pipelineIndex){var enabled=processInputTokens(c.getAttribute("enabled"));return null==pipelineIndex?{key:c.getAttribute("key")??"default",name:processInputTokens(c.getAttribute("name"))??"UNAVAILABLE",inputTab:c.getAttribute("input-tab")??"RBLInput",resultTabs:processInputTokens(c.getAttribute("result-tabs"))?.split(",")??["RBLResult"],pipeline:Array.from(c.querySelectorAll("pipeline")).map((e,t)=>calcEngineFactory(e,t+1)),allowConfigureUi:"false"!=c.getAttribute("configure-ui"),manualResult:!1,enabled:"false"!=(enabled?.startsWith("!!")?eval(enabled.substring(2)):enabled)}:{key:"pipeline"+pipelineIndex,name:processInputTokens(c.getAttribute("name"))??"UNAVAILABLE",inputTab:c.getAttribute("input-tab"),resultTab:processInputTokens(c.getAttribute("result-tab"))}}if(this.options.hostApplication=this.options.hostApplication??cloneApplication,this.calcEngines=null==cloneApplication&&null!=viewElement?Array.from(viewElement.querySelectorAll("rbl-config > calc-engine")).map(e=>calcEngineFactory(e)):cloneApplication?[...cloneApplication.calcEngines.filter(e=>!e.manualResult)]:[],KatApps.Utils.trace(this,"KatApp","mountAsync","CalcEngines configured",TraceVerbosity.Detailed),null==this.options.resourceStrings&&null!=this.options.resourceStringsEndpoint){let apiUrl=this.getApiUrl(this.options.resourceStringsEndpoint);try{let response=await fetch(apiUrl.url,{method:"GET",headers:{"Cache-Control":"max-age=0"},cache:"default"});if(!response.ok)throw await response.json();this.options.resourceStrings=await response.json(),KatApps.Utils.trace(this,"KatApp","mountAsync","Resource Strings downloaded",TraceVerbosity.Detailed)}catch(e){KatApps.Utils.trace(this,"KatApp","mountAsync","Error downloading resourceStrings "+this.options.resourceStringsEndpoint,TraceVerbosity.None,e)}if(this.options.debug.debugResourcesDomain){let currentOptions=this.options;if(currentOptions.useLocalRepository=currentOptions.useLocalRepository||await KatApps.Utils.checkLocalServerAsync(this.options),currentOptions.useLocalRepository){let devResourceStrings=await KatApps.Utils.downloadLocalServerAsync(currentOptions.debug.debugResourcesDomain,"/js/dev.ResourceStrings.json");null!=devResourceStrings&&(this.options.resourceStrings=KatApps.Utils.extend(this.options.resourceStrings??{},JSON.parse(devResourceStrings)))}}}if(null==this.options.manualResults&&null!=this.options.manualResultsEndpoint){let apiUrl=this.getApiUrl(this.options.manualResultsEndpoint);try{let response=await fetch(apiUrl.url,{method:"GET",headers:{"Cache-Control":"max-age=0"},cache:"default"});if(!response.ok)throw await response.json();this.options.manualResults=await response.json(),KatApps.Utils.trace(this,"KatApp","mountAsync","Manual Results downloaded",TraceVerbosity.Detailed)}catch(e){KatApps.Utils.trace(this,"KatApp","mountAsync","Error downloading manualResults "+this.options.manualResultsEndpoint,TraceVerbosity.None,e)}}if(null!=viewElement&&(null!=this.options.hostApplication&&"1"==this.options.inputs?.iModalApplication?null!=this.options.content?("string"==typeof this.options.content?this.select(".modal-body").html(this.options.content):this.select(".modal-body").append(this.options.content),this.select("[data-bs-toggle='tooltip'], [data-bs-toggle='popover']").removeAttr("ka-init-tip")):this.select(".modal-body").append(viewElement):$(this.el).append(viewElement)),KatApps.Components.initializeCoreComponents(this,e=>this.getTemplateId(e)),Object.defineProperties(this.state.model,Object.getOwnPropertyDescriptors(this.configureOptions?.model??{})),Object.defineProperties(this.state.handlers,Object.getOwnPropertyDescriptors(this.configureOptions?.handlers??{})),null!=this.configureOptions){for(var propertyName in this.configureOptions.components)this.state.components[propertyName]=this.configureOptions.components[propertyName];null!=this.configureOptions.options?.modalAppOptions&&"1"==this.state.inputs.iModalApplication&&KatApps.Utils.extend(this.options,{modalAppOptions:this.configureOptions.options.modalAppOptions}),null!=this.configureOptions.options?.inputs&&KatApps.Utils.extend(this.state.inputs,this.configureOptions.options.inputs)}let isModalApplication=null!=this.options.hostApplication&&"1"==this.options.inputs?.iModalApplication,isNestedApplication=null!=this.options.hostApplication&&"1"==this.options.inputs?.iNestedApplication;if(isModalApplication&&(null!=this.options.modalAppOptions?.buttonsTemplate&&(this.select(".modal-footer-buttons button").remove(),this.select(".modal-footer-buttons").attr("v-scope","components.template({name: '"+this.options.modalAppOptions.buttonsTemplate+"'})")),null!=this.options.modalAppOptions?.headerTemplate&&this.select(".modal-body").prev().attr("v-scope","components.template({name: '"+this.options.modalAppOptions.headerTemplate+"'})").children().remove(),await this.options.hostApplication.triggerEventAsync("modalAppInitialized",this)),isNestedApplication&&await this.options.hostApplication.triggerEventAsync("nestedAppInitialized",this),await this.triggerEventAsync("initialized"),null!=this.options.manualResults){let hasCalcEngines=0<this.calcEngines.length,tabDefs=(this.calcEngines.push(...this.toCalcEngines(this.options.manualResults)),this.options.manualResults.map(e=>({CalcEngine:e["@calcEngine"],TabDef:e}))),manualResultTabDefs=this.toTabDefs(tabDefs);if(!hasCalcEngines){let getSubmitApiConfigurationResults=await this.getSubmitApiConfigurationAsync(async e=>{await this.triggerEventAsync("updateApiOptions",e,this.getApiUrl(this.options.calculationUrl).endpoint)},{},!0);await this.triggerEventAsync("resultsProcessing",manualResultTabDefs,getSubmitApiConfigurationResults.inputs,getSubmitApiConfigurationResults.configuration)}await this.processResultsAsync(manualResultTabDefs,void 0)}this.initializeInspector();let isConfigureUICalculation=0<this.calcEngines.filter(e=>e.allowConfigureUi&&e.enabled&&!e.manualResult).length;if(null==cloneApplication&&0==this.state.errors.length&&isConfigureUICalculation&&(this.handleEvents(e=>{e.calculationErrors=async(e,t)=>{"SubmitCalculation.ConfigureUI"==e&&(this.addUnexpectedError(t),KatApps.Utils.trace(this,"KatApp","mountAsync",isModalApplication?"KatApp Modal Exception":"KatApp Exception",TraceVerbosity.None,t))}}),await this.calculateAsync({_iConfigureUI:"1",iConfigureUI:"1",iDataBind:"1"})),isModalApplication){let modalAppInitialized=await this.triggerEventAsync("modalAppInitialized")??!0;if(!modalAppInitialized)return this.options.modalAppOptions.promise.resolve({confirmed:!1,response:void 0,modalApp:this}),this.el.remove(),KatApp.remove(this),void this.options.hostApplication.unblockUI()}this.state.errors.forEach(e=>e.initialization=!0);let initializationErrors=0<this.state.errors.length;if(this.vueApp=PetiteVue.createApp(this.state),KatApps.Directives.initializeCoreDirectives(this.vueApp,this),null!=this.configureOptions)for(let propertyName in this.configureOptions.directives)this.vueApp.directive(propertyName,this.configureOptions.directives[propertyName]);this.vueApp.mount(this.selector),this.isMounted=!0,initializationErrors||null!=cloneApplication||(isConfigureUICalculation&&this.lastCalculation?(await this.triggerEventAsync("configureUICalculation",this.lastCalculation),await this.triggerEventAsync("calculation",this.lastCalculation),await this.triggerEventAsync("calculateEnd")):null!=this.calcEngines.find(e=>e.manualResult)&&await this.triggerEventAsync("calculation",this.lastCalculation)),isModalApplication&&await this.showModalApplicationAsync(),this.el.removeAttr("ka-cloak"),await this.processDomElementsAsync(),this.state.inputsChanged=!1,await this.triggerEventAsync("rendered",initializationErrors?this.state.errors:void 0),null!=this.options.hostApplication&&"1"==this.options.inputs?.iNestedApplication&&await this.options.hostApplication.triggerEventAsync("nestedAppRendered",this,initializationErrors?this.state.errors:void 0)}catch(ex){throw ex instanceof KatApps.KamlRepositoryError&&KatApps.Utils.trace(this,"KatApp","mountAsync","Error during resource download",TraceVerbosity.None,...ex.results.map(e=>e.resource+": "+e.errorMessage)),ex}finally{KatApps.Utils.trace(this,"KatApp","mountAsync","Complete",TraceVerbosity.Detailed)}}initializeInspector(){"0"!=this.options.debug.showInspector&&$(document.body).off("keydown.ka").on("keydown.ka",function(i){if(i.ctrlKey&&i.shiftKey)if(document.body.classList.contains("ka-inspector"))Array.from(document.body.classList).forEach(e=>{e.startsWith("ka-inspector")&&document.body.classList.remove(e)});else{let e=[{name:"resource",description:"v-ka-resource"},{name:"value",description:"v-ka-value"},{name:"template",description:"v-ka-template"},{name:"for",description:"v-for"},{name:"if",description:"v-if, v-else-if, v-else"},{name:"show",description:"v-show"},{name:"on",description:"v-on:event=, @event="},{name:"bind",description:"v-bind:attribute=, :attribute=, v-bind={ attribute: }"},{name:"html",description:"v-html"},{name:"text",description:"v-text, {{ }}"},{name:"scope",description:"v-scope"},{name:"navigate",description:"v-ka-navigate"},{name:"app",description:"v-ka-app"},{name:"api",description:"v-ka-api"},{name:"modal",description:"v-ka-modal"},{name:"input",description:"v-ka-input"},{name:"input-group",description:"v-ka-input-group"},{name:"no-calc",description:"v-ka-rbl-no-calc",class:"rbl-no-calc"},{name:"exlude",description:"v-ka-rbl-exclude",class:"rbl-exclude"},{name:"unmount",description:"v-ka-unmount-clears-inputs",class:"unmount-clears-inputs"},{name:"needs-calc",description:"v-ka-needs-calc"},{name:"pre",description:"v-pre"},{name:"highcharts",description:"v-ka-highcharts"},{name:"attributes",description:"v-ka-attributes"},{name:"inline",description:"v-ka-inline"},{name:"table",description:"v-ka-table"}];var i=()=>{var e="1"!=(KatApps.Utils.pageParameters.showinspector??"1")?KatApps.Utils.pageParameters.showinspector:"resource,value,modal,template,html,text";return prompt(`What do you want to inspect?

Enter a comma delimitted list of names or numbers.

Type 'help' to see available options displayed in the console.`,e)},a=e.map((e,t)=>`${t}. ${e.name} - `+e.description).join("\r\n");let t=i();"help"==t&&(console.log(a),t=i()),t&&(a=t.split(",").map(e=>e.trim()).map(t=>isNaN(+t)?e.find(e=>e.name==t)??{name:t,class:"ka-inspector-"+t}:+t<e.length?e[+t]:void 0),document.body.classList.add("ka-inspector",...a.filter(e=>null!=e).map(e=>"ka-inspector-"+(e.class??e.name))))}})}createModalContainer(){var e=this.options.modalAppOptions=KatApps.Utils.extend({labels:{cancel:"Cancel",continue:"Continue"},css:{cancel:"btn btn-outline-primary",continue:"btn btn-primary"},showCancel:!0,allowKeyboardDismiss:!0,size:null!=this.options.view?"xl":void 0,scrollable:!1,calculateOnConfirm:!1},this.options.modalAppOptions),t=(e.labels.title=this.getLocalizedString(e.labels.title),e.labels.continue=this.getLocalizedString(e.labels.continue),e.labels.cancel=this.getLocalizedString(e.labels.cancel),e.css.cancel),i=e.css.continue,a=this.options.view??(null!=this.options.modalAppOptions.contentSelector?"selector: "+this.options.modalAppOptions.contentSelector:"static content"),a=$(`<div v-scope class="modal fade kaModal" tabindex="-1" aria-modal="true" aria-labelledby="kaModalLabel" role="dialog" data-bs-backdrop="static"
	:data-bs-keyboard="application.options.modalAppOptions.allowKeyboardDismiss"
	data-view-name="${a}">
	
	<div class="modal-dialog">
		<div class="modal-content" v-scope="{
				get hasInitializationError() { return application.state.errors.find( r => r.initialization ) != undefined; },
				get title() { return application.getLocalizedString(application.options.modalAppOptions.labels.title); },
				get hasHeaderTemplate() { return application.options.modalAppOptions.headerTemplate != undefined; }
			}">
			<div v-if="uiBlocked" class="ui-blocker"></div>
			<div v-if="title != undefined || hasHeaderTemplate"
				:class="['modal-header', { 'invalid-content': hasInitializationError, 'valid-content': !hasInitializationError }]">
				<h2 id="kaModalLabel" class="modal-title" v-html="title ?? ''"></h2>
				<button v-if="application.options.modalAppOptions.allowKeyboardDismiss != false" type="button" class="btn-close" :aria-label="application.getLocalizedString('Close')"></button>
			</div>
			<div class="modal-body"></div>
			<div class="modal-footer">
				<div v-if="hasInitializationError" class="modal-invalid-footer-buttons text-center d-none">
					<button type="button" :class="['${i}', 'continueButton']">${this.getLocalizedString("Close")}</button>
				</div>
				<div v-if="!hasInitializationError" class="modal-footer-buttons text-center d-none">
					<button v-if="application.options.modalAppOptions.showCancel" type="button" :class="['${t}', 'cancelButton', { disabled: uiBlocked}]">${e.labels.cancel}</button>
					<button type="button" :class="['${i}', 'continueButton', { disabled: uiBlocked}]">${e.labels.continue}</button>
				</div>
			</div>
		</div>
	</div>
</div>`);return e.scrollable&&($(".modal-dialog",a).addClass("modal-dialog-scrollable"),$(".modal-body",a).attr("tabindex","0")),null!=e.size&&$(".modal-dialog",a).addClass("modal-dialog-centered modal-"+e.size),null!=this.options.modalAppOptions.view?$("[ka-id]").first().after(a):this.options.hostApplication.el.append(a),a}async showModalApplicationAsync(){let e=$.Deferred();if(this.el.hasClass("show"))return console.log("When this is hit, document why condition is there"),e.resolve(!0),e;function a(){t=!0,KatApps.HelpTips.hideVisiblePopover(),p.hide(),n.el.remove(),KatApp.remove(n),s.triggerLink?.focus()}let s=this.options.modalAppOptions,n=this,t=!1,i=(s.confirmedAsync=async e=>{var t,i;a(),null!=s.calculateOnConfirm&&(t="boolean"!=typeof s.calculateOnConfirm||s.calculateOnConfirm,i="object"==typeof s.calculateOnConfirm?s.calculateOnConfirm:void 0,t)&&await n.options.hostApplication.calculateAsync(i,!0,void 0,!1),s.promise.resolve({confirmed:!0,response:e instanceof Event?void 0:e,modalApp:n})},s.cancelled=e=>{a(),s.promise.resolve({confirmed:!1,response:e instanceof Event?void 0:e,modalApp:n})},0<this.state.errors.length);var r=null!=s.headerTemplate,l=null!=s.buttonsTemplate;let o=l||(s.showCancel??!0),c=async e=>{t||(e.preventDefault(),i?s.cancelled():null!=s.closeButtonTrigger?n.select(s.closeButtonTrigger)[0].click():o?1==n.select(".modal-footer-buttons .cancelButton").length?n.select(".modal-footer-buttons .cancelButton")[0].click():s.cancelled():1==n.select(".modal-footer-buttons .continueButton").length?n.select(".modal-footer-buttons .continueButton")[0].click():await s.confirmedAsync())},p=(this.select(".modal-invalid-footer-buttons .continueButton, .modal-header.invalid-content .btn-close").on("click.ka",async e=>{e.preventDefault(),s.cancelled()}),r||0==s.allowKeyboardDismiss||this.select(".modal-header.valid-content .btn-close").on("click.ka",async e=>c(e)),l||(this.select(".modal-footer-buttons .continueButton").on("click.ka",async e=>{e.preventDefault(),await s.confirmedAsync()}),this.select(".modal-footer-buttons .cancelButton").on("click.ka",function(e){e.preventDefault(),s.cancelled()})),this.el.on("shown.bs.modal",()=>{n.select(".modal-footer-buttons, .modal-invalid-footer-buttons").removeClass("d-none"),e.resolve(!0)}).on("hide.bs.modal",async e=>{KatApps.HelpTips.hideVisiblePopover()?e.preventDefault():await c(e)}),new bootstrap.Modal(this.el[0]));return p.show(s.triggerLink),null!=s.triggerLink&&(s.triggerLink.removeAttribute("disabled"),s.triggerLink.classList.remove("disabled","kaModalInit"),$("body").removeClass("kaModalInit")),this.options.hostApplication.unblockUI(),e}async navigateAsync(e,t){var i;null!=t?.inputs&&(i=null==e?"katapp:navigationInputs:global":t.persistInputs?"katapp:navigationInputs:"+e.split("?")[0]+":"+(this.options.userIdHash??"Everyone"):"katapp:navigationInputs:"+e.split("?")[0],sessionStorage.setItem(i,JSON.stringify(t.inputs))),await this.options.katAppNavigate?.(e)}async calculateAsync(e,i=!0,a,s=!0){var n="1"===e?._iConfigureUI;n||(this.traceStart=this.traceLast=new Date),KatApps.Utils.trace(this,"KatApp","calculateAsync","Start: "+(a??this.calcEngines).map(e=>e.name).join(", "),TraceVerbosity.Detailed);try{let t=this.getApiUrl(this.options.calculationUrl);var r,l=t.url,o=await this.getSubmitApiConfigurationAsync(async e=>{await this.triggerEventAsync("updateApiOptions",e,t.endpoint)},e,!0);if(o.configuration.allowLogging=s,!i)return r=await KatApps.Calculation.calculateAsync(this,l,a??this.calcEngines,o.inputs,o.configuration),this.toTabDefs(r.flatMap(t=>t.TabDefs.map(e=>({CalcEngine:t.CalcEngine,TabDef:e}))));this.isCalculating=!0,this.blockUI(),this.state.errors=[],this.state.warnings=[],this.lastCalculation=void 0;try{var c,p,u=o.inputs,d=o.configuration,h=(delete u._iConfigureUI,await this.triggerEventAsync("calculateStart",d)??!0);if(h)return c=await KatApps.Calculation.calculateAsync(this,l,n?this.calcEngines.filter(e=>e.allowConfigureUi):this.calcEngines,u,d),p=this.toTabDefs(c.flatMap(t=>t.TabDefs.map(e=>({CalcEngine:t.CalcEngine,TabDef:e})))),await this.cacheInputsAsync(u),await this.triggerEventAsync("resultsProcessing",p,u,d),await this.processResultsAsync(p,o),this.lastCalculation={inputs:u,results:p,diagnostics:c.find(e=>null!=e.Diagnostics)?c.flatMap(e=>e.Diagnostics):void 0,configuration:d},n||("1"==u.iConfigureUI&&await this.triggerEventAsync("configureUICalculation",this.lastCalculation),await this.triggerEventAsync("calculation",this.lastCalculation)),this.state.needsCalculation=!1,this.options.debug.traceVerbosity=this.nextCalculation.originalVerbosity,this.nextCalculation=void 0,this.lastCalculation.results}catch(e){e instanceof ApiError||(this.addUnexpectedError(e),n)||KatApps.Utils.trace(this,"KatApp","calculateAsync","Exception: "+(e instanceof Error?e.message:e+""),TraceVerbosity.None,e),await this.triggerEventAsync("calculationErrors","SubmitCalculation"+(n?".ConfigureUI":""),e instanceof Error?e:void 0)}finally{n||await this.triggerEventAsync("calculateEnd"),delete this.state.inputs.iInputTrigger,this.isCalculating=!1,this.unblockUI()}}finally{KatApps.Utils.trace(this,"KatApp","calculateAsync","Complete: "+(a??this.calcEngines).map(e=>e.name).join(", "),TraceVerbosity.Detailed)}}async notifyAsync(e,t,i){await this.triggerEventAsync("notification",t,i,e)}checkValidity(){let i=!0;return this.select("input").each((e,t)=>{!1===t.checkValidity()&&(i=!1)}),i}async apiAsync(t,s,n,e){if(!s?.skipValidityCheck&&!this.checkValidity())throw new ValidityError;this.el[0].hasAttribute("ka-cloak")||(this.traceStart=this.traceLast=new Date);var i,r=(s=s??{}).isDownload??!1;this.blockUI(),this.state.errors=[],this.state.warnings=[];let l=this.getApiUrl(t);try{var o=e??await this.getSubmitApiConfigurationAsync(async e=>{await this.triggerEventAsync("updateApiOptions",e,l.endpoint)},s.calculationInputs,!1),c=this.calcEngines.find(e=>!e.manualResult);let i=["tables","getNumber","getOptionText"],a=["manualResults","manualResultsEndpoint","resourceStrings","resourceStringsEndpoint","modalAppOptions","hostApplication","relativePathTemplates","handlers","nextCalculation","katAppNavigate","decryptCache","encryptCache"];var p={inputs:KatApps.Utils.clone(o.inputs??{},(e,t)=>-1<i.indexOf(e)?void 0:t?.toString()),inputTables:o.inputs.tables?.map(e=>({name:e.name,rows:e.rows})),apiParameters:s.apiParameters,configuration:KatApps.Utils.extend(KatApps.Utils.clone(this.options,(e,t)=>-1<a.indexOf(e)?void 0:t),null!=s.calculationInputs?{inputs:s.calculationInputs}:void 0,null!=c?{calcEngines:[{name:c.name,inputTab:c.inputTab,resultTabs:c.resultTabs,pipeline:c.pipeline}]}:{calcEngines:[]},o.configuration)},u=await this.triggerEventAsync("apiStart",l.endpoint,p,n,s);if("boolean"!=typeof u||u){let i=new FormData;i.append("inputs",JSON.stringify(p.inputs)),null!=p.inputTables&&i.append("inputTables",JSON.stringify(p.inputTables)),null!=p.apiParameters&&i.append("apiParameters",JSON.stringify(p.apiParameters)),i.append("configuration",JSON.stringify(p.configuration)),null!=s.files&&Array.from(s.files).forEach((e,t)=>{i.append("postedFiles["+t+"]",e)});var d,h,g,m,v,b=await fetch(l.url,{method:"POST",body:i});if(!b.ok)throw await b.json();let e=r?await b.blob():void 0;return r||(d=await b.text(),e=JSON.parse(""==d?"{}":d)),r?(h=e,(g=b.headers.get("Content-Disposition"))&&-1!==g.indexOf("attachment")&&g.split("filename=")[1].split(";")[0].replace(/"/g,""),this.downloadBlob(h)):null!=s.calculateOnSuccess&&(m="boolean"!=typeof s.calculateOnSuccess||s.calculateOnSuccess,v="object"==typeof s.calculateOnSuccess?s.calculateOnSuccess:void 0,m)&&await this.calculateAsync(v,!0,void 0,!1),r?void 0:(await this.triggerEventAsync("apiComplete",l.endpoint,e,n,s),e)}}catch(e){if(null!=(i=e??{}).errors)for(var a in i.errors)this.state.errors.push({id:a,text:this.getLocalizedString(i.errors[a][0]),dependsOn:i.errorsDependsOn?.[a]});if(null!=i.warnings)for(var a in i.warnings)this.state.warnings.push({id:a,text:this.getLocalizedString(i.warnings[a][0]),dependsOn:i.warningsDependsOn?.[a]});throw 0==this.state.errors.length&&0==this.state.warnings.length&&this.addUnexpectedError(i),KatApps.Utils.trace(this,"KatApp","apiAsync","Unable to process "+t,TraceVerbosity.None,null!=i.errors?[i,this.state.errors]:i),await this.triggerEventAsync("apiFailed",l.endpoint,i,n,s),new ApiError("Unable to complete API submitted to "+t,e instanceof Error?e:void 0,i)}finally{this.nextCalculation.saveLocations=this.nextCalculation.saveLocations.filter(e=>!e.serverSideOnly),this.unblockUI()}}addUnexpectedError(e){this.state.errors.push(null!=e.requestId?{id:"System",text:this.getLocalizedString("KatApps.AddUnexpectedErrorWithRequestId",e,"We apologize for the inconvenience, but we are unable to process your request at this time. The system has recorded technical details of the issue and our engineers are working on a solution.  Please contact Customer Service and provide the following Request ID: {{requestId}}")}:{id:"System",text:this.getLocalizedString("KatApps.AddUnexpectedError",void 0,"We apologize for the inconvenience, but we are unable to process your request at this time. The system has recorded technical details of the issue and our engineers are working on a solution.")})}downloadBlob(e){var t=document.createElement("a"),e=(t.classList.add("d-none"),window.URL.createObjectURL(e));t.href=e,t.target="_blank",t.click()}getApiUrl(e){var t=this.options.calculationUrl.split("?"),e=e.split("?"),t=KatApps.Utils.parseQueryString(this.options.anchoredQueryStrings??(2==t.length?t[1]:void 0)),i=KatApps.Utils.parseQueryString(2==e.length?e[1]:void 0),a=KatApps.Utils.extend(t,i,{katapp:this.selector??this.id});let s=e[0];return Object.keys(a).forEach((e,t)=>{s+=(0==t?"?":"&")+e+"="+a[e]}),s.startsWith("api/")||(s="api/"+s),{url:this.options.baseUrl?this.options.baseUrl+s:s,endpoint:s.split("?")[0].substring(4)}}async processDomElementsAsync(){function i(e){null!=e.parentElement&&e.parentElement.classList.add("ui-blocker-wrapper")}for(var e of this.domElementQueue)this.select("a[href='#']","A"==e.tagName?e.parentElement:e).off("click.ka").on("click.ka",e=>e.preventDefault()),KatApps.HelpTips.processHelpTips(e),this.select("[data-highcharts-chart]",$(e)).each((e,t)=>$(t).highcharts().reflow()),e.classList.contains("ui-blocker")?i(e):this.select(".ui-blocker",$(e)).each((e,t)=>{i(t)});var t=[...this.domElementQueue];this.domElementQueue.length=0,this.domElementQueued=!1,await this.triggerEventAsync("domUpdated",t)}getInputValue(e,t=!1){e=this.select("."+e);if(0!=e.length&&(t||!e.prop("disabled")))return 1<e.length&&"radio"==e[0].getAttribute("type")?null!=(t=e.filter((e,t)=>t.checked).val())?t+"":void 0:e.hasClass("checkbox-list")?""!=((t=Array.from(e.find("input:checked")).map(e=>e.value).join(","))??"")?t:void 0:"checkbox"==e[0].getAttribute("type")?e[0].checked?"1":"0":"file"==e[0].getAttribute("type")?1<(t=e[0].files?.length??1)?t+" files selected":e.val().replace(/\\/g,"/").replace(/.*\//,""):e.val()}setInputValue(e,a,t=!1){null==a?delete this.state.inputs[e]:this.state.inputs[e]="boolean"==typeof a?a?"1":"0":a;e=this.select("."+e);if(0<e.length){var i=e.hasClass("checkbox-list");if(0<e.length&&"radio"==e[0].getAttribute("type"))e.prop("checked",!1),e.filter((e,t)=>t.value==a).prop("checked",!0);else if(i){if(e.find("input").prop("checked",!1),null!=a){let i=a?.split(",");e.find("input:checked").each((e,t)=>{i.indexOf(t.value)&&(t.checked=!0)})}}else"checkbox"==e[0].getAttribute("type")?e[0].checked="boolean"==typeof a?a:"1"==a:e.val(a??"");"range"==e[0].getAttribute("type")&&e[0].dispatchEvent(new Event("rangeset.ka")),t&&(i?e.find("input"):e)[0].dispatchEvent(new Event("change"))}return e}getInputs(e){e=KatApps.Utils.extend({},this.state.inputs,e);return delete e.getNumber,delete e.getOptionText,e}getKatAppId(e){if(e.hasAttribute("ka-id"))return e.getAttribute("ka-id")??void 0;let t=e;for(;(t=t.parentElement)&&t!==document;)if(t.hasAttribute("ka-id"))return t.getAttribute("ka-id")}on(e,t,i,a){e=this.select(e,a);return e.on(t,i),e}off(e,t,i){e=this.select(e,i);return e.off(t),e}inputSelectorRegex=/:input([\w\s.:#=\[\]'^$*|~]*)(?=(,|$))/g;replaceInputSelector(e){return e.replace(this.inputSelectorRegex,(e,t)=>["input","textarea","select","button"].map(e=>""+e+t).join(", "))}selectElement(e,t){var i=t??this.el[0],e=i.querySelector(this.replaceInputSelector(e))??void 0;return null==e||null!=t||(t=this.getKatAppId(i),this.getKatAppId(e)==t)?e:void 0}selectElements(e,t){var i,a=t??this.el[0],e=Array.from(a.querySelectorAll(this.replaceInputSelector(e)));return null!=t?e:(i=this.getKatAppId(a),e.filter(e=>this.getKatAppId(e)==i))}closestElement(e,t){e=e.closest(t)??void 0;return(null!=e?this.getKatAppId(e):void 0)==this.id?e:void 0}select(e,t){var i=t instanceof jQuery||null==t?t??$(this.el):$(t),a=null==t?this.id:i.attr("ka-id")||i.parents("[ka-id]").attr("ka-id");return $(e,i).filter(function(){return $(this).parents("[ka-id]").attr("ka-id")==a})}getResourceString(e){var t=this.options.currentUICulture??"en-us",i=this.options.resourceStrings?.["en-us"],a=this.options.resourceStrings?.en,s=this.options.resourceStrings?.[t],t=this.options.resourceStrings?.[t.split("-")[0]],s=s?.[e]??t?.[e],t=s??i?.[e]??a?.[e];return null==t?this.missingResources.push(e):null==s&&this.missingLanguageResources.push(e),"object"==typeof t?t.text:t}getLocalizedString(e,t,i){if(null==(e=e?.replaceAll("<<","{{").replaceAll(">>","}}")))return i;e.startsWith("{")&&e.endsWith("}")&&(e=(t=new Function(`{return (${e})}`)()).key);var a=null!=t&&Object.keys(t).some(e=>"key"!=e);let s=this.getResourceString(e);var n=3==arguments.length?i:e;if(null==s&&null==i&&-1<e.indexOf("^")){var r,i=e.split("^"),e=this.getResourceString(i[0])??i[0],l=i.slice(1),o=/(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})(?:T.*)?/,c=/^-?\d+(\.\d+)?$/;for(r of e.matchAll(/\{(\d+):([^{}]+)\}/g)){var p=+r[1],u=l[p],d=u.match(o);null!=d?l[p]=new Date(parseInt(d.groups.year),parseInt(d.groups.month)-1,parseInt(d.groups.day)):c.test(u)&&(d=parseFloat(u),isNaN(d)||(l[p]=d))}s=String.localeFormat(e,...l)}i=s??n;return null!=i?a?String.formatTokens(i,t?.keyValueObject??t):i:void 0}getTemplateContent(e){e=this.getTemplateId(e);return document.querySelector(e).content}getTemplateId(t){let i;for(let e=0;e<this.viewTemplates.length;e++){var a="#"+t+"_"+this.viewTemplates[e].replace(/\//g,"_");if(null!=document.querySelector(a)){i=a;break}}return null==(i=null==i&&null!=this.options.hostApplication?this.options.hostApplication.getTemplateId(t):i)&&KatApps.Utils.trace(this,"KatApp","getTemplateId",`Unable to find template: ${t}.`,TraceVerbosity.Normal),i}get nextCalculation(){let e=this;for(;null!=e.options.hostApplication;)e=e.options.hostApplication;var t=sessionStorage.getItem("katapp:debugNext:"+e.selector),i=JSON.parse(t??'{ "saveLocations": [], "expireCache": false, "trace": false }');return null==t&&(i.originalVerbosity=this.options.debug.traceVerbosity),i}set nextCalculation(e){let t=this;for(;null!=t.options.hostApplication;)t=t.options.hostApplication;var i="katapp:debugNext:"+t.selector;null==e?sessionStorage.removeItem(i):sessionStorage.setItem(i,JSON.stringify(e))}debugNext(e,i,t,a){var s=this.nextCalculation;if("boolean"==typeof e)e||(s.saveLocations=[]);else if(""!=(e??"")){let t=e.split(",").map(e=>e.trim());s.saveLocations=[...s.saveLocations.filter(e=>-1==t.indexOf(e.location)),...t.map(e=>({location:e,serverSideOnly:i??!1}))]}s.trace=t??!1,s.trace&&(this.options.debug.traceVerbosity=TraceVerbosity.Detailed),s.expireCache=a??!1,this.nextCalculation=s}blockUI(){this.uiBlockCount++,this.state.uiBlocked=!0}unblockUI(){this.uiBlockCount--,this.uiBlockCount<=0&&(this.uiBlockCount=0,this.state.uiBlocked=!1)}allowCalculation(t,e){var i=this.calcEngines.find(e=>e.key==t);null!=i&&(i.enabled=e)}cloneOptions(e){let i=["handlers","view","content","modalAppOptions","hostApplication"].concat(e?[]:["manualResults","manualResultsEndpoint"]);return KatApps.Utils.clone(this.options,(e,t)=>-1<i.indexOf(e)?void 0:t)}getCloneHostSetting(e){let t=e.hasAttribute("v-pre");return t=t&&""!=(e=e.getAttribute("v-pre")??"")?e:t}async showModalAsync(e,a){let s=!1;if(null!=e.contentSelector){await PetiteVue.nextTick();var t=this.select(e.contentSelector).first();if(0==t.length)throw new Error(`The content selector (${e.contentSelector}) did not return any content.`);s=this.getCloneHostSetting(t[0]);var i=$("<div/>");i.append(t.contents().clone(!0)),e.content=i}if(null==e.content&&null==e.view)throw new Error("You must provide content or viewId when using showModal.");if(0<$(".kaModal").length)throw new Error("You can not use the showModalAsync method if you have markup on the page already containing the class kaModal.");this.blockUI(),null!=a&&(a.setAttribute("disabled","true"),a.classList.add("disabled","kaModalInit"),$("body").addClass("kaModalInit"));try{var n=KatApp.get(".kaModal"),r=(null!=n&&KatApp.remove(n),$.Deferred());let i=["content","view"];var l={view:e.view,content:e.content,currentPage:e.view??this.options.currentPage,hostApplication:this.selector.startsWith("#popover")?this.options.hostApplication:this,cloneHost:s,modalAppOptions:KatApps.Utils.extend({promise:r,triggerLink:a},KatApps.Utils.clone(e,(e,t)=>-1<i.indexOf(e)?void 0:t)),inputs:{iModalApplication:"1"}},o=l.hostApplication.cloneOptions(null==e.content||!1!==s);let t=KatApps.Utils.extend(o,l,null!=e.inputs?{inputs:e.inputs}:void 0);return null!=t.anchoredQueryStrings&&null!=t.inputs&&(t.anchoredQueryStrings=KatApps.Utils.generateQueryString(KatApps.Utils.parseQueryString(t.anchoredQueryStrings),e=>!e.startsWith("ki-")||null==t.inputs["i"+e.split("-").slice(1).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join("")])),delete t.inputs.iNestedApplication,await KatApp.createAppAsync(".kaModal",t),r}catch(e){throw this.unblockUI(),null!=a&&(a.removeAttribute("disabled"),a.classList.remove("disabled","kaModalInit"),$("body").removeClass("kaModalInit")),e}}async cacheInputsAsync(e){var t;this.options.inputCaching&&(t="katapp:cachedInputs:"+this.options.currentPage+":"+(this.options.userIdHash??"EveryOne"),e=KatApps.Utils.clone(e),await this.triggerEventAsync("inputsCached",e),sessionStorage.setItem(t,JSON.stringify(e)))}async getSubmitApiConfigurationAsync(e,t,i=!1){t=this.getInputs(t),null==t.tables&&(t.tables=[]),t={inputs:t,configuration:{},isCalculation:i},await e(t),e=this.options,e={token:void 0,nextCalculation:this.nextCalculation,authID:"NODATA",adminAuthID:void 0,client:e.dataGroup??"KatApp",testCE:e.debug?.useTestCalcEngine??!1,currentPage:e.currentPage??"KatApp:"+(e.view??"UnknownView"),requestIP:e.requestIP??"1.1.1.1",currentCulture:e.currentCulture??"en-US",currentUICulture:e.currentUICulture??"en-US",environment:e.environment??"EW.PROD",allowLogging:!0};return{inputs:t.inputs,configuration:KatApps.Utils.extend(e,t.configuration),isCalculation:i}}getCeName(e){return e?.split(".")[0].replace("_Test","")??""}toCalcEngines(e){if(null==e)return[];{let s={};e.forEach(e=>{var t=e["@calcEngineKey"];if(null==t)throw new Error("manualResults requires a @calcEngineKey attribute specified.");let i=this.getCeName(e["@calcEngine"]??e["@calcEngineKey"]),a=(null!=this.calcEngines.find(e=>!e.manualResult&&e.name.toLowerCase()==i.toLowerCase())&&(i="Manual."+i),null==s[i]&&(s[i]={ceKey:t,tabs:[]}),e["@name"]);null==a&&(a=e["@name"]="RBLResult"+(s[i].tabs.length+1)),s[i].tabs.push(a)});var t,i=[];for(t in s){var a=s[t],a={key:a.ceKey,name:t,inputTab:"RBLInput",resultTabs:a.tabs,manualResult:!0,allowConfigureUi:!0,enabled:!0};i.push(a)}return i}}toTabDefs(e){let s=this.calcEngines,n=s[0].key;return e.map(e=>{let t=e.TabDef,i=this.getCeName(e.CalcEngine);e=s.find(e=>e.name.toLowerCase()==i.toLowerCase()),null==e&&KatApps.Utils.trace(this,"KatApp","toTabDefs",`Unable to find calcEngine: ${i}.  Determine if this should be supported.`,TraceVerbosity.None),e=e?.key??n;let a={_ka:{calcEngineKey:e,name:t["@name"]}};return Object.keys(t).forEach(e=>{e.startsWith("@")?a[e]=t[e]:a[e]=t[e]instanceof Array?t[e]:[t[e]]}),a})}copyTabDefToRblState(e,t,i,a){KatApps.Utils.trace(this,"KatApp","copyTabDefToRblState",`Copy ${i.length} rows from ${e}.${t}.`+a,TraceVerbosity.Diagnostic);e=e+"."+t;null==this.state.rbl.results[e]&&(this.state.rbl.results=Object.assign({},this.state.rbl.results,{[e]:{}})),this.state.rbl.results[e]=Object.assign({},this.state.rbl.results[e],{[a]:i})}mergeTableToRblState(e,t,i,a){KatApps.Utils.trace(this,"KatApp","mergeTableToRblState",`Merge ${i.length} rows from ${e}.${t}.`+a,TraceVerbosity.Diagnostic),"_ResultProcessing"==e&&0<this.calcEngines.length&&(e=this.calcEngines[0].key,t=this.calcEngines[0].resultTabs[0]);let s=e+"."+t;null==this.state.rbl.results[s]&&(this.state.rbl.results=Object.assign({},this.state.rbl.results,{[s]:{}})),null==this.state.rbl.results[s][a]&&(this.state.rbl.results[s]=Object.assign({},this.state.rbl.results[s],{[a]:[]})),i.forEach(t=>{"rbl-skip"==a&&(t.id=t.key,null==t.value)&&(t.value="1");var e=this.state.rbl.results[s][a].findIndex(e=>e.id==t.id);-1<e?this.state.rbl.results[s][a].splice(e,1,Object.assign({},this.state.rbl.results[s][a][e],t)):this.state.rbl.results[s][a].splice(this.state.rbl.results[s][a].length,0,t)})}async processResultsAsync(e,t){KatApps.Utils.trace(this,"KatApp","processResultsAsync","Start: "+e.map(e=>e._ka.calcEngineKey+"."+e._ka.name).join(", "),TraceVerbosity.Detailed);let r=(e,a,t)=>{if("object"==typeof e[a]){KatApps.Utils.trace(this,"KatApp","processResultColumn",`Convert ${a} from object to string.`,TraceVerbosity.Diagnostic);var s=e;let t=s[a],i=s["@"+a]={};Object.keys(t).filter(e=>"#text"!=e).forEach(e=>{i[e.substring(1)]=t[e]}),e[a]=t["#text"]??""}s=e[a];t&&""==s&&"true"!=e["@"+a]?.["@text-forced"]&&(e[a]=void 0),null!=s||t||(e[a]="")},a=["rbl-disabled","rbl-display","rbl-skip","rbl-value","rbl-listcontrol","rbl-input"],i=(e.forEach(n=>{Object.keys(n).filter(e=>!e.startsWith("@")&&"_ka"!=e&&"ItemDefs"!=e).forEach(s=>{var e=n[s]??[];if(0<e.length){let i="rbl-input"==s,a=Object.keys(e[0]);e.forEach(t=>{switch(a.forEach(e=>r(t,e,i)),s){case"rbl-defaults":this.setInputValue(t.id,t.value);break;case"rbl-input":var e;null!=t.value&&this.setInputValue(t.id,t.value),""!=(t.error??"")&&(e={id:t.id,text:this.getLocalizedString(t.error),dependsOn:t.dependsOn},this.state.errors.push(e)),""!=(t.warning??"")&&(e={id:t.id,text:this.getLocalizedString(t.warning),dependsOn:t.dependsOn},this.state.warnings.push(e));break;case"errors":t.text=this.getLocalizedString(t.text),this.state.errors.push(t);break;case"warnings":t.text=this.getLocalizedString(t.text),this.state.warnings.push(t);break;case"table-output-control":"-1"!=t.export&&"1"!=t.export||null!=n[t.id]||this.copyTabDefToRblState(n._ka.calcEngineKey,n._ka.name,[],t.id)}})}}),(n["rbl-input"]??[]).filter(e=>""!=(e.list??"")).map(e=>({input:e.id,list:e.list})).concat((n["rbl-listcontrol"]??[]).map(e=>({input:e.id,list:e.table}))).forEach(e=>{var t,i;null!=n[e.list]&&(t=n[e.list].map(e=>e.key),i=this.state.inputs[e.input],-1==t.indexOf(i??""))&&delete this.state.inputs[e.input]})}),t=>{e.forEach(i=>{Object.keys(i).filter(e=>!(e.startsWith("@")||"_ka"==e||"ItemDefs"==e||(e=`${i._ka.calcEngineKey}.${i._ka.name}.`+e,e=this.pushToTables.indexOf(e),!t&&-1<e)||t&&-1==e)).forEach(e=>{var t=i[e]??[];-1==a.indexOf(e)?this.copyTabDefToRblState(i._ka.calcEngineKey,i._ka.name,t,e):this.mergeTableToRblState(i._ka.calcEngineKey,i._ka.name,t,e)})})});i(!1),await PetiteVue.nextTick(()=>{i(!0)}),this.pushToTables=[],await this.processDataUpdateResultsAsync(e,t),this.processDocGenResults(e),KatApps.Utils.trace(this,"KatApp","processResultsAsync","Complete: "+e.map(e=>e._ka.calcEngineKey+"."+e._ka.name).join(", "),TraceVerbosity.Detailed)}async processDataUpdateResultsAsync(e,t){let i={DataTokens:[]};e.forEach(e=>{(e["jwt-data"]??[]).filter(e=>"data-updates"==e.id).forEach(e=>{i.DataTokens.push({Name:e.id,Token:e.value})})}),0<i.DataTokens.length&&(KatApps.Utils.trace(this,"KatApp","processDataUpdateResultsAsync",`Start (${i.DataTokens.length} jwt-data items)`,TraceVerbosity.Detailed),await this.apiAsync("rble/jwtupdate",{apiParameters:i},void 0,t),KatApps.Utils.trace(this,"KatApp","processDataUpdateResultsAsync","Complete",TraceVerbosity.Detailed))}processDocGenResults(e){e=e.flatMap(e=>(e["api-actions"]??[]).filter(e=>"DocGen"==e.action));0<e.length&&(KatApps.Utils.trace(this,"KatApp","processDocGenResults",`Start (${e.length} DocGen items)`,TraceVerbosity.Detailed),e.forEach(e=>{var t=e["file-name"];null!=e.exception?KatApps.Utils.trace(this,"KatApp","processDocGenResults",`DocGen Instruction Exception: ${t??"File Not Availble"}, ${e.exception})`,TraceVerbosity.None):(t=((e,t="application/octet-stream",i=1024)=>{var a=atob(e),s=a.length,n=Math.ceil(s/i),r=new Array(n);for(let e=0;e<n;++e){var l=e*i,o=Math.min(l+i,s),c=new Array(o-l);for(let e=l,t=0;e<o;++t,++e)c[t]=a[e].charCodeAt(0);r[e]=new Uint8Array(c)}return new Blob(r,{type:t})})(e.content,e["content-type"]),this.downloadBlob(t))}),KatApps.Utils.trace(this,"KatApp","processDocGenResults","Complete",TraceVerbosity.Detailed))}async getViewElementAsync(){var e=document.createElement("div");if((null!=this.options.modalAppOptions||"1"==this.options.inputs?.iNestedApplication)&&null!=this.options.view){var t=this.options.view,i=this.getApiUrl(this.options.kamlVerifyUrl+`?applicationId=${t}&currentId=`+this.options.hostApplication.options.currentPage);try{var a=await fetch(i.url,{method:"GET"});if(!a.ok)throw await a.json();var s=await a.json();KatApps.Utils.extend(this.options,{view:s.path,currentPath:t}),KatApps.Utils.extend(this.state.inputs,s.manualInputs)}catch(e){throw KatApps.Utils.trace(this,"KatApp","getViewElementAsync","Error verifying KatApp "+t,TraceVerbosity.None,e),new KatApps.KamlResourceDownloadError("View verification request failed.",t)}}if(null!=this.options.view){i=await KatApps.KamlRepository.getViewResourceAsync(this.options,this.options.view),a=(KatApps.Utils.trace(this,"KatApp","getViewElementAsync","Resource Returned",TraceVerbosity.Detailed),i[this.options.view].replace(/{id}/g,this.id).replace(/thisApplication/g,this.applicationCss));if(e.innerHTML=a,1!==e.querySelectorAll("rbl-config").length)throw new Error("View "+this.options.view+" is missing rbl-config element");new KatApps.KamlCompiler(this).compileMarkup(e,this.id),KatApps.Utils.trace(this,"KatApp","getViewElementAsync","Markup Processed",TraceVerbosity.Detailed)}else if(null==this.options.content)return;return e}async getViewTemplatesAsync(e){let t=(e.querySelector("rbl-config")?.getAttribute("templates")?.split(",")??[]).map(e=>{let t=(1<e.split(":").length?e:"Global:"+e).split("?")[0];return t.endsWith(".kaml")||(t+=".kaml"),t}),i=await KatApps.KamlRepository.getTemplateResourcesAsync(this.options,t),a=new KatApps.KamlCompiler(this);return Object.keys(i).forEach(e=>{var t=document.createElement("kaml-template");t.innerHTML=i[e],a.compileMarkup(t,e.replace(/\./g,"_")),KatApps.KamlRepository.resolveTemplate(e)}),t.map(e=>{e=e.split(":");return e[e.length-1].split("?")[0].replace(/\./g,"_")})}getSessionStorageInputs(){var e="katapp:cachedInputs:"+this.options.currentPage+":"+(this.options.userIdHash??"EveryOne"),e=this.options.inputCaching?sessionStorage.getItem(e):void 0,e=null!=e?JSON.parse(e):void 0,t="katapp:navigationInputs:"+this.options.currentPage,i=sessionStorage.getItem(t),i=null!=i?JSON.parse(i):void 0,t=(sessionStorage.removeItem(t),"katapp:navigationInputs:"+this.options.currentPage+":"+(this.options.userIdHash??"Everyone")),t=sessionStorage.getItem(t),t=null!=t?JSON.parse(t):void 0;return KatApps.Utils.extend({},e,t,i)}}class ApiError extends Error{innerException;apiResponse;constructor(e,t,i){super(e),this.innerException=t,this.apiResponse=i}}class ValidityError extends Error{constructor(){super("checkValidity failed on one or more inputs")}}class CalculationError extends Error{failures;constructor(e,t){super(e),this.failures=t}}var KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,KatApps,TraceVerbosity,KatApps,KatApps,KatApps;(y=>{y.Calculation=class{static async calculateAsync(i,a,t,s,e){y.Utils.trace(i,"Calculation","calculateAsync","Start",TraceVerbosity.Detailed);let n=y.Utils.extend({},e,{calcEngines:t.filter(e=>!e.manualResult&&e.enabled).map(e=>({name:e.name,inputTab:e.inputTab,resultTabs:e.resultTabs,pipeline:e.pipeline?.map(e=>({name:e.name,inputTab:e.inputTab,resultTab:e.resultTab}))}))}),r=["tables","getNumber","getOptionText"];e={inputs:y.Utils.clone(s,(e,t)=>-1<r.indexOf(e)?void 0:t?.toString()),inputTables:s.tables?.map(e=>({name:e.name,rows:e.rows})),configuration:n};let l=[],o=[];try{y.Utils.trace(i,"Calculation","calculateAsync","Posting Data",TraceVerbosity.Detailed);for(var c=await this.submitCalculationAsync(i,a,s,e),p=c.Results.filter(e=>null!=e.CacheKey&&null==e.Result),u=0;u<p.length;u++){let e=c.Results[u];var d=await this.getCacheAsync("RBLCache:"+e.CacheKey,i.options.decryptCache);null==d?y.Utils.trace(i,"Calculation","calculateAsync",`Cache miss for ${e.CalcEngine} with key `+e.CacheKey,TraceVerbosity.Detailed):(y.Utils.trace(i,"Calculation","calculateAsync","Use cache for "+e.CalcEngine,TraceVerbosity.Detailed),e.CacheKey=void 0,e.Result=d)}var h=c.Results.filter(e=>null!=e.CacheKey&&null==e.Result);if(0<h.length){let t=h.map(e=>e.CalcEngine);e.configuration.calcEngines=e.configuration.calcEngines.filter(e=>-1<t.indexOf(e.name)),e.configuration.invalidCacheKeys=h.map(e=>e.CacheKey);for(var g=await this.submitCalculationAsync(i,a,s,e),u=0;u<g.Results.length;u++){let t=g.Results[u];var m=c.Results.findIndex(e=>e.CalcEngine==t.CalcEngine);c.Results[m]=t}}0<c.Results.filter(e=>null!=e.CacheKey&&null==e.Result).length&&y.Utils.trace(i,"Calculation","calculateAsync","Client side cache is invalid.",TraceVerbosity.Detailed);for(u=0;u<c.Results.length;u++){var v=c.Results[u],b=v.CacheKey;null!=b&&(null!=v.Result.Exception?(y.Utils.trace(i,"Calculation","calculateAsync","(RBL exception) Remove cache for "+v.CalcEngine,TraceVerbosity.Detailed),sessionStorage.removeItem("RBLCache:"+b)):(y.Utils.trace(i,"Calculation","calculateAsync","Set cache for "+v.CalcEngine,TraceVerbosity.Detailed),await this.setCacheAsync("RBLCache:"+b,v.Result,i.options.encryptCache)))}var f=c;if(f.Results.filter(e=>null!=e.Result.Exception).forEach(e=>{e={calcEngine:e.CalcEngine,diagnostics:e.Result.Diagnostics,configuration:n,inputs:s,exceptions:[{message:e.Result.Exception.Message,type:e.Result.Exception.Type,traceId:e.Result.Exception.TraceId,requestId:e.Result.Exception.RequestId,stackTrace:e.Result.Exception.StackTrace}]};l.push(e)}),f.Results.filter(e=>null==e.Result.Exception).forEach(e=>{var t=e.Result.RBL.Profile.Data.TabDef;o.push({CalcEngine:e.CalcEngine,Diagnostics:e.Result.Diagnostics,TabDefs:t instanceof Array?t:[t]})}),0<l.length)throw new CalculationError("Unable to complete calculation(s)",l);return o}catch(e){if(e instanceof CalculationError)throw e;t={message:e instanceof Error?e.message:e+"Unable to submit Calculation to "+a,type:e instanceof Error?e.name:"Error",stackTrace:e instanceof Error?e.stack?.split("\n")??["No stack available"]:["Calculation.calculateAsync (rest is missing)"]};throw e instanceof Error||(console.log("Original calculation exception (should have been instanceof Error):"),console.log({e:e})),new CalculationError("Unable to complete calculation(s)",[{calcEngine:n.calcEngines.map(e=>e.name).join(", "),inputs:s,configuration:n,exceptions:[t]}])}}static async submitCalculationAsync(i,a,s,n){try{var e=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(async e=>{var t=await e.text(),t=""==t?void 0:JSON.parse(t);if(e.ok)return t;throw t??{exceptions:[{message:"No additional details available."}]}});return y.Utils.trace(i,"Calculation","calculateAsync","Received Success Response",TraceVerbosity.Detailed),e}catch(e){let t=e;a=t.exceptions??[],i={calcEngine:n.configuration.calcEngines.map(e=>e.name).join(", "),configuration:n.configuration,inputs:s,exceptions:a.map(e=>({message:e.message,type:e.type??"Unknown type",traceId:e.traceId,requestId:e.requestId,stackTrace:e.stackTrace,apiResult:t.apiResult,apiPayload:t.apiPayload}))};throw new CalculationError("Unable to complete calculation(s)",[i])}}static async setCacheAsync(e,t,i){i=i(t);i instanceof Promise&&(i=await i),sessionStorage.setItem(e,i)}static async getCacheAsync(t,i){t=sessionStorage.getItem(t);if(null!=t){let e=i(t);return e=e instanceof Promise?await e:e}}}})(KatApps=KatApps||{}),(()=>{class t{static templateRenderedCount={};getRenderedId(e){if(null!=e)return t.templateRenderedCount[e]=null==t.templateRenderedCount[e]?1:t.templateRenderedCount[e]+1,e.substring(1)+"_"+t.templateRenderedCount[e]}}(KatApps||(KatApps={})).TemplateBase=t})(),!function(E){class p extends E.TemplateBase{static stringCache=Object.create(null);static cacheStringFunction=t=>e=>this.stringCache[e]??(this.stringCache[e]=t(e));addValidityValidation(e,t,i,a){null!=a.validationMessage&&""!=a.validationMessage&&null==e.state.errors.find(e=>-1!=e.id.replace(/ /g,"").split(",").indexOf(t))&&e.state.errors.push({id:t,text:i(t)+": "+a.validationMessage})}removeValidations(e,t){e.state.errors=e.state.errors.filter(e=>("input"==e.event||-1==e.id.replace(/ /g,"").split(",").indexOf(t))&&-1==(e.dependsOn??"").replace(/ /g,"").split(",").indexOf(t)),e.state.warnings=e.state.warnings.filter(e=>("input"==e.event||-1==e.id.replace(/ /g,"").split(",").indexOf(t))&&-1==(e.dependsOn??"").replace(/ /g,"").split(",").indexOf(t))}validationText(e,t,i){t=t.find(e=>-1<e.id.replace(/ /g,"").split(",").indexOf(i));return null!=t?e.getLocalizedString(t.text):void 0}errorText(e,t){return this.validationText(e,e.state.errors,t)}warningText(e,t){return this.validationText(e,e.state.warnings,t)}unmounted(e,t,i){(i||t.hasAttribute("ka-unmount-clears-inputs")||null!=t.closest("[ka-unmount-clears-inputs]"))&&null!=(i=t.getAttribute("name"))&&delete e.state.inputs[i]}mounted(r,l,o,e,c,t,p,u,d,h,g,m,v,b,f){if(c.setAttribute("name",o),c.classList.add(o),c.isConnected){var y=c.getAttribute("type"),A="radio"==y&&c.hasAttribute("checked")?c.getAttribute("value"):void 0,k="checkbox"==y?c.hasAttribute("checked")?"1":"0":void 0,w="text"==y?c.getAttribute("value"):void 0;let i=p||c.hasAttribute("ka-rbl-exclude")||null!=r.closestElement(c,"[ka-rbl-exclude]"),a=c.hasAttribute("ka-rbl-no-calc")||null!=r.closestElement(c,"[ka-rbl-no-calc]"),s=(i||(p=t(o)??k??A??w,null==r.state.inputs[o]&&null!=p&&(r.state.inputs[o]=p),null!=(p=r.state.inputs[o])&&r.setInputValue(o,p)),()=>this.removeValidations(r,o)),n;t=async(e,t=!1)=>{s(),i||(r.state.lastInputChange=Date.now(),r.state.inputsChanged=!0,r.state.inputs[o]=r.getInputValue(o),a)||u(o)||(e?(r.state.inputs.iInputTrigger=o,n&&clearTimeout(n),n=setTimeout(async()=>{await r.calculateAsync(void 0,!0,void 0,!1)},t?750:0)):r.state.needsCalculation=!0),await r.triggerEventAsync("input",o,e,c,l)};"date"==y?this.bindDateEvents(r,o,e,c,s,t):"range"==y?this.bindRangeEvents(o,c,f,d,t):this.bindInputEvents(r,o,e,c,y,h,g,m,v,t),this.bindCustomEvents(r,c,b,l)}else E.Utils.trace(r,"InputComponent","mounted",`Skipping input mount on ${o} because the input is not connected, consider the order of model properties being set.`,TraceVerbosity.Diagnostic)}bindInputEvents(p,u,t,l,e,i,d,h,a,s){if(l.addEventListener("change",async()=>s(!0)),"file"!=e&&"checkbox"!=e&&"SELECT"!=l.tagName&&(l.addEventListener("input",async()=>s(!1)),l.addEventListener("blur",()=>{p.isCalculating||(p.state.needsCalculation=!1)}),"radio"!=e)&&"INPUT"==l.tagName){l.addEventListener("invalid",e=>this.addValidityValidation(p,u,t,e.target));e=a(u);if(null!=e){let t=new RegExp(`[${e}]`),i=(l.addEventListener("beforeinput",e=>{"insertText"!=e.inputType||null==e.data||t.test(e.data)||e.preventDefault()}),new RegExp(`[^${e}]`,"g"));l.addEventListener("input",e=>{e=e.target;p.setInputValue(u,e.value=e.value.replace(i,""),!1)})}if(i){let o=function(e){var t=e.startsWith("-"),e=e.substring(t?7:6),e=""!=e?+e:2,i=Sys.CultureInfo.CurrentCulture.numberFormat.CurrencyDecimalSeparator,a=0<e?"\\"+i:"";return{allowNegative:t,decimalPlaces:e,currencySeparator:i,keypressRegEx:new RegExp(`[0-9${t?"\\-":""}${a}]`,"g"),inputRegEx:new RegExp(`[^0-9${a}]+`,"g")}},c=(l.addEventListener("keypress",e=>{var t=e.target,i=d(u);switch(null!=i&&-1<i.indexOf("number")?"number":i){case"email":(null===e.key.match(/[A-Za-z0-9.@_-]/)||"@"==e.key&&-1<t.value.indexOf("@"))&&e.preventDefault();break;case"zip+4":case"#####-####":l.setAttribute("maxlength","10"),(null===e.key.match(/[0-9\-]/)||"-"==e.key&&5!=l.value.length)&&e.preventDefault();break;case"number":var a=o(i),s=t.selectionStart,n=t.selectionEnd,r=null!=s&&null!=n&&s!=n?l.value.substring(0,s)+l.value.substring(n):l.value;(null===e.key.match(a.keypressRegEx)||e.key==a.currencySeparator&&(-1<r.indexOf(a.currencySeparator)||""==l.value)||"-"==e.key&&(0!=s||-1<r.indexOf("-"))||0<a.decimalPlaces&&e.key!=a.currencySeparator&&"-"!=e.key&&2==(n=(s!=n?r:l.value.substring(0,s)+e.key+l.value.substring(s)).split(a.currencySeparator)).length&&n[1].length>a.decimalPlaces)&&e.preventDefault();break;case"cc-expire":case"MM/YY":l.setAttribute("maxlength","5"),(null===e.key.match(/[0-9\/]/)||"/"==e.key&&2!=l.value.length)&&e.preventDefault();break;case"phone":case"(###) ###-####":l.setAttribute("maxlength","14"),(null===e.key.match(/[0-9\(\)\-\s]/)||"("==e.key&&""!=l.value||")"==e.key&&4!=l.value.length||"-"==e.key&&9!=l.value.length||" "==e.key&&5!=l.value.length)&&e.preventDefault();break;default:l.setAttribute("maxlength",h(u).toString())}}),new RegExp("[^A-Za-z0-9.@_-]","g"));l.addEventListener("input",e=>{var i=e.target,a=d(u)??"",t=i.selectionStart,s="deleteContentBackward"==e.inputType,e="deleteContentForward"==e.inputType;if(!s||t!=i.value.length){switch(null!=a&&-1<a.indexOf("number")?"number":a){case"email":p.setInputValue(u,i.value=i.value.replace(c,""));break;case"zip+4":case"#####-####":{i.setAttribute("maxlength","10");let e=i.value;var n=5==e.indexOf("-"),r=(e=e.replace(/\D/g,"").substring(0,9)).substring(0,5),l=e.substring(5,9);p.setInputValue(u,i.value=5<e.length?r+"-"+l:r+(n?"-":""));break}case"number":{l=o(a);let e=i.value;r=l.allowNegative&&0==e.indexOf("-"),n=(e=e.replace(l.inputRegEx,"")).split(l.currencySeparator);let t=r?"-":"";2<n.length?t+=n.slice(0,2).join(l.currencySeparator):(t+=n[0],1<n.length&&(t+=l.currencySeparator+n[1].substring(0,l.decimalPlaces))),p.setInputValue(u,i.value=t);break}case"cc-expire":case"MM/YY":{i.setAttribute("maxlength","5");let e=i.value;r=3==e.indexOf("/"),n=(e=e.replace(/\D/g,"").substring(0,4)).substring(0,2),l=e.substring(2);p.setInputValue(u,i.value=2<e.length?n+"/"+l:n+(r?"/":""));break}case"phone":case"(###) ###-####":{i.setAttribute("maxlength","14");let e=i.value;l=(e=e.replace(/\D/g,"").substring(0,10)).substring(0,3),n=e.substring(3,6),r=e.substring(6,10);6<=e.length?i.value="("+l+") "+n+"-"+r:3<=e.length?i.value="("+l+") "+n:0<e.length&&(i.value="("+l),p.setInputValue(u,i.value);break}default:i.setAttribute("maxlength",h(u).toString())}(s||e)&&(i.selectionStart=i.selectionEnd=t);s=+i.getAttribute("maxlength"),e=i.value;e.length>s&&p.setInputValue(u,i.value=e.slice(0,s))}})}}}static percentFormat=/([/s/S]*?){0:p\d*}/;bindRangeEvents(c,p,e,u,t){let d,h=null!=e.bubble?$(e.bubble):void 0,g=null!=e.bubbleValue?$(e.bubbleValue):h,m=null!=e.display?$(e.display):void 0,i=t=>{d&&clearTimeout(d);var i,e=$(p),a=e.val(),s=u(c),s=null!=s?String.localeFormat(s,s.match(E.InputComponent.percentFormat)?+a/100:+a):a.toString(),n=+e.attr("max"),r=+e.attr("min"),l=Number(100*(+a-r)/(n-r)),o=10-.2*l;if(null!=m&&m.html(s),null!=h&&(g.html(s),t)){let e=30;null!=m&&(s=m[0],t=getComputedStyle(s),i=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),t=parseFloat(t.borderLeftWidth)+parseFloat(t.borderRightWidth),e=15+s.offsetWidth-i-t),g.css("width",e+"px"),h.css("left",`calc(${l}% + (${o}px))`).addClass("active")}e.css("backgroundSize",100*(+a-r)/(n-r)+"% 100%")};i(!1),p.addEventListener("input",async()=>{await t(!1),i(!0)}),p.addEventListener("rangeset.ka",()=>i(!1)),p.addEventListener("change",async()=>t(!0,!0)),null!=h&&(p.addEventListener("mouseenter",()=>{d=setTimeout(()=>{i(!0)},750)}),p.addEventListener("mouseleave",()=>{d&&clearTimeout(d),h.removeClass("active")}))}bindDateEvents(i,a,t,e,s,n){let r=async e=>{var t=i.getInputValue(a);i.state.inputs[a]!=t&&(e.currentTarget.dispatchEvent(new Event("value-ka")),await n(!0))};e.addEventListener("invalid",e=>this.addValidityValidation(i,a,t,e.target)),e.addEventListener("change",r),e.addEventListener("keypress",async e=>{s(),"Enter"==e.code&&await r(e)}),e.addEventListener("keydown",()=>{e.removeEventListener("change",r),e.addEventListener("blur",r)}),e.addEventListener("click",()=>{e.removeEventListener("blur",r),e.removeEventListener("change",r),e.addEventListener("change",r)}),e.addEventListener("blur",()=>{i.isCalculating||(i.state.needsCalculation=!1)})}bindCustomEvents(r,l,o,c){if(null!=o)for(let n in o){let t=n.split(".")[0],s=this.getModifiers(n);if(s){let e=["ctrl","shift","alt","meta"],i={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&0!==e.button,middle:e=>"button"in e&&1!==e.button,right:e=>"button"in e&&2!==e.button,exact:(t,i)=>e.some(e=>t[e+"Key"]&&!i[e])},a=("click"===t&&(s.right&&(t="contextmenu"),s.middle)&&(t="mouseup"),p.cacheStringFunction(e=>e.replace(/\B([A-Z])/g,"-$1").toLowerCase()));l.addEventListener(t,e=>{if(!("key"in e)||a(e.key)in s){for(var t in s){t=i[t];if(t&&t(e,s))return}return o[n](e,r,c)}},s)}else l.addEventListener(n,e=>o[n](e,r,c))}}getModifiers(e){if(-1!=e.indexOf(".")){var t,i={},a=e.split(".");for(t in a.shift(),a)i[a[t]]=!0;return i}}}E.InputComponentBase=p}(KatApps=KatApps||{}),(e=>{class t extends e.InputComponentBase{props;constructor(e){super(),this.props=e}getScope(a,e){let s=this.props,t=this,n=s.name,r=s.ce,l=s.tab,i=s.template;if(null!=i){e=e(i);if(null==e)return void console.log(`Unable to find template ${e}, `+JSON.stringify(s));i=e}let o=function(e,t,i){if(0!=a.calcEngines.length)return a.state.rbl.value("rbl-input",n,e,void 0,r,l)??(null!=t&&null!=i?a.state.rbl.value(t,i,void 0,void 0,r,l):void 0)};e=o("type")??s.type??"text";let c={get display(){return"0"!=o("display","rbl-display","v"+n)},get noCalc(){return"1"==o("skip-calc","rbl-skip",n)},get disabled(){return"1"==o("disabled","rbl-disabled",n)},get error(){return t.errorText(a,n)},get warning(){return t.warningText(a,n)}},p=e=>o("mask")??s.mask,u=null!=p(n)||"function"==typeof Object.getOwnPropertyDescriptor(s,"mask")?.get,d=e=>{var t=o("max-length");return(null!=t?+t:void 0)??s.maxLength??250},h=e=>o("keypress-regex")??s.keypressRegex,g=e=>a.state.inputs[e]??s.value,m=e=>a.getLocalizedString(o("label","rbl-value","l"+e)??s.label??""),v=e=>"boolean"==typeof s.isNoCalc?s.isNoCalc:s.isNoCalc?.(c)??c.noCalc,b=e=>{let t=o("display-format")??"";var i;return""!=(t=""==t&&0<a.calcEngines.length&&(i=a.state.rbl.value("rbl-sliders",e,"format",void 0,r,l),e=a.state.rbl.value("rbl-sliders",e,"decimals",void 0,r,l),null!=i)&&null!=e?`{0:${i}${e}}`:t)?t:s.displayFormat},f={$template:i,$renderId:this.getRenderedId(i),id:n+"_"+a.id,name:n,type:e,get value(){return a.state.inputs[n]??s.value??""},get disabled(){return"boolean"==typeof s.isDisabled?s.isDisabled:s.isDisabled?.(c)??c.disabled},get display(){return"boolean"==typeof s.isDisplay?s.isDisplay:s.isDisplay?.(c)??c.display},get noCalc(){return v(n)},get label(){return m(n)},get labelledBy(){return s.labelledBy},get hideLabel(){return"-1"==o("label")||(s.hideLabel??!1)},get placeHolder(){var e=o("placeholder")??s.placeHolder;return null!=e?a.getLocalizedString(e):void 0},get help(){return{get content(){var e=o("help","rbl-value","h"+n)??s.help?.content;return null!=e?a.getLocalizedString(e):void 0},title:a.getLocalizedString(o("help-title","rbl-value","h"+n+"Title")??s.help?.title??""),width:o("help-width")??s?.help?.width?.toString()??"350"}},get iconHtml(){return s.iconHtml??""},get css(){return{input:s?.css?.input??"",label:s?.css?.label??"",container:s?.css?.container}},get error(){return c.error},get warning(){return c.warning},get list(){var e=null==s.list&&0<a.calcEngines.length?o("list")??a.state.rbl.value("rbl-listcontrol",n,"table",void 0,r,l):void 0;return(null!=e?a.state.rbl.source(e,r,l):s.list??[]).map(e=>({key:e.key,text:a.getLocalizedString(e.text.toString())}))},get prefix(){return o("prefix")??s.prefix},get suffix(){return o("suffix")??s.suffix},get maxLength(){return d(n)},get min(){return(0==a.calcEngines.length?void 0:o("min")??a.state.rbl.value("rbl-sliders",n,"min",void 0,r,l))??s.min?.toString()},get max(){return(0==a.calcEngines.length?void 0:o("max")??a.state.rbl.value("rbl-sliders",n,"max",void 0,r,l))??s.max?.toString()},get step(){var e=0==a.calcEngines.length?void 0:o("step")??a.state.rbl.value("rbl-sliders",n,"step",void 0,r,l);return(null!=e?+e:void 0)??s.step??1},inputUnmounted:e=>this.unmounted(a,e,s.clearOnUnmount),inputMounted:(e,t)=>{},uploadAsync:async()=>{if(null==s.uploadEndpoint)throw new Error("Cannot use uploadAsync if uploadEndpoint is not set.");var e=a.select("."+n)[0].files;try{await a.apiAsync(s.uploadEndpoint,{files:e})}catch(e){}finally{a.setInputValue(n,void 0)}}};return f.inputMounted=(e,t)=>this.mounted(a,f,n,m,e,g,s.isExcluded??!1,v,b,u,p,d,h,s.events,t),f}}e.InputComponent=t})(KatApps=KatApps||{}),(e=>{class t extends e.TemplateBase{props;constructor(e){super(),this.props=e}getScope(t,i){if(null==this.props.name)throw new Error("You must provide {name:'templateName'} when using v-ka-template.");var e,i=i(this.props.name);if(null==i)return{};if(this.props.source instanceof Array){let e=this;return{$template:i,$renderId:e.getRenderedId(i),application:t,modalAppOptions:t.options.modalAppOptions,get rows(){return e.props.source}}}return(e=this.props.source??{}).$template=i,e.$renderId=this.getRenderedId(i),e.application=t,e.modalAppOptions=t.options.modalAppOptions,e}}e.TemplateComponent=t})(KatApps=KatApps||{}),(e=>{class t extends e.InputComponentBase{props;constructor(e){super(),this.props=e}getScope(L,e){e=e(this.props.template);if(null!=e){let t=this,a=this.props,s=a.names,i=U(a.values),n=U(a.labels),r=U(a.prefixes),l=U(a.suffixes),o=U(a.hideLabels),c=U(a.placeHolders,""),p=U(a.displayFormats),u=U(a.masks),d=U(a.keypressRegexs),h=U(a.helps),g=U(a.css),m=U(a.maxLengths),v=U(a.mins),b=U(a.maxes),f=U(a.steps),y=a.ce,A=a.tab,k=function(e,t,i,a){if(0!=L.calcEngines.length)return L.state.rbl.value("rbl-input",s[e],t,void 0,y,A)??(null!=i&&null!=a?L.state.rbl.value(i,a,void 0,void 0,y,A):void 0)},w={name:e=>s[e],display:e=>"0"!=k(e,"display","rbl-display","v"+s[e]),noCalc:e=>"1"==k(e,"skip-calc","rbl-skip",s[e]),disabled:e=>"1"==k(e,"disabled","rbl-disabled",s[e]),error:e=>t.errorText(L,s[e]),warning:e=>t.errorText(L,s[e])},E=function(e){e=s.indexOf(e);return L.getLocalizedString(k(e,"label","rbl-value","l"+s[e])??n[e]??"")},x=function(e){e=s.indexOf(e);return"boolean"==typeof a.isNoCalc?a.isNoCalc:a.isNoCalc?.(e,w)??w.noCalc(e)},C=function(e){e=s.indexOf(e);return L.state.inputs[s[e]]??i[e]},T=function(e){e=s.indexOf(e);return k(e,"mask")??u[e]},S=s.some(e=>void 0!==T(e))||"function"==typeof Object.getOwnPropertyDescriptor(a,"masks")?.get,K=function(e){var e=s.indexOf(e),t=k(e,"max-length");return(null!=t?+t:void 0)??m[e]??250},I=function(e){e=s.indexOf(e);return k(e,"keypressRegex")??d[e]},O=function(e){var t,i=s.indexOf(e);let a=k(i,"display-format")??"";return""!=(a=""==a&&0<L.calcEngines.length&&(t=L.state.rbl.value("rbl-sliders",e,"format",void 0,y,A),e=L.state.rbl.value("rbl-sliders",e,"decimals",void 0,y,A),null!=t)&&null!=e?`{0:${t}${e}}`:a)?a:p[i]};var R=k(0,"type")??a.type??"text";let D={$template:e,$renderId:this.getRenderedId(e),id:e=>s[e]+"_"+L.id,name:e=>w.name(e),type:R,value:e=>C(s[e])??"",disabled:e=>"boolean"==typeof a.isDisabled?a.isDisabled:a.isDisabled?.(e,w)??w.disabled(e),display:e=>"boolean"==typeof a.isDisplay?a.isDisplay:a.isDisplay?.(e,w)??w.display(e),noCalc:e=>x(s[e]),label:e=>E(s[e]),placeHolder:e=>{e=k(e,"placeholder","rbl-value","ph"+s[e])??c[e];return null!=e?L.getLocalizedString(e):void 0},help:t=>({get content(){var e=k(t,"help","rbl-value","h"+s[t])??h[t]?.content;return null!=e?L.getLocalizedString(e):void 0},title:L.getLocalizedString(k(t,"help-title","rbl-value","h"+s[t]+"Title")??h[t]?.title??""),width:k(t,"help-width")??h[t]?.width?.toString()??"350"}),css:e=>({input:g[e]?.input??"",label:g[e]?.label??"",container:g[e]?.container}),error:e=>w.error(e),warning:e=>w.warning(e),list:function(e){e=0==L.calcEngines.length?void 0:k(e,"list")??L.state.rbl.value("rbl-listcontrol",s[e],"table",void 0,y,A);return(null!=e?L.state.rbl.source(e,y,A):[]).map(e=>({key:e.key,text:L.getLocalizedString(e.text.toString())}))},hideLabel:e=>"-1"==k(e,"label")||(o[e]??!1),maxLength:e=>K(s[e]),min:e=>(0==L.calcEngines.length?void 0:k(e,"min")??L.state.rbl.value("rbl-sliders",s[e],"min",void 0,y,A))??v[e],max:e=>(0==L.calcEngines.length?void 0:k(e,"max")??L.state.rbl.value("rbl-sliders",s[e],"max",void 0,y,A))??b[e],step:e=>{var t=0==L.calcEngines.length?void 0:k(e,"step")??L.state.rbl.value("rbl-sliders",s[e],"step",void 0,y,A);return(null!=t?+t:void 0)??f[e]},prefix:e=>k(e,"prefix")??r[e],suffix:e=>k(e,"suffix")??l[e],inputUnmounted:e=>this.unmounted(L,e,a.clearOnUnmount),inputMounted:(e,t)=>{}};return D.inputMounted=(e,t)=>{var i=e.getAttribute("name");if(null==i)throw new Error('You must assign a name attribute via :name="name(index)".');this.mounted(L,D,i,E,e,C,a.isExcluded??!1,x,O,S,T,K,I,a.events,t)},D;function U(e,t){let i=null!=e&&e instanceof Array?e[e.length-1]:e??t;return e instanceof Array?e.concat(s.slice(0,s.length-e.length).map(e=>i)):s.map(e=>i)}}}}e.TemplateMultipleInputComponent=t})(KatApps=KatApps||{}),(a=>{a.Components=class{static initializeCoreComponents(t,i){t.state.components.template=e=>new a.TemplateComponent(e).getScope(t,i),t.state.components.input=e=>new a.InputComponent(e).getScope(t,i),t.state.components.inputGroup=e=>new a.TemplateMultipleInputComponent(e).getScope(t,i)}}})(KatApps=KatApps||{}),(l=>{l.DirectiveKaApi=class{name="ka-api";getDefinition(r){return a=>{let s=a.exp.startsWith("{")?a.get():{endpoint:a.exp},n=s.endpoint;return"A"==a.el.tagName&&a.el.setAttribute("href","#"),$(a.el).on("click.ka-api",async function(e){if((e.preventDefault(),null!=s.confirm)&&!(await r.showModalAsync(s.confirm,e.currentTarget)).confirmed)return;try{let i=["confirm","endpoint","then","catch"];var t=await r.apiAsync(n,l.Utils.clone(s,(e,t)=>-1<i.indexOf(e)?void 0:t),a.el);null!=s.thenAsync&&await s.thenAsync(t,r)}catch(e){null!=s.catchAsync?await s.catchAsync(e,r):l.Utils.trace(r,"DirectiveKaApi","submitApi",`API Submit to ${n} failed.`,TraceVerbosity.None,e)}}),()=>{$(a.el).off("click.ka-api")}}}}})(KatApps=KatApps||{}),(o=>{o.DirectiveKaApp=class{name="ka-app";getDefinition(l){return e=>{let t=e.get();var i=t.view;let a=["handlers","view","modalAppOptions","hostApplication","currentPage"],s=o.Utils.extend(o.Utils.clone(l.options,(e,t)=>-1<a.indexOf(e)?void 0:t),{view:i,currentPage:i,hostApplication:l,inputs:o.Utils.extend({iNestedApplication:"1"},t.inputs)}),n=(delete s.inputs.iModalApplication,t.selector??".kaNested"+o.Utils.generateId());e.el.classList.add(n.substring(1));let r;return(async()=>{try{await PetiteVue.nextTick(),r=await KatApp.createAppAsync(n,s)}catch(e){o.Utils.trace(l,"DirectiveKaApp","getDefinition",`Nested App ${t.view} failed.`,TraceVerbosity.None,e)}})(),()=>{null!=r&&KatApp.remove(r)}}}}})(KatApps=KatApps||{}),(s=>{s.DirectiveKaAttributes=class{name="ka-attributes";getDefinition(e){return e=>{var t=e.get();if(null!=t&&""!=t){var i,a=s.Utils.getObjectFromAttributes(t);for(i in a)e.el.setAttribute(i,a[i])}}}}})(KatApps=KatApps||{}),!function(KatApps){class DirectiveKaHighchart{name="ka-highchart";cultureEnsured=!1;application;getDefinition(p){return o=>{var e=(this.application=p).closestElement(o.el,".tab-pane, [role='tabpanel']")?.getAttribute("aria-labelledby");null!=e&&p.select("#"+e).on("shown.bs.tab",()=>$(o.el).highcharts().reflow());let c;return o.effect(()=>{if("object"!=typeof Highcharts)KatApps.Utils.trace(p,"DirectiveKaHighchart","getDefinition","Highcharts javascript is not present.",TraceVerbosity.None,o.exp);else{let t=o.get();var a=p.state.rbl.source(`HighCharts-${t.data}-Data`,t.ce,t.tab);let e=p.state.rbl.source(`HighCharts-${t.options??t.data}-Options`,t.ce,t.tab),i=p.state.rbl.source("HighCharts-Overrides",t.ce,t.tab,e=>0==String.compare(e.id,t.data,!0));var s=a.filter(e=>!e.category.startsWith("config-")),a=a.filter(e=>e.category.startsWith("config-")),n=null!=(c=Highcharts.charts[o.el.getAttribute("data-highcharts-chart")??-1]);if(void 0!==c&&(c.destroy(),c=void 0),0<s.length){this.ensureCulture();var r=function(t){return i.find(e=>0===String.compare(e.key,t,!0))?.value??e.find(e=>0===String.compare(e.key,t,!0))?.value},l=r("config-style");if(void 0!==l){let e=o.el.getAttribute("style")??"";""===e||e.endsWith(";")||(e+=";"),o.el.setAttribute("style",e+l)}l=r("chart.type"),r=this.removeRBLEncoding(r("config-tooltipFormat")),l=this.getChartOptions(l,r,s,e,i,a);try{$(o.el).highcharts(l),c=Highcharts.charts[o.el.getAttribute("data-highcharts-chart")],n&&$(o.el).highcharts().reflow()}catch(e){KatApps.Utils.trace(p,"DirectiveKaHighchart","getDefinition","Error during highchart creation.",TraceVerbosity.None,o.exp,e)}}}}),()=>{void 0!==c&&c.destroy()}}}getChartOptions(e,t,i,a,s,n){let r={};a.concat(s).filter(e=>!e.key.startsWith("config-")).forEach(e=>{this.setApiOption(r,e.key,e.value)});a=i[0],s=Object.keys(a),a=s.filter(e=>e.startsWith("series")),e="pie"!==e&&"solidgauge"!==e&&"scatter3d"!==e;return r.series=this.buildSeries(s,a,n,i,e),e&&(r.xAxis=this.getXAxisOptions(r.xAxis,i)),r.tooltip=this.getTooltipOptions(t,a,n)??r.tooltip,r}getTooltipOptions(e,i,a){if(void 0!==e){let t=a.find(e=>"config-format"===e.category),n=i.filter(t=>0===a.filter(e=>"config-visible"===e.category&&"0"===e[t]).length).map(e=>t?.[e]??"c0");return{formatter:function(){let i="",a=0,s=Sys.CultureInfo.CurrentCulture.name.startsWith("fr")?"<br/>{{name}} : {{value}}":"<br/>{{name}}: {{value}}";return this.points.forEach((e,t)=>{0<e.y&&(i+=String.formatTokens(s,{name:e.series.name,value:String.localeFormat("{0:"+n[t]+"}",e.y)}),a+=e.y)}),String.formatTokens(e,{x:this.x,stackTotal:String.localeFormat("{0:"+n[0]+"}",a),seriesDetail:i})},shared:!0}}}getXAxisOptions(e,s){var e=e??{},t=(e.categories=s.map(e=>this.removeRBLEncoding(e.category)??""),s.map((e,t)=>({index:t,plotLine:e.plotLine??"",plotBand:e.plotBand??""})).filter(e=>""!==e.plotLine||""!==e.plotBand));let n=[],r=[];return t.forEach(e=>{var t,i,a;""!==e.plotLine&&(t=(i=e.plotLine.split("|"))[0],a=Number(i[1]),i=2<i.length?Number(i[2]):0,t={color:t,value:e.index+i,width:a,zIndex:1},n.push(t)),""!==e.plotBand&&(a=(i=e.plotBand.split("|"))[0],t=i[1],i=2<i.length?Number(i[2]):0,a={color:a,from:0===String.compare(t,"lower",!0)?-1:e.index+i,to:0===String.compare(t,"lower",!0)?e.index+i:0===String.compare(t,"higher",!0)?s.length:e.index+Number(t)+i},r.push(a))}),0<n.length&&(e.plotLines=n),0<r.length&&(e.plotBands=r),e}buildSeries(s,e,n,r,l){let o=[];return e.forEach(i=>{var e=0===n.filter(e=>"config-visible"===e.category&&"0"===e[i]).length,a=0<n.filter(e=>"config-hidden"===e.category&&"1"===e[i]).length;if(e){let t={};e=n.filter(e=>-1===["config-visible","config-hidden","config-format"].indexOf(e.category)&&void 0!==e[i]).map(e=>({key:e.category.substring(7),value:e[i]}));t.data=r.map(e=>this.getSeriesDataRow(e,s,i,l)),e.forEach(e=>{this.setApiOption(t,e.key,e.value)}),a&&(t.visible=!1,t.showInLegend=t.showInLegend??!1),o.push(t)}}),o}getSeriesDataRow(t,e,i,a){let s={y:+t[i],id:i+"."+t.category},n=(a||(s.name=t.category),"point."+i+".");return e.filter(e=>e.startsWith(n)).forEach(e=>{s[e.substring(n.length)]=this.getOptionValue(t[e])}),s}setApiOption(e,t,i){let a=e;var s=t.split("."),n=this.getOptionValue(i);for(let i=0;i<s.length;i++){let e=s[i],t=-1;e.endsWith("]")&&(r=e.split("["),e=r[0],t=parseInt(r[1].substring(0,r[1].length-1)));var r=i===s.length-1,l=r?n:{},o=-1<t&&null!=a[e]&&a[e].length-1<t;if(void 0===a[e])a[e]=-1<t?[l]:l;else if(r||o)if(-1<t){for(var c=a[e];c.length-1<t;)c.push(void 0);c[t]=l}else a[e]=l;a=-1<t?a[e][t]:a[e]}}getOptionValue(value){let d=Number(value);if(void 0!==value&&0!==String.compare(value,"null",!0)){if(isNaN(d)||""===value){if(0===String.compare(value,"true",!0))return!0;if(0===String.compare(value,"false",!0))return!1;if(value.startsWith("resource:"))return this.application?.getLocalizedString(value.substring(9));if(value.startsWith("json:"))return JSON.parse(value.substring(5));if(value.startsWith("var ")){let v=value.substring(4);return function(){return eval(v)}}if(value.startsWith("eval ")){let v=value.substring(5);return eval(v)}if(value.startsWith("function ")){let f=this.removeRBLEncoding(`function f() ${value.substring(value.indexOf("{"))} f.call(this);`);return function(){return eval(f)}}return this.removeRBLEncoding(value)}return d}}ensureCulture(){this.cultureEnsured||(this.cultureEnsured=!0,(this.application.state.rbl.value("variable","culture")??"en-").startsWith("en-"))||Highcharts.setOptions({yAxis:{labels:{formatter:function(){return String.localeFormat("{0:c0}",this.value)}},stackLabels:{formatter:function(){return String.localeFormat("{0:c0}",this.value)}}}})}removeRBLEncoding(e){return void 0===e?e:e.replace(/<</g,"<").replace(/&lt;&lt;/g,"<").replace(/>>/g,">").replace(/&gt;&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;nbsp;/g,"&nbsp;")}}KatApps.DirectiveKaHighchart=DirectiveKaHighchart}(KatApps=KatApps||{}),(e=>{e.DirectiveKaInline=class{name="ka-inline";getDefinition(a){return t=>{let i=t.el.getAttribute("v-ka-id")??e.Utils.generateId();return t.el.classList.remove("ka-inspector-inline"),t.effect(()=>{t.get();t.el.hasAttribute("v-ka-id")?document.querySelectorAll(`[v-ka-inline-id='${i}']`).forEach(e=>e.remove()):t.el.setAttribute("v-ka-id",i),("TEMPLATE"===t.el.tagName?[...t.el.content.children]:[...t.el.children]).forEach(e=>{e=e.cloneNode(!0);"0"!=a.options.debug.showInspector&&e.classList.add("ka-inspector-inline"),e.setAttribute("v-ka-inline-id",i),t.el.before(e)})}),()=>{document.querySelectorAll(`[v-ka-inline-id='${i}']`).forEach(e=>e.remove())}}}}})(KatApps=KatApps||{}),(s=>{s.DirectiveKaModal=class{name="ka-modal";getDefinition(a){return e=>(e.effect(()=>{let i=e.get();try{null!=i.model&&(i=e.get(i.model))}catch(e){s.Utils.trace(a,"DirectiveKaModal","getDefinition","Unable to compile 'model' property: "+i.model,TraceVerbosity.None,e)}"A"==e.el.tagName&&e.el.setAttribute("href","#"),$(e.el).off("click.ka-modal").on("click.ka-modal",async function(e){e.preventDefault();try{null!=i.beforeOpenAsync&&await i.beforeOpenAsync(a);var t=await a.showModalAsync(s.Utils.clone(i,(e,t)=>-1<["beforeOpenAsync","confirmedAsync","cancelledAsync","catchAsync"].indexOf(e)?void 0:t),e.currentTarget);t.confirmed?null!=i.confirmedAsync?await i.confirmedAsync(t.response,a):s.Utils.trace(a,"DirectiveKaModal","showModal",`Modal App ${i.view} confirmed.`,TraceVerbosity.Normal,t.response):null!=i.cancelledAsync?await i.cancelledAsync(t.response,a):s.Utils.trace(a,"DirectiveKaModal","showModal",`Modal App ${i.view} cancelled.`,TraceVerbosity.Normal,t.response)}catch(e){null!=i.catchAsync?await i.catchAsync(e,a):s.Utils.trace(a,"DirectiveKaModal","showModal",`Modal App ${i.view} failed.`,TraceVerbosity.None,e)}finally{null!=i.closed&&i.closed(a)}})}),()=>{$(e.el).off("click.ka-modal")})}}})(KatApps=KatApps||{}),(l=>{l.DirectiveKaNavigate=class{name="ka-navigate";getDefinition(r){return e=>{let s=e.get();try{null!=s.model&&(s=e.get(s.model))}catch(e){l.Utils.trace(r,"DirectiveKaNavigate","getDefinition","Unable to compile 'model' property: "+s.model,TraceVerbosity.None,e)}let n=s.view;return"A"==e.el.tagName&&e.el.setAttribute("href","#"),$(e.el).on("click.ka-navigate",async function(e){if((e.preventDefault(),s.clearDirty&&(r.state.isDirty=!1),null!=s.confirm)&&!(await r.showModalAsync(s.confirm,e.currentTarget)).confirmed)return!1;var t=s.inputs??(null!=s.ceInputs?{}:void 0);if(null!=s.ceInputs){var i,a=l.Utils.getObjectFromAttributes(s.ceInputs);for(i in a)(i.startsWith("i")||i.startsWith("data-input-"))&&(t[i.startsWith("i")?i:"i"+i.split("-").slice(2).map(e=>e[0].toUpperCase()+e.slice(1)).join("")]=a[i])}return await r.navigateAsync(n,{inputs:t,persistInputs:s.persistInputs??!1}),!1}),()=>{$(e.el).off("click.ka-navigate")}}}}})(KatApps=KatApps||{}),(KatApps||(KatApps={})).DirectiveKaResource=class{name="ka-resource";getDefinition(s){return i=>{let a=""!=i.el.innerHTML?i.el.innerHTML:void 0;i.effect(()=>{var e=i.exp.startsWith("{")?i.get():{key:(""!=i.exp?i.exp:void 0)??i.el.innerHTML};let t=e.key??i.el.innerHTML;null!=t&&-1==t.indexOf("^")&&null!=e.templateArguments&&(t=[t,...e.templateArguments].join("^")),i.el.innerHTML=null!=a?s.getLocalizedString(t,e,a):s.getLocalizedString(t,e),i.el.setAttribute("data-resource-key",t),-1!=s.missingResources.findIndex(e=>e==t)?i.el.classList.add("missing"):i.el.classList.remove("missing"),-1!=s.missingLanguageResources.findIndex(e=>e==t)?i.el.classList.add("missing-culture"):i.el.classList.remove("missing-culture")})}}},(()=>{class e{name="ka-table";getDefinition(m){return n=>{n.effect(()=>{let g=n.get();var s=m.state.rbl.source(g.name,g.ce,g.tab);if($(n.el).empty(),0<s.length){let e=null!=g.css?`rbl ${g.name} `+g.css:`rbl ${g.name} table table-sm table-hover`,i=-1<e.indexOf("table-responsive"),t=(e=e.replace("table-responsive",""),s[0]),o=[],c={},a=!1,p=(Object.keys(t).filter(e=>e.startsWith("text")||e.startsWith("value")).map(e=>({Name:e,Element:t[e],Meta:t["@"+e]??{},Width:t["@"+e]?.[i?"@r-width":"@width"]})).forEach(e=>{var t={name:e.Name,isTextColumn:e.Name.startsWith("text"),cssClass:e.Meta["@class"],width:void 0===e.Width||e.Width.endsWith("%")?void 0:+e.Width,widthPct:void 0!==e.Width&&e.Width.endsWith("%")?e.Width:void 0,xsColumns:(null!=e.Meta["@xs-width"]?+e.Meta["@xs-width"]:void 0)||(i&&null!=e.Meta["@width"]?+e.Meta["@width"]:void 0),smColumns:null!=e.Meta["@sm-width"]?+e.Meta["@sm-width"]:void 0,mdColumns:null!=e.Meta["@md-width"]?+e.Meta["@md-width"]:void 0,lgColumns:null!=e.Meta["@lg-width"]?+e.Meta["@lg-width"]:void 0};void 0===t.xsColumns&&void 0===t.smColumns&&void 0===t.mdColumns&&void 0===t.lgColumns||(a=!0),o.push(t),c[e.Name]=t}),e=>{var t=e.code??"",e=e.id??"";return"h"===t||t.startsWith("header")||t.startsWith("hdr")||"h"===e||e.startsWith("header")||e.startsWith("hdr")}),u=(t,e,i,a)=>e&&""==i&&1===(e=Object.keys(t).filter(e=>e.startsWith("text")||e.startsWith("value")).map(e=>({Name:e,Value:t[e]??"",Class:`${c[e].isTextColumn?"text":"value"} span-${g.name}-${e} `+(a?.(0,o.length-1)??"")})).filter(e=>""!==e.Value)).length?e[0]:void 0,d=(t,e,i)=>{var a,s,n,r=e.split(":"),l=[];for(let e=0;e<r.length;e++)e%2==0&&(a=+r[e+1],s=r[e],n=`${(n=c[s]).isTextColumn?"text":"value"} ${n.cssClass??""} span-${g.name}-${a} `+(i?.(0,a-1)??""),l.push({Value:t[s]??"",Class:n,Span:a}));return l},h=(e,t)=>{""!=t.trim()&&e.classList.add(...t.trim().split(" "))};if(a&&!i){let a=(i,a)=>{var e=o.filter((e,t)=>i<=t&&t<=i+a),t=e.reduce((e,t)=>e+(t.xsColumns??0),0),s=e.reduce((e,t)=>e+(t.smColumns??0),0),n=e.reduce((e,t)=>e+(t.mdColumns??0),0),e=e.reduce((e,t)=>e+(t.lgColumns??0),0),t=0<t?" col-xs-"+t:"";return(t=(t+=0<s?" col-sm-"+s:"")+(0<n?" col-md-"+n:"")+(0<e?" col-lg-"+e:"")).trim()},r=document.createElement("div");s.forEach(s=>{var e=p(s);let n=document.createElement("div");h(n,`${s["@class"]??s.class??""} row tr-row `+(e?"h-row":""));var t,i=s.span??"",e=u(s,e,i,a);null!=e?(t=document.createElement("div"),h(t,e.Class),t.innerHTML=m.getLocalizedString(e.Value),n.appendChild(t)):""!=i?n.append(...d(s,i,a).map(e=>{var t=document.createElement("div");return h(t,e.Class),t.innerHTML=m.getLocalizedString(e.Value),t})):o.forEach(e=>{var t,i,a=document.createElement("div");h(a,`${t=e,i=void 0!==t.xsColumns?" col-xs-"+t.xsColumns:"",(i=(i=(i=(i+=void 0!==t.smColumns?" col-sm-"+t.smColumns:"")+(void 0!==t.mdColumns?" col-md-"+t.mdColumns:""))+(void 0!==t.lgColumns?" col-lg-"+t.lgColumns:""))+(" "+(t.cssClass??""))).trim()} ${e.isTextColumn?"text":"value"} ${g.name}-`+e.name),a.innerHTML=m.getLocalizedString(s[e.name])??"",n.append(a)}),r.append(n)}),n.el.append(r)}else{let r=document.createElement("table"),l=(h(r,e),r.appendChild((()=>{let i=document.createElement("colgroup");return o.forEach(e=>{void 0===e.width&&void 0===e.widthPct||(e.widthPct??e.width);var t=document.createElement("col");t.setAttribute("class",g.name+"-"+e.name),void 0===e.width&&void 0===e.widthPct||t.setAttribute("width",e.widthPct??e.width+"px"),i.append(t)}),i})()),void 0);s.forEach(i=>{var e=p(i);e&&null==l?(l=document.createElement("thead"),r.append(l)):e||"TBODY"==l?.tagName||(l=document.createElement("tbody"),r.append(l));let a=document.createElement("tr"),s=(h(a,`${i["@class"]??i.class??""} `+(e&&"TBODY"==l.tagName?"h-row":"")),e?"th":"td");var t,n=i.span??"",e=u(i,e,n);null!=e?(t=document.createElement(s),h(t,e.Class),t.innerHTML=m.getLocalizedString(e.Value),a.appendChild(t)):""!=n?a.append(...d(i,n).map(e=>{var t=document.createElement(s);return h(t,e.Class),t.setAttribute("colspan",e.Span.toString()),t.innerHTML=m.getLocalizedString(e.Value),t})):o.forEach(e=>{var t=document.createElement(s);h(t,`${e.cssClass??""} ${e.isTextColumn?"text":"value"} ${g.name}-`+e.name),t.innerHTML=m.getLocalizedString(i[e.name])??"",a.append(t)}),l.append(a)}),i?((s=document.createElement("div")).classList.add("table-responsive"),s.append(r),n.el.append(s)):n.el.append(r)}}})}}}(KatApps||(KatApps={})).DirectiveKaTable=e})(),(e=>{e.Directives=class{static initializeCoreDirectives(t,i){[new e.DirectiveKaAttributes,new e.DirectiveKaInline,new e.DirectiveKaResource,new e.DirectiveKaHighchart,new e.DirectiveKaTable,new e.DirectiveKaValue,new e.DirectiveKaNavigate,new e.DirectiveKaModal,new e.DirectiveKaApp,new e.DirectiveKaApi].forEach(e=>{t.directive(e.name,e.getDefinition(i))})}}})(KatApps=KatApps||{}),(()=>{class e{name="ka-value";getDefinition(s){return e=>{let t=e.exp.startsWith("{")?e.get():void 0;null!=t&&null==t.table&&(t.table="rbl-value");function i(e){return a.length>e&&""!=a[e]?a[e]:void 0}let a=(e.exp.startsWith("{")?void 0:e.exp)?.split(".").map(e=>""!=e?e:void 0)??[];1==a.length&&(a=["rbl-value",a[0]]);e.effect(()=>{e.el.innerHTML=s.getLocalizedString(s.state.rbl.value(t?.table??i(0),t?.keyValue??i(1),t?.returnField??i(2),t?.keyField??i(3),t?.ce??i(4),t?.tab??i(5))??e.el.innerText)})}}}(KatApps||(KatApps={})).DirectiveKaValue=e})(),(()=>{class r{static currentPopoverTarget;static visiblePopover;static visiblePopoverApp;static visiblePopupContentSource;static hideVisiblePopover(e){var t=r.visiblePopover;return!("true"!=t?.getAttribute("ka-init-tip")||null!=e&&!r.visiblePopoverApp.el[0].matches(e)||(bootstrap.Popover.getInstance(t).hide(),0))}static processHelpTips(e,t,i){if("true"!=document.querySelector("html").getAttribute("ka-init-tip")){let t;var a=document.querySelector("html");a.setAttribute("ka-init-tip","true"),a.addEventListener("click",e=>{var e=e.target,t=e.closest("a, button"),i=null!=e.closest(".popover-header, .popover-body"),t=null!=t&&t.classList.contains("ka-ht-js");"BUTTON"!=e.tagName&&(t||i)||r.hideVisiblePopover()}),a.addEventListener("keyup",e=>{"Escape"==e.key&&(e.preventDefault(),r.hideVisiblePopover())}),a.addEventListener("inserted.bs.tooltip",e=>{var e=e.target,t="#"+e.getAttribute("aria-describedby"),t=document.querySelector(t);e.classList.contains("error")?t?.classList.add("error"):e.classList.contains("warning")&&t?.classList.add("warning")}),a.addEventListener("inserted.bs.popover",async e=>{var e=e.target,t=KatApp.get(e)??KatApp.applications.find(e=>e.options.canProcessExternalHelpTips)??KatApp.applications[0],e="#"+e.getAttribute("aria-describedby"),i=(document.querySelector(e).classList.add("kaPopup"),t.cloneOptions(!1));let a=!1;null!=r.visiblePopupContentSource&&(!0===(a=t.getCloneHostSetting(r.visiblePopupContentSource))&&(a=t.selector),i.cloneHost=a),r.visiblePopoverApp=await KatApp.createAppAsync(e,i)}),a.addEventListener("show.bs.popover",e=>{null!=t&&(clearTimeout(t),t=void 0),r.hideVisiblePopover(),r.currentPopoverTarget=e.target}),a.addEventListener("shown.bs.popover",e=>r.visiblePopover=e.target),a.addEventListener("hide.bs.popover",e=>{null!=r.visiblePopoverApp&&KatApp.remove(r.visiblePopoverApp),r.visiblePopover=void 0,r.visiblePopoverApp=void 0,r.visiblePopupContentSource=void 0,t=setTimeout(()=>{r.currentPopoverTarget=void 0,t=void 0},200)})}function s(e){var t,i=e.getAttribute("data-bs-content-selector");return null!=i?(i=n(i,KatApp.get(e)),r.visiblePopupContentSource=0<i.length?i[0]:void 0,null==r.visiblePopupContentSource?void 0:((i=$("<div/>")).append($(r.visiblePopupContentSource).contents().clone(!0)),i)):(i=e.getAttribute("data-bs-content")??e.nextElementSibling?.innerHTML,null!=(t=e.getAttribute("data-label-fix"))?i.replace(/\{Label}/g,n("."+t,KatApp.get(e))[0].innerHTML):i)}let n=(e,t,i)=>$(e,$(i??t?.el[0]??document));((null!=i?$(i):void 0)??n(t??"[data-bs-toggle='tooltip'], [data-bs-toggle='popover']",KatApp.get(e),"A"==e.tagName||"BUTTON"==e.tagName?e.parentElement:e)).each((e,a)=>{var t,i;"true"!=a.getAttribute("ka-init-tip")&&(t="tooltip"==a.getAttribute("data-bs-toggle"),"LABEL"==a.parentElement?.tagName&&null!=a.parentElement?.parentElement?.querySelector("input[type=checkbox]")&&a.addEventListener("click",e=>{e.stopPropagation(),a.click()}),i={html:!0,sanitize:!1,trigger:a.getAttribute("data-bs-trigger")??"hover",container:(()=>{if(a.hasAttribute("data-bs-container"))return a.getAttribute("data-bs-container");if(null==a.parentElement)return a;{let e=a;for(;(e=e.parentElement)&&e!==document;)if("LABEL"==e.tagName)return e.parentElement;return a.parentElement}})(),template:t?'<div class="tooltip katapp-css" role="tooltip"><div class="tooltip-arrow arrow"></div><div class="tooltip-inner"></div></div>':'<div v-scope class="popover katapp-css" role="tooltip"><div class="popover-arrow arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',placement:(e,t)=>{var i=t.getAttribute("data-bs-class"),i=(null!=i&&e.classList.add(i),`${t.getAttribute("data-bs-width")??"350"}px`),t=(e.style.width=i,e.style.maxWidth=i,e.querySelector(".tooltip-inner"));return null!=t&&(t.style.width=i,t.style.maxWidth=i),a.getAttribute("data-bs-placement")??"auto"},fallbackPlacements:a.getAttribute("data-bs-fallback-placements")?.split(",")??["top","right","bottom","left"],title:function(){var e=this;if("tooltip"==e.getAttribute("data-bs-toggle"))return s(e);var t=e.getAttribute("data-bs-content-selector");if(null!=t){t=n(t+"Title",KatApp.get(e));if(0<t.length&&""!=t[0].innerHTML)return t[0].innerHTML}return""},content:function(){return s(this)}},new(t?bootstrap.Tooltip:bootstrap.Popover)(a,i),a.setAttribute("ka-init-tip","true"))})}}(KatApps||(KatApps={})).HelpTips=r})(),(e=>{e[e.None=0]="None",e[e.Quiet=1]="Quiet",e[e.Minimal=2]="Minimal",e[e.Normal=3]="Normal",e[e.Detailed=4]="Detailed",e[e.Diagnostic=5]="Diagnostic"})(TraceVerbosity=TraceVerbosity||{}),!function(){(KatApps||(KatApps={})).KamlCompiler=class{showInspector;applicationId;constructor(e){this.showInspector="0"!=e.options.debug.showInspector,this.applicationId=e.id}compileMarkup(e,a){let s=document.querySelector("ka-resources");if(a!=this.applicationId){var n=a.split(":");let t=n[n.length-1].split("?")[0].replace(/\//g,"_"),i=null!=s.querySelector(`style[ka=${t}]`);e.querySelectorAll("style").forEach(e=>{i?e.remove():(e.setAttribute("ka",t),s.appendChild(e))})}this.processMarkup(e),e.querySelectorAll("template[id]").forEach(t=>{var e=a.split(":"),e=e[e.length-1].split("?")[0].replace(/\//g,"_");t.id=t.id+"_"+e,null==s.querySelector(`template[id=${t.id}]`)?(this.processMarkup(t.content),t.hasAttribute("input")&&(this.mountInputs(t.content),t.removeAttribute("input")),t.content.querySelectorAll("style, script").forEach(e=>{this.addMountAttribute(e,"mounted",`_templateItemMounted('${t.id}', $el, $data)`),"SCRIPT"==e.tagName&&this.addMountAttribute(e,"unmounted",`_templateItemUnmounted('${t.id}', $el, $data)`)}),s.appendChild(t)):t.remove()})}checkVueSyntax(e){let t=!1;if(e.querySelectorAll("[v-for][v-if]").forEach(e=>{console.log(e),t=!0}),t)throw new Error("v-for and v-if on same element.  The v-for should be moved to a child <template v-for/> element.");if(e.querySelectorAll("[v-ka-inline]").forEach(e=>{"TEMPLATE"==e.tagName&&e.hasAttribute("v-html")||(console.log(e),t=!0)}),t)throw new Error("v-ka-inline can only be used on <template/> elements and must have a v-html attribute.");if(e.querySelectorAll("template:not([id])").forEach(e=>{Array.from(e.content.children).filter(e=>e.hasAttribute("v-if")).forEach(e=>{console.log(e),t=!0})}),t)throw new Error("A v-if can not be a direct decendent of an inline <template/>.  Wrap the v-if element with a div.")}processMarkup(e){this.checkVueSyntax(e),e.querySelectorAll("[v-ka-input], [v-ka-input-group], [v-ka-template]").forEach(t=>{if(t.hasAttribute("v-ka-input")){let e=t.getAttribute("v-ka-input");e.startsWith("{")||(e=`{ name: '${e}' }`),this.showInspector||t.removeAttribute("v-ka-input"),t.setAttribute("v-scope",`components.input(${e})`),-1==e.indexOf("template:")&&-1==e.indexOf("'template':")&&(-1<["INPUT","SELECT","TEXTAREA"].indexOf(t.tagName)?this.mountInput(t):this.mountInputs(t))}else{var e,i,a;t.hasAttribute("v-ka-input-group")?(a=t.getAttribute("v-ka-input-group"),this.showInspector||t.removeAttribute("v-ka-input-group"),t.setAttribute("v-scope",`components.inputGroup(${a})`)):(a=/.*?name'?\s*:\s*(?<value>'?[\w\s\.]+'?)/,i=(e=t.getAttribute("v-ka-template")).startsWith("{")?e:`{ name: '${e}' }`,a=a.exec(i)?.groups.value??"",!t.hasAttribute("v-for")&&!a.startsWith("'")?(t.removeAttribute("v-ka-template"),t.setAttribute("v-scope","components.template({ name: _reactive_template.name, source: _reactive_template.source})"),t.outerHTML=`<template v-for="_reactive_template in [${i}]" :key="_reactive_template.name">${t.outerHTML}<template>`,this.showInspector&&t.setAttribute("v-ka-template",e)):(t.setAttribute("v-scope",`components.template(${i})`),this.showInspector||t.removeAttribute("v-ka-template")))}}),e.querySelectorAll("[v-ka-inline]").forEach(e=>{e.setAttribute("v-ka-inline",e.getAttribute("v-html"))}),e.querySelectorAll("[v-ka-highchart], [v-ka-table], [v-ka-api], [v-ka-navigate]").forEach(e=>{var t,i;e.hasAttribute("v-ka-highchart")?(t=e.getAttribute("v-ka-highchart")).startsWith("{")||(i=(t=t.split("."))[0],t=2<=t.length?t[1]:t[0],e.setAttribute("v-ka-highchart",`{ data: '${i}', options: '${t}' }`)):e.hasAttribute("v-ka-table")?(i=e.getAttribute("v-ka-table")).startsWith("{")||e.setAttribute("v-ka-table",`{ name: '${i}' }`):e.hasAttribute("v-ka-api")?(t=e.getAttribute("v-ka-api")).startsWith("{")||e.setAttribute("v-ka-api",`{ endpoint: '${t}' }`):e.hasAttribute("v-ka-navigate")&&!(i=e.getAttribute("v-ka-navigate")).startsWith("{")&&e.setAttribute("v-ka-navigate",`{ view: '${i}' }`)}),e.querySelectorAll("[v-ka-rbl-no-calc], [v-ka-rbl-exclude], [v-ka-unmount-clears-inputs]").forEach(e=>{e.hasAttribute("v-ka-rbl-no-calc")&&(e.removeAttribute("v-ka-rbl-no-calc"),e.setAttribute("ka-rbl-no-calc","true")),e.hasAttribute("v-ka-rbl-exclude")&&(e.removeAttribute("v-ka-rbl-exclude"),e.setAttribute("ka-rbl-exclude","true")),e.hasAttribute("v-ka-unmount-clears-inputs")&&(e.removeAttribute("v-ka-unmount-clears-inputs"),e.setAttribute("ka-unmount-clears-inputs","true"))}),e.querySelectorAll("button[v-ka-needs-calc], a[v-ka-needs-calc]").forEach(e=>{let t=e.getAttribute("v-ka-needs-calc");""==t&&(t="<i class='fa-solid fa-rotate-right'></i>&nbsp;Refresh"),this.showInspector||e.removeAttribute("v-ka-needs-calc"),e.setAttribute("v-if","!needsCalculation"),e.classList.add("ka-needs-calc");var i,a,s=e.cloneNode(!0);s.removeAttribute("v-ka-needs-calc");for({name:i,value:a}of[...s.attributes])i.startsWith("@click")&&s.attributes.removeNamedItem(i);s.innerHTML=t,s.setAttribute("v-if","needsCalculation"),e.after(s)}),e.querySelectorAll("[v-for], [v-if], [v-else-if], [v-else]").forEach(e=>{this.addMountAttribute(e,"mounted","_domElementMounted($el)")}),this.showInspector&&e.querySelectorAll("[v-if], [v-show]").forEach(i=>{var t=i.getAttribute("v-if")??i.getAttribute("v-show");if(!i.classList.contains("ka-needs-calc")&&-1==["uiBlocked","!uiBlocked"].indexOf(t)){var a,s=[t],t=i.hasAttribute("v-if");let e=!i.hasAttribute("v-for");if(e&&t){let t=i;for(;["v-else-if","v-else"].some(e=>t.nextElementSibling?.hasAttribute(e));)(t=t.nextElementSibling).hasAttribute("v-else")?e=!1:s.push(t.getAttribute("v-else-if"))}e&&((a=document.createElement("div")).innerHTML=`<i class='fa-solid fa-eye'></i>
<!--
Inspector: ${1<s.length?"v-if/v-else-if":t?"v-if":"v-show"} hidden, ${1<s.length?"all following expression(s) evaluated to false:":"the following expression evaluated to false:"}
${s.map(e=>`	`+e).join("\r\n")}
-->`,a.setAttribute(t?"v-if":"v-show",`!(${s.join(" && ")})`),a.classList.add("v-opposite",t?"ka-inspector-if-hidden":"ka-inspector-show-hidden"),i.before(a))}}),this.showInspector&&this.inspectChildren(e),e.querySelectorAll("template:not([id])").forEach(e=>{this.processMarkup(e.content)})}inspectChildren(e){let t=e.firstChild;for(;t;)t=this.inspectChild(t)??t.nextSibling}delimiters=["{{","}}"];escapeRegex=e=>e.replace(/[-.*+?^${}()|[\]\/\\]/g,"\\$&");delimitersRE=new RegExp(this.escapeRegex(this.delimiters[0])+"([^]+?)"+this.escapeRegex(this.delimiters[1]),"g");directiveRE=/^(?:v-|ka-rbl-|ka-unmount-|:|@)/;inspectChild(e){if(1==e.nodeType){let s=e,a=(this.inspectChildren(s),e=>-1!=["ka-inspector-rbl-no-calc","ka-inspector-rbl-exclude","ka-inspector-unmount-clears-inputs"].indexOf(e)),n=e=>-1!=["v-ka-needs-calc","v-ka-input","v-ka-input-group","v-ka-template"].indexOf(e),r={};var o,c,p=(e,t,i)=>{var a=n(t)?t:e;null==r[a]&&(r[a]=[],s.classList.add(e),"v-ka-needs-calc"==t&&s.nextElementSibling.classList.add(e),n(t))&&s.removeAttribute(t),r[a].push(n(t)?""==i&&"v-ka-needs-calc"==t?"[default]":i:t+`="${i}"`)};for(let{name:e,value:t}of[...s.attributes])this.directiveRE.test(e)&&"v-cloak"!==e&&("@"===e[0]?p("ka-inspector-on",e,t):":"===e[0]?":key"==e&&s.hasAttribute("v-for")||p("ka-inspector-bind",e,t):e.startsWith("v-ka-")?p("ka-inspector-"+e.substring(5),e,t):e.startsWith("ka-")?p("ka-inspector-"+e.substring(3),e,t):-1!=["v-else-if","v-else"].indexOf(e)?p("ka-inspector-if",e,t):"v-scope"==e&&(t.startsWith("components.template")||t.startsWith("components.input"))||"v-if"==e&&(["ka-needs-calc","ka-inspector-if-hidden","ka-inspector-show-hidden"].some(e=>s.classList.contains(e))||-1<["uiBlocked","!uiBlocked"].indexOf(t))||"v-for"==e&&t.startsWith("_reactive_template")||e.startsWith("v-on:vue:mounted")&&["_domElementMounted","inputMounted","_templateItemMounted"].some(e=>t.startsWith(e))||e.startsWith("v-on:vue:unmounted")&&["inputUnmounted","_templateItemUnmounted"].some(e=>t.startsWith(e))||p("ka-inspector-"+e.split(":")[0].substring(2),e,t));let l=[],t=(e,t,i)=>{a(e)?l.push(""+i+e+": true"):"ka-inspector-pre"!=e&&l.push(1<t.length?""+i+e+" expressions:\r\n"+t.map(e=>"\t"+e).join("\r\n"):""+i+e+": "+t[0])},i="";["ka-inspector-if","ka-inspector-for"].forEach(e=>{null!=r[e]&&(i="\t",t(e,r[e],""))});for([o,c]of Object.entries(r).filter(([e])=>!["ka-inspector-if","ka-inspector-for"].includes(e)))t(o,c,i);if(0<l.length){var u=e=>{var t=e.inspector;return null!=t?(t=t.data.substring(2,t.data.length-2),e.previousSibling?.remove(),delete e.inspector,t.split("\r\n")):[]};let t=s;if(l.push(...u(t).map(e=>null!=r["ka-inspector-if"]?"\t"+e:e)),null!=r["ka-inspector-if"]&&["v-else-if","v-else"].some(e=>s.hasAttribute(e))){let e=s;for(;e=e.previousElementSibling;)if(e.hasAttribute("v-if")){var d=u(t=e);d.push(...l),l=d;break}}t.before(t.inspector=new Comment("\r\n"+l.join("\r\n")+"\r\n"))}}else if(3==e.nodeType&&"SCRIPT"!=e.parentNode.tagName){for(var t,i=e.data,a=e.parentElement,s=[];t=this.delimitersRE.exec(i);)0==s.length&&a.classList.add("ka-inspector-text"),s.push(t[0].trim());0<s.length&&a.before(a.inspector=1<s.length?new Comment("\r\nka-inspector-text bindings:\r\n"+s.map(e=>"\t"+e).join("\r\n")+"\r\n"):new Comment("\r\nka-inspector-text binding: "+s[0]+"\r\n"))}}mountInputs(e){e.querySelectorAll("input:not([v-ka-nomount]), select:not([v-ka-nomount]), textarea:not([v-ka-nomount])").forEach(e=>{this.mountInput(e)}),e.querySelectorAll("template[v-for]").forEach(e=>{this.mountInputs(e.content)})}mountInput(e){this.addMountAttribute(e,"mounted","inputMounted($el, $refs)"),this.addMountAttribute(e,"unmounted","inputUnmounted($el)")}addMountAttribute(e,t,i,a){let s=e.getAttribute("v-on:vue:"+t)??e.getAttribute("@vue:"+t)??"";(a?.(s)??!0)&&(e.removeAttribute("v-on:vue:"+t),e.removeAttribute("@vue:"+t),s.startsWith("handlers.")&&-1==s.indexOf("(")&&(s+="($event)"),e.setAttribute("v-on:vue:"+t,(""!=s?s+";":"")+i))}}}(),(r=>{class l{static resourceRequests={};static async getViewResourceAsync(e,t){return this.getKamlResourcesAsync(e,[t],!0)}static async getTemplateResourcesAsync(e,t){return this.getKamlResourcesAsync(e,t,!1)}static async getKamlResourcesAsync(e,i,a){let s=e,n=null!=s.debug.debugResourcesDomain&&(s.useLocalRepository??(s.useLocalRepository=await r.Utils.checkLocalServerAsync(s))),t=await Promise.allSettled(i.map(t=>{if(!a){var i,e=l.resourceRequests[t];if(null!=e)return i=$.Deferred(),e.push(e=>{null!=e?i.reject({resourceKey:t,errorMessage:e,processedByOtherApp:!0}):i.resolve({resourceKey:t,processedByOtherApp:!0})}),i;l.resourceRequests[t]=[]}return this.getResourceAsync(s,t,n)}));e=t.filter(e=>"rejected"==e.status).map(e=>e.reason).map(e=>({Exception:e instanceof d?e:void 0,Response:e instanceof d?void 0:e})).map(e=>null!=e.Exception?{resourceKey:e.Exception.resourceKey,processedByOtherApp:!1,errorMessage:e.Exception.message}:e.Response),i=t.filter(e=>"fulfilled"==e.status).map(e=>e.value);if(0<e.length)throw a||(e.filter(e=>!e.processedByOtherApp).forEach(t=>{l.resourceRequests[t.resourceKey].forEach(e=>e(t.errorMessage)),delete l.resourceRequests[t.resourceKey]}),i.filter(e=>!e.processedByOtherApp).forEach(e=>{l.resourceRequests[e.resourceKey].forEach(e=>e()),delete l.resourceRequests[e.resourceKey]})),new o("Failed to download Kaml repositoryItems.",e.map(e=>({resource:e.resourceKey,errorMessage:e.errorMessage})));{let t={};return i.filter(e=>!e.processedByOtherApp).forEach(e=>{t[e.resourceKey]=e.content}),t}}static resolveTemplate(e){this.resourceRequests[e].forEach(e=>e()),delete this.resourceRequests[e]}static async downloadResourceAsync(e,t,i=!1){var a,s=new Headers(t?{}:{"Cache-Control":"max-age=0"}),n=await fetch(e,{method:"GET",headers:s,cache:t?void 0:"default"});return n.ok?{data:await n.text()}:(a=404==n.status?"Resource not found.":400==n.status?(await n.json()).detail:`Status: ${n.status}, StatusText: `+n.statusText,console.log({url:e,cache:!t,status:n.status,statusText:a,requestHeaders:Object.fromEntries(s.entries()),responseHeaders:Object.fromEntries(n.headers.entries())}),i||500!=n.status&&415!=n.status?{errorMessage:a}:await this.downloadResourceAsync(e,t,!0))}static async getResourceAsync(i,a,s){var e=i.relativePathTemplates?.[a],n=(null!=e?e:a).split(":");let r=n[1];var l=n[0].split("|"),o=2<n.length?n[2]:i.debug.useTestView?"Test":"Live",e=r.split("?"),t=e[0];t.endsWith(".kaml")||(r=t+".kaml",2==e.length&&(r+="?"+e[1]));let c=r,h="unavailable",p={errorMessage:"unavailable"};for(let t=0;t<l.length;t++){let e=l[t];var g=0!=String.compare(e,"Rel",!0),u=(g||(u=r.split("/").slice(2),e=u[0],c=u.slice(1).join("/")),"https://"+i.debug.debugResourcesDomain+"/KatApp/"+e+"/"+c);if(h=s?u.substring(0,4)+u.substring(5)+location.search:g?i.katDataStoreUrl:i.baseUrl+r.substring(1)+location.search,!s&&g&&(h=h.replace("{name}",r)+`?folders=${n[0].split("|").join(",")}&preferTest=`+("Test"==o)),null!=(p=await this.downloadResourceAsync(h,s)).data){let e=p.data;if(s){var g=a.split("?")[0],m=g.split("/"),m=m[m.length-1].split(":");let u=m[m.length-1];m=e.match(/local-kaml-package=\"(.*?)\"/)?.[1].split(",").map(e=>e.trim().toLowerCase())??[];let d=-1<g.toLowerCase().indexOf("templates")||-1<m.indexOf("template.items");if(u.endsWith(".kaml")&&(0<m.length||d)){let n=-1==m.indexOf("js")?void 0:await this.downloadResourceAsync(h.replace(u,u+".js"),!0),r=-1==m.indexOf("css")?void 0:await this.downloadResourceAsync(h.replace(u,u+".css"),!0),l=-1==m.indexOf("templates")?void 0:await this.downloadResourceAsync(h.replace(u,u+".templates"),!0),o=e.split("\n"),c=/^\s*<template[^>]* id="[^"]+"([^>]* script="(?<script>[^"]+)")?([^>]* script\.setup="(?<setup>[^"]+)")?([^>]* css="(?<css>[^"]+)")?[^>]*>\s*$/,p=null;g=await Promise.all(o.map(async(e,t)=>{var i,a,s;return 0<=e.indexOf("</rbl-config>")?(null!=n?.data&&(e+=`
<script>
	(function () {
${n.data.split("\n").map(e=>"\t\t"+e).join("\n")}
	})();
	//# sourceURL=${u}
</script>
`),null!=r?.data&&(e+=`
<style>
${r.data.split("\n").map(e=>"\t"+e).join("\n")}
</style>
`),t==o.length-1&&null!=l?.data&&(e+="\n"+l.data.split("\n").map(e=>"\t"+e).join("\n"))):d&&null!=(p=e.match(c))&&(t=p.groups?.setup,s=p.groups?.script,i=p.groups?.css,null!=t&&(t=u+`.${t}.js`,null!=(a=await this.downloadResourceAsync(h.replace(u,t),!0))?.data)&&(e+=`
	<script setup>
${a.data.split("\n").map(e=>"\t\t"+e).join("\n")}
		//# sourceURL=${t}
	</script>
`),null!=s&&(a=u+`.${s}.js`,null!=(t=await this.downloadResourceAsync(h.replace(u,a),!0))?.data)&&(e+=`
	<script>
${t.data.split("\n").map(e=>"\t\t"+e).join("\n")}
		//# sourceURL=${a}
	</script>
`),null!=i)&&(s=u+`.${i}.css`,null!=(t=await this.downloadResourceAsync(h.replace(u,s),!0))?.data)&&(e+=`
	<style>
${t.data.split("\n").map(e=>"\t\t"+e).join("\n")}
	</style>
`),e}));e=g.join("\n")}}return{resourceKey:a,content:e,processedByOtherApp:!1}}}if(s)return this.getResourceAsync(i,a,!1);throw new d("getResourceAsync failed requesting from "+h+": "+p.errorMessage,a)}}r.KamlRepository=l;class o extends Error{results;constructor(e,t){super(e),this.results=t}}r.KamlRepositoryError=o;class d extends Error{resourceKey;constructor(e,t){super(e),this.resourceKey=t}}r.KamlResourceDownloadError=d})(KatApps=KatApps||{}),(l=>{String.compare==l&&(String.compare=function(e,t,i){return e===l&&t===l?0:e===l?-1:t===l?1:(i&&(e=e.toUpperCase(),t=t.toUpperCase()),e===t?0:e<t?-1:1)}),String.formatTokens===l&&(String.formatTokens=function(e,r){return e.replace(/{{([^}]+)}}/g,function(e,t){var i,a=t.split(":"),s=a[0],a=2==a.length?a[1]:l;let n="object"==typeof r[s]?r[s]["#text"]??r[s]:r[s];return n!=l&&a!=l&&(s=/^-?\d+(\.\d+)?$/,(i=n.match(/(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})(?:T.*)?/))!=l?n=String.localeFormat(`{0:${a}}`,new Date(parseInt(i.groups.year),parseInt(i.groups.month)-1,parseInt(i.groups.day))):s.test(n)&&(i=parseFloat(n),isNaN(i)||(n=String.localeFormat(`{0:${a}}`,i)))),n??`{{${t}}}`})})})(),!function(e){class t{static chunk(t,i){var a=[];for(let e=0;e<t.length;e+=i)a.push(t.slice(e,e+i));return a}static extend(t,...e){return e.forEach(e=>{void 0!==e&&this.copyProperties(t,e)}),t}static clone(e,t){return this.copyProperties({},e,t)}static copyProperties(i,a,s){return Object.keys(a).forEach(e=>{var t=null!=s?s(e,a[e]):a[e];null==t||"object"!=typeof t||Array.isArray(t)||t instanceof jQuery||t instanceof HTMLElement||"hostApplication"==e?null==t&&null!=s||(i[e]=t):(void 0!==i[e]&&"object"==typeof i[e]||(i[e]={}),this.copyProperties(i[e],t,s))}),i}static generateId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})};static parseQueryString(e){var t={};if(null!=e&&""!=e){var i=(e.startsWith("?")?e.substr(1):e).split("&");for(let e=0;e<i.length;++e){var a=i[e].split("=",2);2===a.length&&(t[a[0].toLowerCase()]=decodeURIComponent(a[1].replace(/\+/g," ")))}}return t}static generateQueryString(t,i){let a="";return Object.keys(t).forEach(e=>{null!=i&&!i(e)||(a+=`${e}=${t[e]}&`)}),0<a.length?"?"+a.substring(0,a.length-1):void 0}static pageParameters=this.readPageParameters();static _pageParameters;static readPageParameters(){return this._pageParameters??(this._pageParameters=this.parseQueryString(window.location.search))}static getObjectFromAttributes(e){for(var t,i=new RegExp("[\\s\\r\\t\\n]*([a-z0-9\\-_]+)[\\s\\r\\t\\n]*=[\\s\\r\\t\\n]*(['\"])((?:\\\\\\2|(?!\\2).)*)\\2","ig"),a={};t=i.exec(e);)a[t[1]]=t[3];return a}static trace(e,t,i,a,s,...n){var r,l,o;s<=(e.options.debug.traceVerbosity??TraceVerbosity.None)&&(s=new Date,t=t+`	KatApp Framework`,r=e.selector??e.id,l=e.traceStart,o=e.traceLast,l=Math.abs(s.getTime()-l.getTime()),o=Math.abs(s.getTime()-o.getTime()),e.traceLast=s,s=`${String.localeFormat("{0:yyyy-MM-dd hh:mm:ss:ff}",s)}	${String(l).padStart(5,"0")}	${String(o).padStart(5,"0")}	${e.options.dataGroup}	${r??"Unavailable"}	${t}	${i}: `+a,0<n.length?(console.group(s),n.forEach(e=>e instanceof Error?console.log({i:e}):console.log(e)),console.groupEnd()):console.log(s))}static async checkLocalServerAsync(e){return null!=await this.downloadLocalServerAsync(e.debug.debugResourcesDomain,"/js/ping.js")}static async downloadLocalServerAsync(e,t,a){let s="https://"+e+t;var i=await(async()=>{let e=new AbortController;var t=setTimeout(()=>e.abort(),1e3);try{var i=await fetch(a?s:s.substring(0,4)+s.substring(5),{method:"GET",signal:e.signal});return clearTimeout(t),i}catch(e){return clearTimeout(t),{ok:!1}}})();return i.ok?i.text():a?void 0:await this.downloadLocalServerAsync(e,t,!0)}}e.Utils=t}(KatApps=KatApps||{});